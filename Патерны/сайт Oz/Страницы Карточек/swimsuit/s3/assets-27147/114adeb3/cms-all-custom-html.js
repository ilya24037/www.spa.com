"use strict";(self.webpackChunkMicrofront_catalog_menu_cms_uw=self.webpackChunkMicrofront_catalog_menu_cms_uw||[]).push([["cms-all-custom-html"],{c3b82:(t,e,o)=>{o.a(t,async(t,n)=>{try{o.d(e,{N:()=>C});var r=o("79a44"),c=o("abb9e"),l=o.n(c),d=o("79b7d"),h=o("ecabc"),m=o("ed0be"),y=t([d,m]);[d,m]=y.then?(await y)():y;var{ESiteURLs:v,loadFiles:f,AuthorizationServiceMixin:w}=(t=>{var e,o;(o=e||(e={})).CART="/cart/",o.CHECKOUT="/checkout",o.ORDER_DONE="/order_done",o.PAYMENT_FORM="/payment_form",o.LOAN="/loan",o.FAVORITES="/my/favorites/",o.ORDERLIST="/my/orderlist",o.MANAGER_STATISTICS="/my/manager-statistics";var n,r;async function c({filePath:t,nonce:e,absolute:o=!1,isCrossoriginAnonymous:n}){return new Promise(r=>{var c=document.getElementsByTagName("head")[0]||document.documentElement,l=-1!==t.indexOf(".css");0===t.indexOf("//")||0!==t.indexOf("/")||o||(t=document.location.host+t),o||(t=((t="")=>{var e;return-1===t.indexOf("http")&&(e="undefined"==typeof document?"https:":document.location.protocol,-1===t.indexOf("//")&&(e+="//"),t=e+t),t})(t));var d=l?function(path,t){var link=document.createElement("link");return link.type="text/css",link.rel="stylesheet",link.media="screen",link.href=path,t&&link.setAttribute("nonce",t),link}(t,e):function(path,t,e=!0,o){var script=document.createElement("script");return script.async=e,script.src=path,t&&script.setAttribute("nonce",t),o&&script.setAttribute("crossorigin","anonymous"),script}(t,e,!o,n);d.addEventListener("load",()=>{r(d)}),c.appendChild(d)})}(r=n||(n={})).MODAL="modal",r.REDIRECT="redirect";var l={methods:{async redirectToAuth(t){await this.$composerRouter.redirect(t,"_self")},async showAuthForm(t){var{method:e,url:o}=await this._getAuthMethodData(t);e===n.REDIRECT?await this.redirectToAuth(o):this.$registry.useByName("ComposerActions").getModal({url:o,options:{notCentered:!0}})},async _getAuthMethodData(t){var e={name:"authorizationMethod"};t&&(e.query={redirect_uri:t});var{method:o,url:n}=await this.$registry.useByName("ComposerService").actionGet(e);return{method:o,url:n}}}};return t.ESiteURLs=e,t.loadFiles=async function({fileList:t,loadAsync:e=!1,absolute:o=!1,nonce:n,isCrossoriginAnonymous:r=!1}){return new Promise((l,d)=>{t=t instanceof Array?t:[t],e?Promise.all(function({fileList:t,nonce:e,absolute:o=!1,isCrossoriginAnonymous:n}){var r=[];return t.forEach(t=>{r.push(c({filePath:t,nonce:e,absolute:o,isCrossoriginAnonymous:n}))}),r}({fileList:t,nonce:n,absolute:o,isCrossoriginAnonymous:r})).then(l).catch(d):async function({fileList:t,nonce:e,absolute:o=!1,isCrossoriginAnonymous:n}){for(var r=[],i=0;i<t.length;i++){var l=await c({filePath:t[i],nonce:e,absolute:o,isCrossoriginAnonymous:n});r.push(l)}return r}({fileList:t,nonce:n,absolute:o,isCrossoriginAnonymous:r}).then(l).catch(d)})},t.AuthorizationServiceMixin=l,t})({}),C="https://cdn1.ozone.ru/js/jquery/jquery-1.12.4.min.js",A={};e.Z=l().extend({name:"CustomHtml",inject:{isMobile:{default:!1}},props:{context:{type:String,default:""}},mixins:[d.CartGlobalStoreMixin,w,(0,h.composerStateMixin)({nonce:t=>t._get("browser.cspNonce")})],data:()=>({cartAddContext:null}),computed:{cartUrl:()=>v.CART,isInCart(){return Boolean(this.itemsHash&&this.itemsHash[this.id])},style(){if(this.widgetState.css&&this.widgetState.css.length)return`<style type="text/css">${this.widgetState.css}</style>`}},methods:{addInlineScript(content){var t=document.createElement("script");t.textContent=`try {${content}} catch (error) {console.log('Widget custom html error', error)}`,t.setAttribute("nonce",this.nonce),this.$refs.customHtml.appendChild(t)},async addToCart({detail:t}){this.isInCart||await r.registry.use(d.CartGlobalActions).updateItemsInCart({ids:[{id:t,spaceContext:this.context}],method:"post"}),this.$composerRouter.redirect(`${this.cartUrl}/#cartItem=${t}`)},loadFiles:f,async addFile(t){if(A[t])return!1;A[t]=await this.loadFiles({fileList:t,loadAsync:!0,absolute:!1,nonce:this.nonce,isCrossoriginAnonymous:!0}),t!==C&&this.$logger.info({message:"Load custom html script",zone:"customHtml",payload:{src:t}},{forceMode:!0})},async loadResources(){for(var content=this.widgetState,t=Array.isArray(content.resources)?content.resources:[],i=0;i<t.length;i++){var{type:e,value:o}=t[i];["script","style"].indexOf(e)>=0&&await this.addFile(o)}},async toogleModalLogin(){await this.showAuthForm()},showNotification({detail:t}){r.registry.use(m.NotificationsActions).createNewNotificationDeprecated(t)}},async mounted(){var content=this.widgetState,t=String(content.js),e=content.resources;this.cartAddContext=this.addToCart.bind(this),(t||e.length)&&(content.disableJquery||await this.addFile(C),await this.loadResources()),this.$refs.customHtmlContainer.addEventListener("addToCart",this.cartAddContext,!0),this.$refs.customHtmlContainer.addEventListener("toogleModalLogin",this.toogleModalLogin,!0),this.$refs.customHtmlContainer.addEventListener("notification",this.showNotification,!0),t.length&&await this.addInlineScript(t)},destroyed(){this.$refs.customHtmlContainer&&(this.$refs.customHtmlContainer.removeEventListener("addToCart",this.cartAddContext,!0),this.$refs.customHtmlContainer.removeEventListener("toogleModalLogin",this.toogleModalLogin,!0),this.$refs.customHtmlContainer.removeEventListener("notification",this.showNotification,!0))}}),n()}catch(t){n(t)}})},"8c85f":(t,e,o)=>{o.a(t,async(t,n)=>{try{o.r(e),o.d(e,{JQUERY_CDN:()=>c.N});var r=o("d4bbc"),c=o("3a91a"),l=o("695d8"),d=o.n(l),h=t([c]);c=(h.then?(await h)():h)[0];var component=d()(c.Z,r.s,r.x,!1,null,null,null);e.default=component.exports,n()}catch(t){n(t)}})},"3a91a":(t,e,o)=>{o.a(t,async(t,n)=>{try{o.d(e,{N:()=>r.N});var r=o("c3b82"),c=t([r]);r=(c.then?(await c)():c)[0],e.Z=r.Z,n()}catch(t){n(t)}})},d4bbc:(t,e,o)=>{o.d(e,{s:()=>n,x:()=>r});var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{directives:[{name:"qa",rawName:"v-qa:id",value:t.groupStatePath,expression:"groupStatePath",arg:"id"}],ref:"customHtml",class:["custom-html",t.isMobile?"mobile":"desktop"]},[o("div",{directives:[{name:"html-deprecated",rawName:"v-html-deprecated",value:t.style,expression:"style"}]}),t._v(" "),o("div",{directives:[{name:"html-deprecated",rawName:"v-html-deprecated",value:t.widgetState.html,expression:"widgetState.html"}],ref:"customHtmlContainer",staticClass:"custom-html__container"})])},r=[]}}]);