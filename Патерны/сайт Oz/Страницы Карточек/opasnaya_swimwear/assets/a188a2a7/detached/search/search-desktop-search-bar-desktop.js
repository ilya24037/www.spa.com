"use strict";(self.webpackChunkDetached_search=self.webpackChunkDetached_search||[]).push([["search-desktop-search-bar-desktop"],{"2df06":(t,e,r)=>{r.a(t,async(t,n)=>{try{var o=r("7bd70"),h=r.n(o),c=r("d46c4"),l=r("eb583"),d=r("baaf1"),v=r("655d4"),m=r("227f1"),f=r("ff884"),w=r("7cd3b"),y=r("5be4c"),x=r("16a5f"),S=r("ce27b"),I=r.n(S),k=r("a917b"),C=t([c,l,d,v,m,f,w,y,x]);[c,l,d,v,m,f,w,y,x]=C.then?(await C)():C;var B=r.n(y),O=r.n(x),T=["isValid"],_=["isValid"],D=["isValid"],P=["isValid"],{IconPhotoM:N,IconArrowLeft:j}=(L={functional:!0,name:"icMArrowLeftFilled",meta:{width:24,height:24,viewBox:"0 0 24 24"},render:(t,a)=>t("svg",Object.assign(Object.assign({},a.data),{},{attrs:Object.assign({xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24"},a.data.attrs),domProps:{innerHTML:'<path fill="currentColor" d="M11.509 5.39a1.5 1.5 0 0 1 .1 2.119L8.892 10.5H18.5a1.5 1.5 0 0 1 0 3H8.89l2.72 2.991a1.5 1.5 0 1 1-2.22 2.018l-5-5.5a1.5 1.5 0 0 1 0-2.018l5-5.5a1.5 1.5 0 0 1 2.119-.1"/>'}}))},(M={}).IconPhotoM={functional:!0,name:"icMPhotoFilled",meta:{width:24,height:24,viewBox:"0 0 24 24"},render:(t,e)=>t("svg",Object.assign(Object.assign({},e.data),{},{attrs:Object.assign({xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24"},e.data.attrs),domProps:{innerHTML:'<path fill="currentColor" d="M12 15a2 2 0 1 0 0-4 2 2 0 0 0 0 4"/><path fill="currentColor" d="M12.11 3c2.406 0 3.158.944 3.556 2.184C20.017 5.735 21 7.644 21 12.5c0 6-1.5 7.5-9 7.5s-9-1.5-9-7.5c0-4.941 1.017-6.83 5.565-7.343C8.965 3.93 9.724 3 12.11 3M8 9a1 1 0 1 0-2 0 1 1 0 0 0 2 0m4 8a4 4 0 1 0 0-8 4 4 0 0 0 0 8"/>'}}))},M.IconArrowLeft=L,M);e.Z={name:"SearchByImage",components:{DsIconButton:c.DsIconButton,DsTooltip:l.DsTooltip,DsDropdownWrapper:d.DsDropdownWrapper,DsDropdownContent:v.DsDropdownContent,DsImage:m.DsImage,AtomText:B(),DsInput:f.DsInput,DsButton:w.DsButton,Spinner:O()},mixins:[k.Dg,k.bi],inject:{trackerSend:{default:()=>()=>{}}},provide:{popoverZIndex:504},props:{buttonTrackingInfo:{type:Object,default:()=>({})},tooltipText:{type:String,default:"Поиск по фото"},dropdown:{type:Object,default:()=>({})},errorNotification:{type:Object,default:()=>{}},errorNotificationFileTypeInvalid:{type:Object,default:()=>{}},errorNotificationUrl:{type:Object,default:()=>{}},errorNotificationUrlInvalid:{type:Object,default:()=>({title:"Некорректная ссылка"})},errorNotificationMaxFileSizeExceeded:{type:Object,default:()=>{}},maxFileSize:{type:Number,default:void 0}},data:()=>({isDropdownOpened:!1,isTooltipShown:!1,isDropActive:!1,payload:{file:void 0,url:void 0},urlInvalid:!1,preview:void 0,isPreviewLoading:!1,IconPhotoM:N,IconArrowLeft:j}),computed:{errorNotifications(){return{errorNotification:this.errorNotification,errorNotificationFileTypeInvalid:this.errorNotificationFileTypeInvalid,errorNotificationUrl:this.errorNotificationUrl,errorNotificationUrlInvalid:this.errorNotificationUrlInvalid,errorNotificationMaxFileSizeExceeded:this.errorNotificationMaxFileSizeExceeded}},crop(){return I()(this,"dropdown.crop",{submitTitle:"Найти"})}},watch:{isDropdownOpened(t){t?this.focusDropdown():(this.cancelPreview(),this.payload={file:void 0,url:void 0},this.cancelSearchByImage())}},mounted(){this.onSearchCrossEvent(k.Td.OpenPickImageDialog,async({file:t}={})=>{t?await this.onDropFile({target:{files:[t]}})&&(this.isDropdownOpened=!0,this.focusDropdown()):(this.isDropdownOpened=!this.isDropdownOpened,this.focusDropdown())})},methods:{onButtonClick(){this.isDropdownOpened=!this.isDropdownOpened,this.isTooltipShown=!this.isDropdownOpened,this.focusDropdown(),this.buttonTrackingInfo&&this.buttonTrackingInfo.click&&this.trackerSend(this.buttonTrackingInfo.click)},onEsc(){this.isDropdownOpened=!1,this.isTooltipShown=!1},onEnter(){this.preview?this.onSubmit():this.$refs.fileInput&&this.$refs.fileInput.click()},onBack(){this.preview&&(this.cancelPreview(),this.payload={file:void 0,url:void 0},I()(this,"dropdown.crop.backTrackingInfo.click")&&this.trackerSend(this.dropdown.crop.backTrackingInfo.click)),this.focusDropdown()},onDrag(t){this.isDropActive=t},async onDropFile(t){this.isDropActive=!1;var e=((t.dataTransfer?t.dataTransfer.files:t.target.files)||[])[0];if(!e)return!1;var r=await this.prepareSearchByImagePayload({file:e},this.errorNotifications,this.maxFileSize),{isValid:n}=r,o=h()(r,T);return this.payload=o,n&&this.showPreview(),this.$refs.fileInput&&(this.$refs.fileInput.value=null),n},async onPaste(t){var e=t.clipboardData&&t.clipboardData.files&&t.clipboardData.files[0];if(e){this.file=e;var r=await this.prepareSearchByImagePayload({file:e},this.errorNotifications,this.maxFileSize),{isValid:n}=r,o=h()(r,_);return this.payload=o,void(n&&this.showPreview())}var c=t.clipboardData&&t.clipboardData.getData("text");if(c){var l=await this.prepareSearchByImagePayload({url:c},this.errorNotifications),{isValid:d}=l;o=h()(l,D);this.payload=o,d?this.showPreview():(this.urlInvalid=!0,this.focusUrlInput())}},async onEnterUrl(){if(this.payload.url){var t=await this.prepareSearchByImagePayload({url:this.payload.url},this.errorNotifications),{isValid:e}=t,r=h()(t,P);this.payload=r,e?this.showPreview():this.urlInvalid=!0}},showPreview(){this.preview!==this.payload.url&&(this.isPreviewLoading=!0),this.payload.file?this.preview=URL.createObjectURL(this.payload.file):this.payload.url&&(this.preview=this.payload.url),this.focusDropdown()},onPreviewError(t){this.handleSearchByImageError(this.errorNotification,t),this.cancelPreview()},cancelPreview(){this.$refs.previewImg&&this.$refs.previewImg.removeAttribute("src"),this.preview&&this.preview.startsWith("blob:")&&URL.revokeObjectURL(this.preview),this.preview=void 0,this.isPreviewLoading=!1,this.focusDropdown()},async onSubmit(){I()(this,"dropdown.crop.submitTrackingInfo.click")&&this.trackerSend(this.dropdown.crop.submitTrackingInfo.click),await this.doSearchByImage(this.payload,this.errorNotifications)&&(this.isDropdownOpened=!1)},focusDropdown(){this.$nextTick(()=>{this.$refs.dropdownContent&&this.$refs.dropdownContent.focus()})},focusUrlInput(){this.$nextTick(()=>{var input=this.$refs.urlInput&&this.$refs.urlInput.$el&&this.$refs.urlInput.$el.querySelector("input");input&&input.focus()})},onSpinnerView(){I()(this,"dropdown.spinnerTrackingInfo.view")&&this.trackerSend(this.dropdown.spinnerTrackingInfo.view)},onPreviewView(){I()(this,"dropdown.crop.trackingInfo.view")&&this.trackerSend(this.dropdown.crop.trackingInfo.view)}}},n()}catch(t){n(t)}var M,L})},20924:(t,e,r)=>{r.a(t,async(t,n)=>{try{var o=r("bcc5e"),h=r("d46c4"),c=r("ce27b"),l=r.n(c),d=r("a4221"),v=r("4ad74"),m=r("0af63"),f=r("ecabc"),w=r("abb9e"),y=r.n(w),x=r("ee5bb"),S=r.n(x),I=r("81521"),k=r("ab137"),C=r("16eb2"),B=r("c6181"),O=r("5793f"),T=r("a917b"),_=t([o,h,v,k,B,O]);[o,h,v,k,B,O]=_.then?(await _)():_;var{CrossIcon:D,SearchIcon:P}=(j={functional:!0,name:"icMSearchFilled",meta:{width:24,height:24,viewBox:"0 0 24 24"},render:(t,e)=>t("svg",Object.assign(Object.assign({},e.data),{},{attrs:Object.assign({xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24"},e.data.attrs),domProps:{innerHTML:'<path fill="currentColor" d="M17.892 15.064a8 8 0 1 0-2.828 2.828l2.522 2.522a2 2 0 1 0 2.828-2.828zM11 16a5 5 0 1 1 0-10 5 5 0 0 1 0 10"/>'}}))},(N={}).CrossIcon={functional:!0,name:"icMCrossFilledCompact",meta:{width:24,height:24,viewBox:"0 0 24 24"},render:(t,a)=>t("svg",Object.assign(Object.assign({},a.data),{},{attrs:Object.assign({xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24"},a.data.attrs),domProps:{innerHTML:'<path fill="currentColor" d="M7.44 7.44a1.5 1.5 0 0 1 2.12 0L12 9.878l2.44-2.44a1.5 1.5 0 0 1 2.12 2.122L14.122 12l2.44 2.44a1.5 1.5 0 0 1-2.122 2.12L12 14.122l-2.44 2.44a1.5 1.5 0 0 1-2.12-2.122L9.878 12l-2.44-2.44a1.5 1.5 0 0 1 0-2.12"/>'}}))},N.SearchIcon=j,N);e.Z=y().extend({name:"SearchBarWidget",components:{ContextChip:I.Z,DsIconButton:h.DsIconButton,OzTransition:o.OzTransition,SearchIcon:P,DsBadge:v.DsBadge,SearchByImage:B.Z,SearchByImageOnboarding:O.Z,PlaceholderRender:S()("block-vertical")},mixins:[k.U,m.DefaultAtomActionsMixin,T.bi,T.Dg],data:()=>({isSuggsVisible:!1,isSuggsOpen:!1,isSearchByImageOnboardingVisible:!1,hasInputFocus:!1,SearchIcon:P,CrossIcon:D}),computed:{searchByImage(){return l()(this.widgetState,"searchByImage")||{}},searchByImageOnboarding(){return l()(this.searchByImage,"onboarding")||{}},isSearchByImageOnboardingExists(){return this.searchByImageOnboarding.title&&!this.isSearchByImageOnboardingHidden},isSearchByImageEnabled(){return this.searchByImage&&this.searchByImage.buttonTrackingInfo}},provide(){return{trackingInfo:this.trackingInfo,onCancel:this.closeSuggs,getSuggestions:()=>{var text=this.text;this.keyboard.focusedItem&&(text=this.initialText),this.isDeletingSuggest=!0,this.getSuggestions(text),this.$refs.searchInput&&this.$refs.searchInput.focus()},highlightAutocomplete:this.highlightAutocomplete,isSearchDebugMode:this.isSearchDebugMode}},mounted(){document.activeElement===this.$refs.searchInput&&this.onFocus(),document.addEventListener("mousedown",this.onClickAction,{passive:(0,d.getSupportsPassive)(),capture:!0}),this.loadSuggestionsByPageType()},beforeDestroy(){document.removeEventListener("mousedown",this.onClickAction)},watch:{text(t="",e=""){t!==e&&(t.length<e.length&&!this.keyboard.active?this.showAutocomplete=!1:(this.highlightAutocomplete(this.autocomplete),this.showAutocomplete=!0),this.keyboard.active||(this.initialText=this.text,this.removeFocusedStyle(),this.getSuggestions(t)),this.reshowSuggests(),this.isSearchByImageOnboardingVisible=!this.initialText)},isSuggsOpen(t){this.manageTapTagSubscription(t,this.handleSearchTapTagsClick),this.isSearchByImageOnboardingVisible=t&&!this.text}},methods:{loadSuggestionsByPageType(){try{var t=(0,f.useComposerStore)(this).state._get("layoutTrackingInfo.pageType"),e=l()(this.widgetState,"abFeatures.uiPageTypesWithDisablingSuggestsPreload"),r=("string"==typeof e?e:"").replace(/['"]+/g,"").split(",").map(t=>t.trim());if(t&&r.includes(t))return}catch(t){this.$logger.error({exception:t,zone:"search"})}this.getSuggestions(this.text),this.afterRouteEnter(this.reset)},handleSearchTapTagsClick(text){this.text=text,this.$refs.searchInput&&this.$refs.searchInput.focus()},sendSearchEvent(t){var e=l()(this.context,"searchTrackingInfo.click");e&&this.trackerSend(e,{searchString:t})},closeSuggs(){this.toggleSuggs(!1)},onClickAction(t){t.target&&"function"==typeof t.target.closest&&(t.target.closest(".search-bar-wrapper")||1!==t.which)||this.toggleSuggs(!1)},onSubmit(){if(this.keyboard.focusedItem&&this.keyboard.focusedItem.action)this.keyboard.focusedItem.action();else{var t=this.$refs.searchInput.value||"",text=t.length>this.text.length?t:this.text,e=(0,C.kR)(text),r=()=>this.sendSearchEvent(text);this.widgetState.searchByPlaceholder&&!text&&this.context.is_global&&(e=this.global.placeholder,r=this.sendSearchByPlaceholderEvent);var link=(this.context.link||"").replace("{value}",encodeURIComponent(e));e&&(r(),this.$refs.searchInput.blur(),this.composerRouter.push(link))}},onFocus(){this.hasInputFocus=!0,this.showAutocomplete=!0,this.isDeletingSuggest||this.toggleSuggs(!0),this.isDeletingSuggest=!1,this.$nextTick(()=>{this.highlightAutocomplete(this.autocomplete)})},onBlur(){this.hasInputFocus=!1},reshowSuggests(){this.hasInputFocus&&!this.isSuggsOpen&&this.toggleSuggs(!0)},onKeyDown(t){"Enter"!==t.key&&(this.handleKeyboard(t),this.handleAutocomplete(t))},toggleSuggs(t){this.isSuggsOpen=t,t&&(this.isSuggsVisible=!0);var e=this.isSuggsOpen&&!this.hasSuggestLayout&&!this.action.request,r=this.isSuggsOpen&&this.hasSuggestLayout;e&&this.getSuggestions(this.text),r&&this.refreshSuggestionsState()},reset(){this.text=null,this.toggleSuggs(!1),this.$refs.searchInput.blur(),this.onBlur(),this.getSuggestions(this.text)},clear(){this.text="",this.$nextTick(async()=>{await this.action.request,this.$refs.searchInput.focus()})},onRemove(t){if(t.clearContext&&t.clearContext.behavior!==m.AtomActionBehaviour.Custom)this.onAtomAction(t.clearContext,t.clearContextTrackingInfo);else{this.searchContext=this.global,this.getSuggestions(this.text),this.reshowTapTags();var e=l()(t,"clearContextTrackingInfo.click");e&&this.trackerSend(e)}},onPaste(t){var e=t.clipboardData&&t.clipboardData.files&&t.clipboardData.files[0];e&&this.isSearchByImageEnabled&&!this.text&&(this.SearchRxStore.dispatch(T.Td.OpenPickImageDialog,{file:e}),t.preventDefault())},sendSearchByPlaceholderEvent(){var t=l()(this.global,"searchByPlaceholderTrackingInfo.click");t&&this.trackerSend(t)},setShowContextPopup(){this.widgetState.urlSearchContextPopup&&(this.onCreateContextSubscribe(),this.$composerRouter.push(this.widgetState.urlSearchContextPopup,{contextOptions:{notCentered:!0}}))},handleClickSearchBar(t){this.isSuggsOpen?this.handleAutocomplete(t):this.reshowSuggests()}}}),n()}catch(t){n(t)}var N,j})},"12ec7":(t,e,r)=>{r.d(e,{M:()=>n,t:()=>o});var n=({autocomplete:t,text,inputElement:e,next:r})=>{if(text&&t&&e.selectionEnd===text.length){var n=text.toLowerCase().trimLeft(),o=(t||"").toLowerCase();if(o.startsWith(n)&&n!==o){var h=text.length,c=`${text}${o.slice(text.length)}`.length;r(()=>{e.setRangeText((t||"").slice(n.length),h,c,"select")})}else e.setSelectionRange(-1,-1)}},o=({event:t,inputElement:e,text,next:r})=>{var n=e&&e.value,o=["ArrowLeft","ArrowRight"].includes(t.code)||"click"===t.type;if(!n||!o||text===e.value)return"";if(text){var h=text.length;r(()=>{e.focus(),"ArrowLeft"===t.code&&(e.selectionEnd=h+1)})}return e.value}},a2979:(t,e,r)=>{r.a(t,async(t,n)=>{try{r.d(e,{K:()=>h.K,Lz:()=>h.Lz,MC:()=>o.M,ND:()=>h.ND,j9:()=>h.j9,p5:()=>h.p5,r_:()=>h.r_,tc:()=>o.t});var o=r("12ec7"),h=r("accf2"),c=t([h]);h=(c.then?(await c)():c)[0],n()}catch(t){n(t)}})},accf2:(t,e,r)=>{r.a(t,async(t,n)=>{try{r.d(e,{K:()=>v,Lz:()=>d,ND:()=>l,j9:()=>y,p5:()=>w,r_:()=>m});var o=r("4668f"),h=r("af4a4"),c=t([h]);h=(c.then?(await c)():c)[0];var l=t=>({up:"ArrowUp"===t.code||t.shiftKey&&"Tab"===t.code,down:"ArrowDown"===t.code||"Tab"===t.code,right:"ArrowRight"===t.code,left:"ArrowLeft"===t.code}),d=t=>{t.flat().forEach(t=>t.node.removeAttribute(o.KO.FOCUSED))},v=t=>t.flat().findIndex(t=>t.node.hasAttribute(o.KO.FOCUSED)),m=(t,e,r)=>{var{up:n,down:o,right:h,left:c}=e,l=r,d=t.flat(),v=f(t,l),m=Array.isArray(v);if(!m&&(c||h))return v;var w=-1,y=t[t.length-1].flatIndex;if(m){if(w=v[0].flatIndex,y=v[v.length-1].flatIndex,n)return d[l=w-1];if(o)return d[l=y+1];l=c?l-1:l+1}else{var x=n?l-1:l+1,S=f(t,x);l=Array.isArray(S)?S[0].flatIndex:x}return l>y&&(l=w),l<w&&(l=y),d[l]},f=(t,i)=>t.find(element=>element.flatIndex===i||Array.isArray(element)&&element.some(t=>t.flatIndex===i)),w=(t,text)=>{if(t)return t.overrideText?t.text.trim():(0,h.r1)(text,t.text)},y=t=>t.reduce((t,e,r)=>{var n=!e.hasAttribute(o.KO.OVERRIDE),h=t[t.length-1],c={flatIndex:r,text:(e.querySelector(`[${o.KO.TEXT}]`)||e).getAttribute(o.KO.TEXT)||"",overrideText:"false"!==e.getAttribute(o.KO.OVERRIDE),node:e,action:n?e.click.bind(e):void 0};return n?t.push(c):Array.isArray(h)?h.push(c):t.push([c]),t},[]);n()}catch(t){n(t)}})},"16eb2":(t,e,r)=>{r.d(e,{PL:()=>d,kR:()=>m,op:()=>v});var n=r("ce27b"),o=r.n(n),h=r("79a44"),c=r("f52fa"),l=r("ecabc"),d="/modal/search-bar";async function v(){var{requestID:t,isPrefetched:e=!1,layoutTrackingInfo:r}=await(0,l.useComposerStore)(this).state;if(t){var n=o()(r,"pageType");if(["category","category/brand","category/landing","category/tag","search","highlight","classified_category","classified_highlight","classified_search","person","seria","publisher","brand"].includes(n)){var d=async(r="")=>{this&&e&&(this.prefetchedStatus="page was prefetched"+r),await h.registry.use(c.ComposerService).actionPost({name:"registerSearchEvent",data:{requestId:t,isPrefetched:e}})};document.prerendering?document.addEventListener("prerenderingchange",()=>d(" by Speculation"),{once:!0}):await d()}}}var m=t=>(t=(t||"").trim()).length>1?t:null},ab137:(t,e,r)=>{r.a(t,async(t,n)=>{try{r.d(e,{U:()=>B});var o=r("ce27b"),h=r.n(o),c=r("79a44"),l=r("f52fa"),d=r("5d94a"),v=r("da2e8"),m=r("ecabc"),f=r("d0725"),w=r.n(f),y=r("a2979"),x=r("af4a4"),S=r("16eb2"),I=r("a917b"),k=r("4668f"),C=t([y,x]);[y,x]=C.then?(await C)():C;var B={mixins:[w(),I.Dg],data:()=>({inputValue:null,suggsPlaceholders:[{name:"default",widgets:[]}],action:{request:null,payload:null,response:void 0},keyboard:{active:!1,focusedItem:null,items:[]},searchContext:null,initialText:"",autocomplete:void 0,showAutocomplete:!1,isDeletingSuggest:!1,isTapTagsVisible:!0,prefetchedStatus:""}),created(){this.searchContext=this.widgetState.context},mounted(){S.op.call(this),this.afterRouteEnter(()=>{this.searchContext=this.widgetState.context,this.inputValue=this.widgetState.text,this.initialText=this.text}),this.initialText=this.text},computed:{suggestWidgets(){return h()(this.suggsPlaceholders,"[0].widgets")||[]},hasSuggestLayout(){return!!this.suggestWidgets.length},text:{get(){return null!==this.inputValue?this.inputValue:this.widgetState.text},set(t){this.inputValue=t}},context(){return this.searchContext||this.global||{}},contextTitle(){return this.context.context_title},hasContextChip(){return!this.context||!this.context.hide_context},global(){return this.widgetState.global},lexems(){return this.widgetState.lexems||{}},cssProps(){var t="true"===h()(this.widgetState,"abFeatures.uiHeaderB2BRedesign");return{"--search-bar-main-color":(0,v.getColorByNameOrHex)(t?"--bgPrimaryInverted":"--bgActionPrimary"),"--search-bar-hover-color":(0,v.getColorByNameOrHex)(t?"--bgPrimaryInverted":"--graphicActiveActionPrimary")}},isSearchDebugMode(){return"true"===h()(this,"widgetState.abFeatures.uiSearchDebugMode")}},methods:{getUrl:({text,currentUrl:t,searchUrl:e="searchSuggestions"})=>"/"+e+t.replace("{value}",encodeURIComponent(text)),async getSuggestions(t=""){var e={text:t.replace(/\s+/g," ")||"",currentUrl:this.context&&this.context.link||`${location.pathname}${location.search}`,searchUrl:this.context.search_action_url},r=JSON.stringify(e);if(this.action.payload!==r||this.isDeletingSuggest){if(this.action.request&&this.action.request.cancel(),this.isDeletingSuggest||(this.keyboard.focusedItem=null),this.$refs.suggsWrapper)this.$refs.suggsWrapper.querySelectorAll(".suggestions-item").forEach(t=>t.classList.remove("focused"));this.action.payload=r,this.action.request=c.registry.use(l.ComposerService).jsonGet({url:this.getUrl(e),payload:{}}),this.dispatchSearchContext(t||"");try{var n=await this.action.request,{verticalInfo:o}=n;o&&"object"==typeof o&&(0,m.useComposerStore)(this).setVerticalInfo(o),this.action.response=n.widgetStates||null,setTimeout(async()=>{n.widgetStates&&c.registry.use(d.ClientWidgetStates).next(n.widgetStates),this.suggsPlaceholders=[{name:"default",widgets:n.layout||[]}]},10)}catch(t){this.$logger.warning({message:"Unable to get suggestions",exception:t,zone:"search"})}this.action.request=null,this.action.payload=null,this.keyboard.items=[]}},refreshSuggestionsState(){this.action.response&&c.registry.use(d.ClientWidgetStates).next(this.action.response)},dispatchSearchContext(text){var t=Object.assign(Object.assign({},this.context),{},{query:null!=text?text:this.text,initialText:this.initialText});this.SearchRxStore.dispatch(I.Td.SearchContext,{context:t})},manageTapTagSubscription(t,e){this.tapTagsTextSubscription&&this.tapTagsTextSubscription.unsubscribe(),t&&(this.tapTagsTextSubscription=this.onSearchCrossEvent(I.Td.TapTagsText,({text})=>e(text)))},onCreateContextSubscribe(){this.onSearchCrossEvent(I.Td.SearchContext,({context:t})=>this.searchContext=t),this.onSearchCrossEvent(I.Td.CloseContextPopup,({isClosed:t})=>{t&&(this.SearchRxStore.dispatch(I.Td.CloseContextPopup,{isClosed:!1}),this.closeConnection(),this.context.is_global||(this.getSuggestions(this.text),this.reshowTapTags()))})},onCreateSuggestsSubscribe(){this.suggestHistorySubscription=this.onSearchCrossEvent(I.Td.RemoveSuggestHistory,({isHistoryRemoved:t})=>{t&&(this.SearchRxStore.dispatch(I.Td.RemoveSuggestHistory,{isHistoryRemoved:!1}),this.suggestHistorySubscription&&this.suggestHistorySubscription.unsubscribe(),this.getSuggestions(this.text))})},reshowTapTags(){this.isSuggsOpen||(this.isTapTagsVisible=!1,this.$nextTick(()=>{this.isTapTagsVisible=!0}))},highlightAutocomplete(t){try{if(this.autocomplete=t,!this.showAutocomplete||this.keyboard.focusedItem)return;(0,y.MC)({text:this.text,autocomplete:this.autocomplete,inputElement:this.$refs.searchInput,next:this.$nextTick})}catch(t){this.$logger.error({exception:t,zone:"search"})}},handleAutocomplete(t){if(!(this.keyboard.active&&this.keyboard.focusedItem)&&this.text===this.initialText){var text=(0,y.tc)({event:t,text:this.text,inputElement:this.$refs.searchInput,next:this.$nextTick});text&&(this.text=text)}},handleKeyboard(t){var e,r=(0,y.ND)(t);if(Object.values(r).some(t=>t)&&this.$refs.islandContainer){if(!this.isSuggsOpen&&(r.left||r.right))return t.preventDefault(),void this.reshowSuggests();if(this.prepareKeyboardItems(),this.keyboard.items.length){var n=(0,y.K)(this.keyboard.items);this.keyboard.focusedItem=(0,y.r_)(this.keyboard.items,r,n),this.reshowSuggests(),n!==(null!=(e=(this.keyboard.focusedItem||{}).flatIndex)?e:-1)&&(this.removeFocusedStyle(),t.preventDefault(),this.keyboard.focusedItem?this.handleFocusItem():this.handleFocusByKeyboard())}}},removeFocusedStyle(){return(0,y.Lz)(this.keyboard.items)},prepareKeyboardItems(){if(!this.keyboard.items.length){var t=(0,x.i$)(this.$refs.islandContainer,`[${k.KO.ITEM}]`);this.keyboard.items=(0,y.j9)(t)}},handleFocusByKeyboard(){var input=this.$refs.searchInput||{};this.keyboard.active=!0,this.text=this.initialText,input.selectionStart=(this.text||"").length,this.$nextTick(()=>{this.highlightAutocomplete(this.autocomplete),this.keyboard.active=!1})},handleFocusItem(){if(this.keyboard.focusedItem){var input=this.$refs.searchInput||{},text=(0,y.p5)(this.keyboard.focusedItem,this.initialText);this.keyboard.focusedItem.node.setAttribute(k.KO.FOCUSED,""),this.keyboard.active=!0,text&&(this.text=text),input.selectionStart=this.text.length,this.$nextTick(()=>{this.keyboard.active=!1})}}}};n()}catch(t){n(t)}})},81521:(t,e,r)=>{r.d(e,{Z:()=>m});var n,o,{CloseRound:h,DropDown:c}=(o={functional:!0,name:"icSDropdownFilled",meta:{width:16,height:16,viewBox:"0 0 16 16"},render:(t,e)=>t("svg",Object.assign(Object.assign({},e.data),{},{attrs:Object.assign({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16"},e.data.attrs),domProps:{innerHTML:'<path fill="currentColor" d="m8.784 10.339 2.207-2.412c.668-.731.345-1.097-.858-1.097H5.859c-1.204 0-1.49.439-.887 1.097l2.207 2.412c.802.877.802.877 1.605 0"/>'}}))},(n={}).CloseRound={functional:!0,name:"icSCancelFilled",meta:{width:16,height:16,viewBox:"0 0 16 16"},render:(t,e)=>t("svg",Object.assign(Object.assign({},e.data),{},{attrs:Object.assign({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16"},e.data.attrs),domProps:{innerHTML:'<path fill="currentColor" d="M8 16c4.964 0 8-3.036 8-8s-3.036-8-8-8-8 3.036-8 8 3.036 8 8 8M6.85 5.594 8 6.743l1.15-1.15a.889.889 0 1 1 1.256 1.258L9.257 8l1.15 1.15a.889.889 0 1 1-1.258 1.256L8 9.257l-1.15 1.15a.889.889 0 1 1-1.256-1.258L6.743 8l-1.15-1.15a.889.889 0 0 1 1.258-1.256"/>'}}))},n.DropDown=o,n),l={name:"ContextChip",components:{CloseRound:h,DropDown:c},props:{context:{type:Object,default:()=>({})},title:{type:String,default:""}},computed:{isContext(){return!this.context||!1===this.context.is_global}},methods:{onContextChipClick(){this.context.is_global&&this.$emit("setShowContextPopup")},onContextIconClick(){this.context.is_global?this.$emit("setShowContextPopup"):this.$emit("onRemove",this.context)}}},d={contextChipIcon:"r3t_31",contextChip:"tr3_31",active:"t3r_31",contextTitle:"rt4_31",activeContextTitle:"r4t_31",forceContextTitle:"tr4_31"},v=r("695d8");var m=r.n(v)()(l,function(){var t,e,r,n=this,o=n.$createElement,h=n._self._c||o;return h("div",{directives:[{name:"qa",rawName:"v-qa",value:{id:"context-chip",context:n.title},expression:"{\n    id: 'context-chip',\n    context: title\n  }"}],ref:"contextChip",class:[n.$style.contextChip,(t={},t[n.$style.active]=n.isContext,t)],on:{click:n.onContextChipClick}},[h("span",{class:[n.$style.contextTitle,"tsBody400Small",(e={},e[n.$style.activeContextTitle]=n.isContext,e),(r={},r[n.$style.forceContextTitle]=n.context.force_context,r)],attrs:{title:n.title}},[n._v("\n    "+n._s(n.title)+"\n  ")]),n._v(" "),n.context.force_context?n._e():h("span",{class:n.$style.contextChipIcon,on:{click:function(t){return t.stopPropagation(),n.onContextIconClick.apply(null,arguments)}}},[n.isContext?h("CloseRound",{directives:[{name:"qa",rawName:"v-qa:id",value:"disable-context",expression:"'disable-context'",arg:"id"}]}):h("DropDown")],1)])},[],!1,function(t){this.$style=d.locals||d},null,null).exports},c6181:(t,e,r)=>{r.a(t,async(t,n)=>{try{var o=r("1a053"),h=r("4fb5d"),c=r("34861"),l=r("695d8"),d=r.n(l),v=t([h]);function m(t){this.$style=c.Z.locals||c.Z}h=(v.then?(await v)():v)[0];var component=d()(h.Z,o.s,o.x,!1,m,null,null);e.Z=component.exports,n()}catch(f){n(f)}})},f6eb6:(t,e,r)=>{r.a(t,async(t,n)=>{try{r.r(e);var o=r("6e9d5"),h=r("3df1d"),c=r("aafbe"),l=r("695d8"),d=r.n(l),v=t([h]);function m(t){this.$style=c.Z.locals||c.Z}h=(v.then?(await v)():v)[0];var component=d()(h.Z,o.s,o.x,!1,m,null,null);e.default=component.exports,n()}catch(f){n(f)}})},"00bd3":(t,e,r)=>{r.d(e,{Z:()=>n});var n={searchByImageOnboarding:"rt2_31",image:"r2t_31",title:"tr2_31",badge:"t2r_31",cross:"rt3_31"}},34861:(t,e,r)=>{r.d(e,{Z:()=>n});var n={button:"t4r_31",active:"rt5_31",dropdownContent:"r5t_31",form:"tr5_31",dropActive:"t5r_31",image:"rt6_31",hint:"r6t_31",mimeTypes:"tr6_31",dropZone:"t6r_31",urlForm:"rt7_31",urlFormInvalid:"r7t_31",input:"tr7_31",preview:"t7r_31",actions:"rt8_31",submit:"r8t_31",spinner:"tr8_31",paranja:"t8r_31"}},aafbe:(t,e,r)=>{r.d(e,{Z:()=>n});var n={wrapper:"rt9_31",isSuggsOpen:"r9t_31",islandContainer:"tr9_31",tapTagsWrapper:"t9r_31",form:"ru_31",inputWrapper:"ur_31",inputContainer:"ru0_31",searchInput:"r0u_31",clear:"ur0_31",searchByImage:"u0r_31",searchButton:"ru1_31",fadedOverlay:"r1u_31",suggestionsContainer:"ur1_31",suggestions:"u1r_31",searchByImageOnboardingShown:"ru2_31",badge:"r2u_31",searchByImageHidden:"ur2_31",searchByImageOnboarding:"u2r_31"}},"4fb5d":(t,e,r)=>{r.a(t,async(t,n)=>{try{var o=r("2df06"),h=t([o]);o=(h.then?(await h)():h)[0],e.Z=o.Z,n()}catch(t){n(t)}})},"3df1d":(t,e,r)=>{r.a(t,async(t,n)=>{try{var o=r("20924"),h=t([o]);o=(h.then?(await h)():h)[0],e.Z=o.Z,n()}catch(t){n(t)}})},"1a053":(t,e,r)=>{r.d(e,{s:()=>n,x:()=>o});var n=function(){var t,e=this,r=e.$createElement,n=e._self._c||r;return n("DsDropdownWrapper",{attrs:{placement:"bottom","mount-to":".search-bar-wrapper","popper-transision":"opacity 0.1s","is-flip":!0,"min-width":"424px","max-width":"424px","top-offset":8,radius:40,"force-show":e.isDropdownOpened},on:{clickOutside:function(t){e.isDropdownOpened=!1}},scopedSlots:e._u([{key:"dropdown",fn:function(){return[n("DsDropdownContent",{attrs:{type:"content",radius:40,"max-height":"calc(100vh - 170px)"},scopedSlots:e._u([{key:"content",fn:function(){var t,r;return[n("div",{directives:[{name:"qa",rawName:"v-qa:id",value:"search-by-image-dropdown",expression:"'search-by-image-dropdown'",arg:"id"}],ref:"dropdownContent",class:e.$style.dropdownContent,attrs:{tabindex:-1},on:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.onEsc.apply(null,arguments)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onEnter.apply(null,arguments)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"backspace",void 0,t.key,void 0)?null:e.onBack.apply(null,arguments)}],paste:e.onPaste}},[e.preview?e._e():n("div",{class:[e.$style.form,(t={},t[e.$style.dropActive]=e.isDropActive,t[e.$style.requestPending]=e.isSearchByImagePending,t)],on:{click:function(t){return e.$refs.fileInput.click()}}},[e.dropdown.image?n("DsImage",{class:e.$style.image,attrs:{src:e.dropdown.image,"use-cdn":!0,size:200}}):e._e(),e._v(" "),n("div",{class:[e.$style.hint]},[e._l(e.dropdown.text,function(text,t){return n("AtomText",e._b({key:t},"AtomText",text,!1))}),e._v(" "),n("br"),e._v(" "),n("div",{class:["tsBody300XSmall",e.$style.mimeTypes]},[e._v("\n                "+e._s(e.searchByImageMimeTypes.map(function(t){return t.split("/").pop()}).join(", "))+"\n              ")])],2),e._v(" "),n("input",{ref:"fileInput",attrs:{accept:e.searchByImageMimeTypes.join(","),type:"file",hidden:""},on:{change:function(t){return e.onDropFile(t)}}}),e._v(" "),n("div",{class:e.$style.dropZone,on:{dragenter:function(t){return t.preventDefault(),e.onDrag(!0)},dragover:function(t){return t.preventDefault(),e.onDrag(!0)},dragleave:function(t){return t.preventDefault(),e.onDrag(!1)},drop:function(t){return t.preventDefault(),t.stopPropagation(),e.onDropFile(t)}}}),e._v(" "),e.dropdown.urlForm?n("div",{class:[e.$style.urlForm,(r={},r[e.$style.urlFormInvalid]=e.urlInvalid,r)],on:{click:function(t){t.stopPropagation()},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.stopPropagation(),e.onEnterUrl.apply(null,arguments))}}},[n("DsInput",{directives:[{name:"qa",rawName:"v-qa:id",value:"search-by-image-url-input",expression:"'search-by-image-url-input'",arg:"id"}],ref:"urlInput",class:e.$style.input,attrs:{placeholder:e.dropdown.urlForm.placeholder,caption:e.urlInvalid?e.errorNotificationUrlInvalid.title:void 0,status:e.urlInvalid?"error":void 0,"has-clear-button":Boolean(e.payload.url),size:"500"},on:{input:function(t){e.urlInvalid=!1},keyup:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"backspace",void 0,t.key,void 0))return null;t.stopPropagation()}},model:{value:e.payload.url,callback:function(t){e.$set(e.payload,"url",t)},expression:"payload.url"}})],1):e._e()],1),e._v(" "),e.preview?n("div",{directives:[{name:"detect-viewport",rawName:"v-detect-viewport",value:{callback:e.onPreviewView},expression:"{\n              callback: onPreviewView,\n            }"}],class:e.$style.preview},[n("img",{directives:[{name:"qa",rawName:"v-qa:id",value:"search-by-image-preview-img",expression:"'search-by-image-preview-img'",arg:"id"}],ref:"previewImg",attrs:{alt:"search-by-image-preview-img",src:e.preview},on:{load:function(t){e.isPreviewLoading=!1},error:e.onPreviewError}}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.isPreviewLoading,expression:"isPreviewLoading"}],class:e.$style.spinner},[n("Spinner",{directives:[{name:"qa",rawName:"v-qa:id",value:"search-by-image-preview-spinner",expression:"'search-by-image-preview-spinner'",arg:"id"}]})],1),e._v(" "),n("div",{class:e.$style.actions},[n("DsIconButton",{directives:[{name:"qa",rawName:"v-qa:id",value:"search-by-image-back",expression:"'search-by-image-back'",arg:"id"}],attrs:{theme:"actionSecondary",type:"button",icon:e.IconArrowLeft},on:{click:function(t){return t.stopPropagation(),e.onBack.apply(null,arguments)}}}),e._v(" "),n("DsButton",{directives:[{name:"qa",rawName:"v-qa:id",value:"search-by-image-submit",expression:"'search-by-image-submit'",arg:"id"}],class:e.$style.submit,attrs:{title:e.crop.submitTitle,type:"button"},on:{click:e.onSubmit}})],1)]):e._e(),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.isSearchByImagePending,expression:"isSearchByImagePending"}],class:e.$style.paranja},[n("Spinner",{directives:[{name:"qa",rawName:"v-qa:id",value:"search-by-image-spinner",expression:"'search-by-image-spinner'",arg:"id"},{name:"detect-viewport",rawName:"v-detect-viewport",value:{callback:e.onSpinnerView},expression:"{\n                callback: onSpinnerView,\n              }"}],class:e.$style.spinner})],1)])]},proxy:!0}])})]},proxy:!0}])},[n("DsTooltip",{attrs:{title:e.tooltipText,"is-show":e.isTooltipShown,trigger:"manual",size:"hug",options:{mountTo:"body"}}},[n("DsIconButton",{directives:[{name:"qa",rawName:"v-qa:id",value:"search-by-image",expression:"'search-by-image'",arg:"id"}],class:[e.$style.button,(t={},t[e.$style.active]=e.isDropdownOpened,t)],attrs:{icon:e.IconPhotoM,theme:"custom",type:"button"},on:{click:function(t){return t.stopPropagation(),e.onButtonClick.apply(null,arguments)},mouseover:function(t){e.isTooltipShown=!0},mouseout:function(t){e.isTooltipShown=!1}}})],1)],1)},o=[]},"6e9d5":(t,e,r)=>{r.d(e,{s:()=>n,x:()=>o});var n=function(){var t,e,r,n,o,h=this,c=h.$createElement,l=h._self._c||c;return l("div",{style:h.cssProps},[l("OzTransition",{attrs:{"only-fade":""}},[h.isSuggsOpen?l("div",{class:h.$style.fadedOverlay}):h._e()]),h._v(" "),l("div",{directives:[{name:"qa",rawName:"v-qa",value:{id:"searchBarDesktop"},expression:"{ id: 'searchBarDesktop' }"}],class:[h.$style.wrapper,"search-bar-wrapper",(t={},t[h.$style.isSuggsOpen]=h.isSuggsOpen,t)]},[l("form",{class:[h.$style.form,(e={},e[h.$style.isSuggsOpen]=h.isSuggsOpen,e)],attrs:{action:"/search"},on:{submit:function(t){return t.preventDefault(),h.onSubmit.apply(null,arguments)}}},[l("div",{class:h.$style.inputWrapper},[h.hasContextChip?l("ContextChip",{attrs:{context:h.context,title:h.contextTitle},on:{onRemove:h.onRemove,setShowContextPopup:h.setShowContextPopup}}):h._e(),h._v(" "),l("div",{class:h.$style.inputContainer},[l("input",{directives:[{name:"model",rawName:"v-model",value:h.text,expression:"text"},{name:"qa",rawName:"v-qa:id",value:"header-search-input",expression:"'header-search-input'",arg:"id"}],ref:"searchInput",class:[h.$style.searchInput,"tsBody500Medium"],attrs:{placeholder:h.context.placeholder,type:"text",name:"text",autocapitalize:"off",autocomplete:"off",autocorrect:"off",spellcheck:"false",maxlength:"255"},domProps:{value:h.text},on:{focus:h.onFocus,blur:h.onBlur,keyup:function(t){return!t.type.indexOf("key")&&h._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:h.toggleSuggs(!1)},keydown:h.onKeyDown,click:h.handleClickSearchBar,paste:h.onPaste,input:function(t){t.target.composing||(h.text=t.target.value)}}}),h._v(" "),h.text?l("DsIconButton",{directives:[{name:"qa",rawName:"v-qa:id",value:"header-search-clear",expression:"'header-search-clear'",arg:"id"}],class:h.$style.clear,attrs:{icon:h.CrossIcon,theme:"custom",type:"button"},on:{click:h.clear}}):h._e(),h._v(" "),h.isSearchByImageEnabled?l("SearchByImage",h._b({class:[h.$style.searchByImage,(r={},r[h.$style.searchByImageHidden]=h.text,r)]},"SearchByImage",h.searchByImage,!1)):h._e()],1)],1),h._v(" "),l("DsIconButton",{directives:[{name:"qa",rawName:"v-qa:id",value:"header-search-go",expression:"'header-search-go'",arg:"id"}],class:h.$style.searchButton,attrs:{icon:h.SearchIcon,type:"submit","aria-label":h.lexems.search,fill:""}}),h._v(" "),h.isSearchDebugMode&&h.prefetchedStatus?[l("no-ssr",[l("DsBadge",{class:h.$style.badge,attrs:{label:h.prefetchedStatus,size:"400",theme:"negativePrimary"}})],1)]:h._e()],2),h._v(" "),l("div",{ref:"islandContainer",class:h.$style.islandContainer},[l("div",{class:[h.$style.tapTagsWrapper,(n={},n[h.$style.isSuggsOpen]=h.isSuggsOpen,n)]},[h.isTapTagsVisible?l("PlaceholderRender",{directives:[{name:"show",rawName:"v-show",value:h.isSuggsOpen,expression:"isSuggsOpen"}],attrs:{placeholders:h.placeholders,place:"bottom"}}):h._e()],1),h._v(" "),l("div",{directives:[{name:"qa",rawName:"v-qa:id",value:"suggestions-container",expression:"'suggestions-container'",arg:"id"}],class:[h.$style.suggestionsContainer,(o={},o[h.$style.searchByImageOnboardingShown]=h.isSearchByImageOnboardingExists&&h.isSearchByImageOnboardingVisible,o)]},[l("SearchByImageOnboarding",h._b({directives:[{name:"show",rawName:"v-show",value:h.isSearchByImageOnboardingExists&&h.isSearchByImageOnboardingVisible,expression:"isSearchByImageOnboardingExists && isSearchByImageOnboardingVisible"}],class:h.$style.searchByImageOnboarding},"SearchByImageOnboarding",h.searchByImageOnboarding,!1)),h._v(" "),h.isSuggsVisible?l("PlaceholderRender",{directives:[{name:"show",rawName:"v-show",value:h.isSuggsOpen,expression:"isSuggsOpen"}],class:h.$style.suggestions,attrs:{placeholders:h.suggsPlaceholders}}):h._e()],1)])])],1)},o=[]}}]);