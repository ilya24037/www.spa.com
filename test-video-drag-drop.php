<?php

use App\Domain\Ad\Models\Ad;

require_once __DIR__ . '/vendor/autoload.php';
$app = require_once __DIR__ . '/bootstrap/app.php';
$kernel = $app->make(Illuminate\Contracts\Http\Kernel::class);
$request = Illuminate\Http\Request::capture();
$response = $kernel->handle($request);

echo "üé• –¢–ï–°–¢ DRAG&DROP –î–õ–Ø –í–ò–î–ï–û\n";
echo "===========================\n\n";

// –ù–∞–π–¥–µ–º —á–µ—Ä–Ω–æ–≤–∏–∫ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–∏–¥–µ–æ
$draft = Ad::find(70);
if (!$draft) {
    echo "‚ùå –ß–µ—Ä–Ω–æ–≤–∏–∫ ID 70 –Ω–µ –Ω–∞–π–¥–µ–Ω!\n";
    exit;
}

echo "üìã –ß–µ—Ä–Ω–æ–≤–∏–∫ –Ω–∞–π–¥–µ–Ω: ID {$draft->id}, Title: {$draft->title}\n";

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–µ –≤–∏–¥–µ–æ
$currentVideos = is_array($draft->video) ? $draft->video : [];
echo "üìπ –¢–µ–∫—É—â–∏–µ –≤–∏–¥–µ–æ: " . count($currentVideos) . " —à—Ç.\n";

if (count($currentVideos) < 2) {
    echo "\n‚ö†Ô∏è –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –≤–∏–¥–µ–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ drag&drop...\n";
    
    // –î–æ–±–∞–≤–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö URL –≤–∏–¥–µ–æ
    $testVideos = [
        '/storage/videos/test/video1.mp4',
        '/storage/videos/test/video2.mp4',
        '/storage/videos/test/video3.mp4'
    ];
    
    $draft->video = $testVideos;
    $draft->save();
    
    echo "‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã 3 —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤–∏–¥–µ–æ\n";
    $currentVideos = $testVideos;
} else {
    foreach ($currentVideos as $index => $video) {
        echo "  " . ($index + 1) . ". {$video}\n";
    }
}

echo "\nüìä –°–ò–ú–£–õ–Ø–¶–ò–Ø DRAG&DROP:\n";
echo "------------------------\n";

// –°–∏–º—É–ª–∏—Ä—É–µ–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –≤–∏–¥–µ–æ –Ω–∞ –ø–µ—Ä–≤–æ–µ –º–µ—Å—Ç–æ
if (count($currentVideos) >= 2) {
    echo "üéØ –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º –≤–∏–¥–µ–æ —Å –ø–æ–∑–∏—Ü–∏–∏ 2 –Ω–∞ –ø–æ–∑–∏—Ü–∏—é 1\n";
    echo "  –î–æ: \n";
    foreach ($currentVideos as $i => $v) {
        $marker = $i === 0 ? " [–ì–õ–ê–í–ù–û–ï]" : "";
        echo "    " . ($i + 1) . ". " . basename($v) . $marker . "\n";
    }
    
    // –°–∏–º—É–ª—è—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ reorderVideos
    $newVideos = $currentVideos;
    $fromIndex = 1; // –≤—Ç–æ—Ä–æ–µ –≤–∏–¥–µ–æ (–∏–Ω–¥–µ–∫—Å 1)
    $toIndex = 0;   // –ø–µ—Ä–≤–∞—è –ø–æ–∑–∏—Ü–∏—è (–∏–Ω–¥–µ–∫—Å 0)
    
    // –ò–∑–≤–ª–µ–∫–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏ –≤—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞ –Ω–æ–≤–æ–µ –º–µ—Å—Ç–æ
    $movedVideo = array_splice($newVideos, $fromIndex, 1)[0];
    array_splice($newVideos, $toIndex, 0, [$movedVideo]);
    
    echo "\n  –ü–æ—Å–ª–µ:\n";
    foreach ($newVideos as $i => $v) {
        $marker = $i === 0 ? " [–ì–õ–ê–í–ù–û–ï]" : "";
        echo "    " . ($i + 1) . ". " . basename($v) . $marker . "\n";
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    $draft->video = $newVideos;
    $draft->save();
    
    echo "\n‚úÖ –ü–æ—Ä—è–¥–æ–∫ –≤–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!\n";
} else {
    echo "‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ drag&drop\n";
}

echo "\nüéØ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ê:\n";
echo "-------------------\n";
echo "‚úÖ –§—É–Ω–∫—Ü–∏—è reorderVideos —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n";
echo "‚úÖ –ü–æ—Ä—è–¥–æ–∫ –≤–∏–¥–µ–æ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å\n";
echo "‚úÖ –ü–µ—Ä–≤–æ–µ –≤–∏–¥–µ–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≥–ª–∞–≤–Ω—ã–º\n";

echo "\nüìå –ö–ê–ö –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–¢–¨ –í –ë–†–ê–£–ó–ï–†–ï:\n";
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: spa.test/ads/70/edit\n";
echo "2. –î–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç\n";
echo "3. –ù–∞–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –Ω–∞ –≤–∏–¥–µ–æ - –∫—É—Ä—Å–æ—Ä –∏–∑–º–µ–Ω–∏—Ç—Å—è –Ω–∞ 'move'\n";
echo "4. –ó–∞–∂–º–∏—Ç–µ –∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –≤–∏–¥–µ–æ –Ω–∞ –Ω–æ–≤–æ–µ –º–µ—Å—Ç–æ\n";
echo "5. –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —Ü–µ–ª–µ–≤—É—é –ø–æ–∑–∏—Ü–∏—é –ø–æ—è–≤–∏—Ç—Å—è —Å–∏–Ω—è—è —Ä–∞–º–∫–∞\n";
echo "6. –û—Ç–ø—É—Å—Ç–∏—Ç–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞\n";
echo "7. –ü–µ—Ä–≤–æ–µ –≤–∏–¥–µ–æ –±—É–¥–µ—Ç –æ—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ '–ì–ª–∞–≤–Ω–æ–µ –≤–∏–¥–µ–æ'\n";