<?php

require_once __DIR__ . '/vendor/autoload.php';
$app = require_once __DIR__ . '/bootstrap/app.php';
$kernel = $app->make(Illuminate\Contracts\Http\Kernel::class);
$kernel->handle($request = Illuminate\Http\Request::capture());

use App\Domain\Ad\Models\Ad;
use App\Domain\User\Models\User;
use App\Domain\Ad\Services\DraftService;

echo "üéØ –¢–ï–°–¢ –õ–û–ì–ò–ö–ò –í–ó–ê–ò–ú–û–ò–°–ö–õ–Æ–ß–ï–ù–ò–Ø –í FAQ\n";
echo "=====================================\n\n";

$user = User::where('email', 'anna@spa.test')->first();
if (!$user) {
    $user = User::first();
}

if ($user) {
    echo "üë§ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {$user->email} (ID: {$user->id})\n\n";
    
    $draftService = app(DraftService::class);
    
    // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ "–ù–µ—Ç" –∏—Å–∫–ª—é—á–∞–µ—Ç –¥—Ä—É–≥–∏–µ –æ–ø—Ü–∏–∏ –≤ faq_2
    echo "üìù –¢–µ—Å—Ç 1: –û–ø—Ü–∏—è '–ù–µ—Ç' –≤ –≤–æ–ø—Ä–æ—Å–µ –ø—Ä–æ –ª–∞—Å–∫–∏ (faq_2)\n";
    echo "---------------------------------------------------\n";
    
    $test1Data = [
        'user_id' => $user->id,
        'title' => '–¢–µ—Å—Ç –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–µ–Ω–∏—è FAQ',
        'service_provider' => ['women'],
        'clients' => ['men'],
        'phone' => '+79001234567',
        'geo' => ['lat' => 55.7558, 'lng' => 37.6173],
        'prices' => ['apartments_1h' => 5000],
        'services' => ['massage' => true],
        'photos' => [],
        'faq' => [
            'faq_2' => [1, 2, 3, 4] // –ù–∞–º–µ—Ä–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –æ–ø—Ü–∏–∏ –≤–∫–ª—é—á–∞—è "–ù–µ—Ç"
        ],
        'status' => 'draft'
    ];
    
    $draft1 = $draftService->saveOrUpdate($test1Data, $user, null);
    
    echo "‚ö†Ô∏è  –ü–æ–ø—ã—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –æ–ø—Ü–∏–∏ –≤–∫–ª—é—á–∞—è '–ù–µ—Ç':\n";
    echo "   –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: faq_2 = [1, 2, 3, 4]\n";
    echo "   –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ë–î: faq_2 = " . json_encode($draft1->faq['faq_2'] ?? []) . "\n";
    echo "   ‚ùó –ü—Ä–æ–±–ª–µ–º–∞: –°–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å –≤—Å–µ –æ–ø—Ü–∏–∏, –≤–∫–ª—é—á–∞—è –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ!\n\n";
    
    // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
    echo "üìù –¢–µ—Å—Ç 2: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ '–ù–µ—Ç' –≤ faq_2\n";
    echo "---------------------------------------------------\n";
    
    $test2Data = [
        'faq' => [
            'faq_2' => [4] // –¢–æ–ª—å–∫–æ –æ–ø—Ü–∏—è "–ù–µ—Ç"
        ]
    ];
    
    $draft2 = $draftService->saveOrUpdate($test2Data, $user, $draft1->id);
    
    echo "‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –æ–ø—Ü–∏–∏ '–ù–µ—Ç':\n";
    echo "   –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: faq_2 = [4]\n";
    echo "   –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ë–î: faq_2 = " . json_encode($draft2->faq['faq_2'] ?? []) . "\n\n";
    
    // –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è faq_3 (GFE)
    echo "üìù –¢–µ—Å—Ç 3: –û–ø—Ü–∏—è '–ù–µ—Ç' –≤ –≤–æ–ø—Ä–æ—Å–µ –ø—Ä–æ GFE (faq_3)\n";
    echo "---------------------------------------------------\n";
    
    $test3Data = [
        'faq' => [
            'faq_2' => [1, 2], // –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ –¥–ª—è faq_2
            'faq_3' => [1, 2, 3] // –¢–æ–ª—å–∫–æ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –æ–ø—Ü–∏–∏ –¥–ª—è faq_3
        ]
    ];
    
    $draft3 = $draftService->saveOrUpdate($test3Data, $user, $draft1->id);
    
    echo "‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö –æ–ø—Ü–∏–π GFE:\n";
    echo "   –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: faq_3 = [1, 2, 3]\n";
    echo "   –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ë–î: faq_3 = " . json_encode($draft3->faq['faq_3'] ?? []) . "\n\n";
    
    // –¢–µ—Å—Ç 4: –°–º–µ—à–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    echo "üìù –¢–µ—Å—Ç 4: –°–º–µ—à–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å '–ù–µ—Ç' –≤ faq_3\n";
    echo "---------------------------------------------------\n";
    
    $test4Data = [
        'faq' => [
            'faq_3' => [4] // –¢–æ–ª—å–∫–æ "–ù–µ—Ç" –¥–ª—è GFE
        ]
    ];
    
    $draft4 = $draftService->saveOrUpdate($test4Data, $user, $draft1->id);
    
    echo "‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ '–ù–µ—Ç' –¥–ª—è GFE:\n";
    echo "   –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: faq_3 = [4]\n";
    echo "   –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ë–î: faq_3 = " . json_encode($draft4->faq['faq_3'] ?? []) . "\n\n";
    
    // –û—á–∏—Å—Ç–∫–∞
    $draft1->delete();
    echo "üóëÔ∏è –¢–µ—Å—Ç–æ–≤—ã–π —á–µ—Ä–Ω–æ–≤–∏–∫ —É–¥–∞–ª–µ–Ω\n\n";
    
} else {
    echo "‚ùå –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ç–µ—Å—Ç–∞\n";
}

echo "‚ö†Ô∏è  –í–ê–ñ–ù–û–ï –ó–ê–ú–ï–ß–ê–ù–ò–ï:\n";
echo "=====================================\n";
echo "–õ–æ–≥–∏–∫–∞ –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–∞ FRONTEND –≤ Vue –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ.\n";
echo "Backend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ –µ—Å—Ç—å, –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–µ–Ω–∏—è.\n";
echo "–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ:\n";
echo "1. –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —á–µ—Ä–µ–∑ UI –ª–æ–≥–∏–∫–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n";
echo "2. –ü—Ä–∏ –ø—Ä—è–º–æ–º API –∑–∞–ø—Ä–æ—Å–µ –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã–µ –¥–∞–Ω–Ω—ã–µ\n\n";

echo "üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:\n";
echo "–î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ DraftService –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n";
echo "–≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏—Ö –æ–ø—Ü–∏–π –≤ FAQ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.\n";