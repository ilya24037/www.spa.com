(()=>{var e={197:(e,t,s)=>{"use strict";s.d(t,{a:()=>c});var i=s(152),r=window.__federation__.deps["@bx-fe/common-feature-notifications@1.3.0"]||{},o=s(143),a=s(44),n=s(471);class c extends i.AbstractActionsService{async checkItemsInFavorites(e){try{var{skus:t}=await this.container.resolve("SingletonRegistry").use(o.e).favoriteCheckItems({skus:e});return t.length&&t.every((t=>e.indexOf(t)>=0))}catch(e){return this.container.resolve("Logger").error({exception:e,zone:"favorites"}),Promise.resolve(!1)}}refreshFavoritesLists(){this.toggleEditMode(!1)}async refreshFavorites(e="/my/favorites/"){await this.container.resolve("SingletonRegistry").useByName("ComposerActions").getLayout({url:e}),this.dispatchGetCount()}setActiveCategory(){var e=this.container.resolve("ComposerStore").state._get("shared.favorites.filtersUrl","/"),t=e.indexOf("?"),s=t>-1?e.substring(t+1):"",i=new URLSearchParams(s).get("category")||0;this.container.resolve("SingletonRegistry").use(n.T).setCategoryId(Number(i))}async addItemsToList({skus:e,id:t}){try{return await this.container.resolve("SingletonRegistry").use(o.e).addItemsToList({skus:e,id:t}),Promise.resolve(!0)}catch(e){return this.container.resolve("Logger").error({exception:e,message:"favorites service error on add item to list",zone:"favorites"}),Promise.resolve(!1)}}async deleteList({ids:e}){try{return await this.container.resolve("SingletonRegistry").use(o.e).deleteList({ids:e}),Promise.resolve(!0)}catch(e){return this.container.resolve("Logger").error({exception:e,message:"favorites service error on remove list",zone:"favorites"}),Promise.resolve(!1)}}setItemsHash({items:e=[],value:t}){var s=e.reduce(((e,s)=>(e[s]=t,e)),{});this.container.resolve("SingletonRegistry").use(n.T).setSelectedItemsHash(s),this.container.resolve("SingletonRegistry").use(n.T).setFilteredItemsCount((e||[]).length)}async getFilteredFavoriteItems(){try{var e=this.container.resolve("ComposerStore").state._get("shared.favorites.filtersUrl","/").split("?")[1],t=e?`?${e}`:"",{items:s}=await this.container.resolve("SingletonRegistry").use(o.e).getItems(t);this.container.resolve("SingletonRegistry").use(n.T).setItemsWithPrice(s||[]),this.setItemsHash({items:s.map((e=>e.sku)),value:!1})}catch(e){this.container.resolve("Logger").error({exception:e,message:"favorites service error on get filtered skus",zone:"favorites"}),this.setItemsHash({})}}async getFavoriteItemsByListHash(e){try{var t=`?list=${e}`,{items:s}=await this.container.resolve("SingletonRegistry").use(o.e).getSharedItemsV2(t);this.container.resolve("SingletonRegistry").use(n.T).setItemsWithPrice(s||[])}catch(e){this.container.resolve("Logger").error({exception:e,message:"favorites service error on get list items by hash",zone:"favorites"}),this.container.resolve("SingletonRegistry").use(n.T).setItemsWithPrice([])}}async toggleEditMode(e){this.container.resolve("SingletonRegistry").use(n.T).setEditMode(e),this.container.resolve("SingletonRegistry").use(n.T).setAnalyticItems(),e?await this.getFilteredFavoriteItems():this.setItemsHash({}),this.container.resolve("SingletonRegistry").use(n.T).setCatalogEditMode(e)}toggleItemSelected({item:e}){var t=this.container.resolve("SingletonRegistry").use(n.T).state,{selectedItemsHash:s,analyticsItems:i}=t,r=!Object.hasOwnProperty.call(s,e.id)||!s[e.id],o=Object.keys(t.selectedItemsHash).filter((e=>t.selectedItemsHash[e])).length;this.container.resolve("SingletonRegistry").use(n.T).changeSelectedItemsHash({id:e.id,value:r}),o===i.length&&this.container.resolve("SingletonRegistry").use(n.T).updateAnalyticItems({item:e,addItem:r})}async toggleSelectAllItems(){var e=this.container.resolve("SingletonRegistry").use(n.T).state,t=this.container.resolve("SingletonRegistry").use(n.T).allSelected();t||0!==e.filteredItemsCount||await this.getFilteredFavoriteItems(),this.container.resolve("SingletonRegistry").use(n.T).setAnalyticItems(),this.setItemsHash({items:Object.keys(e.selectedItemsHash),value:!t})}async removeSelectedItems(){var e=this.container.resolve("SingletonRegistry").use(n.T).state;try{var t=this.container.resolve("ComposerStore").state._get("shared.favorites.listID",0),s=this.container.resolve("SingletonRegistry").use(n.T).selectedItems(),i=Object.assign({skus:s},t?{id:t}:{}),{analyticsItems:r,itemsWithPrice:a}=e;return t?await this.container.resolve("SingletonRegistry").use(o.e).removeItemsFromList(i):await this.container.resolve("SingletonRegistry").use(o.e).removeItems(i),await this.refreshFavorites("/my/favorites?list="+t),this.container.resolve("SingletonRegistry").use(n.T).setItemsWithPrice(a||[]),this.container.resolve("SingletonRegistry").use(n.T).setRemovedItems(s),this.container.resolve("SingletonRegistry").use(n.T).setAnalyticItems(r||[]),Promise.resolve(!0)}catch(e){return this.container.resolve("Logger").error({exception:e,message:"favorites service error on remove",zone:"favorites"}),Promise.resolve(!1)}finally{this.setItemsHash({})}}async restoreRemovedItems(){var e=this.container.resolve("SingletonRegistry").use(n.T).state.removedItems;if(!e.length)return Promise.resolve(!1);try{var t=this.container.resolve("ComposerStore").state._get("shared.favorites.listID",0),s=Object.assign({skus:e},t?{id:t}:{});return t?await this.container.resolve("SingletonRegistry").use(o.e).addItemsToList(s):await this.container.resolve("SingletonRegistry").use(o.e).addItems(s),this.refreshFavorites("/my/favorites?list="+this.container.resolve("ComposerStore").state._get("shared.favorites.listID",0)),Promise.resolve({listId:t})}catch(e){return this.container.resolve("Logger").error({exception:e,message:"favorites service error on add items",zone:"favorites"}),Promise.resolve(!1)}}dispatchSetCount(e=0,t="full"){this.container.resolve("SingletonRegistry").use(a.P).emit("FavoritesCount",{value:e,type:t})}async dispatchHandleFavorite(e,t="add",s=!1){try{var i;return i="add"===t?await this.apiHandleAdd(e):await this.apiHandleRemove(e),this.dispatchHandleFavoriteLocal(e,t,!0,s),i}catch(e){this.logError(e)}}dispatchHandleFavoriteLocal(e,t="add",s=!1,i=!1){if(Array.isArray(e)?e.forEach((e=>{this.container.resolve("SingletonRegistry").use(a.P).emit("Favorites",{id:`${e}`,type:t})})):this.container.resolve("SingletonRegistry").use(a.P).emit("Favorites",{id:e,type:t}),i&&this.dispatchNotification(t),s){var r=0,o="add"===t?1:-1;r=Array.isArray(e)?e.length*o:o,this.container.resolve("SingletonRegistry").use(a.P).emit("FavoritesCount",{value:r,type:"diff"})}}logError(e){this.container.resolve("Logger").error({exception:e,zone:"favorites"})}async dispatchGetCount(e=!0){try{var t=await this.apiGetCount();return e&&this.dispatchSetCount(t),t}catch(e){this.logError(e)}}dispatchNotification(e="add"){var t="add"===e?"Товар добавлен в избранное":"Товар удален из избранного";this.container.resolve("SingletonRegistry").use(r.NotificationsActions).createNewNotificationDeprecated({type:r.NotificationTypes.SUCCESS,content:t})}async apiGetCount(){var{count:e}=await this.container.resolve("SingletonRegistry").useByName("ComposerService").actionPost({name:"favoriteCountItems"});return e}async apiHandleAdd(e){return this.container.resolve("SingletonRegistry").useByName("ComposerService").actionPost({name:"v2/favoriteBatchAddItems",data:{skus:[Number(e)]}})}async apiHandleRemove(e){return this.container.resolve("SingletonRegistry").useByName("ComposerService").actionPost({name:"v2/favoriteBatchDeleteItems",data:{skus:[Number(e)]}})}}c.__serviceName="AbstractActionsService_FavoritesActions"},143:(e,t,s)=>{"use strict";s.d(t,{e:()=>r});var i=s(152);class r extends i.AbstractApiService{constructor(...e){super(...e),this.serviceName="favorites",this.servicePath="composer-api.bx/_action"}addItems(e){return this.fetch({method:"post",path:"/v2/favoriteBatchAddItems"},e)}removeItems(e){return this.fetch({method:"post",path:"/v2/favoriteBatchDeleteItems"},e)}favoriteCountItems(e){return this.fetch({method:"post",path:"/favoriteCountItems"},e)}favoriteCheckItems(e){return this.fetch({method:"post",path:"/favoriteCheckItems"},e)}getSkus(e){return this.fetch({method:"get",path:`/favoriteGetSkus/${e}`}).catch((()=>Promise.reject([])))}getItems(e){return this.fetch({method:"get",path:`/favoriteGetItems/${e}`}).catch((()=>Promise.reject({items:{}})))}getLists(){return this.fetch({method:"get",path:"/favoriteLists"}).catch((()=>Promise.reject([])))}createList(e){return this.fetch({method:"post",path:"/favoriteCreateList"},e).catch(this.rejectWithResponse("post","/favoriteCreateList"))}deleteList(e){return this.fetch({method:"post",path:"v2/favoriteDeleteList"},e)}renameList(e){return this.fetch({method:"post",path:"/favoriteRenameList"},e).catch(this.rejectWithResponse("post","/favoriteRenameList"))}addItemsToList(e){return this.fetch({method:"post",path:"/v2/favoriteListAdd"},e)}removeItemsFromList(e){return this.fetch({method:"post",path:"/favoriteListRemove"},e)}getListsBySku(e){return this.fetch({method:"post",path:"/favoriteListsBySku"},e)}saveSharedList(e){return this.fetch({method:"post",path:"/favoriteCopySharedList"},e)}getShareLink(e){return this.fetch({method:"post",path:"/favoriteShareList"},e)}getSharedItems(e){return this.fetch({method:"post",path:"/favoriteGetSharedItems"},e)}getSharedItemsV2(e){return this.fetch({method:"post",path:`/favoriteGetSharedItemsV2/${e}`},e).catch((()=>Promise.reject({items:[]})))}getListTitleSuggest(){return this.fetch({method:"get",path:"/favoriteSuggestListTitle"}).catch((()=>Promise.reject([])))}}r.__serviceName="AbstractApiService_FavoriteService"},44:(e,t,s)=>{"use strict";s.d(t,{P:()=>o});var i=window.__federation__.deps["@bx-fe/minirxjs"]||{},r=s(152);class o extends r.EventBus{get $favEvents(){return this.events$.pipe((0,i.filter)((e=>"Favorites"===e.name)))}get $favCountEvents(){return this.events$.pipe((0,i.filter)((e=>"FavoritesCount"===e.name)))}get $favListSelectProductEvents(){return this.events$.pipe((0,i.filter)((e=>"FavoriteListSelectProduct"===e.name)))}get $favTileEvents(){return this.events$.pipe((0,i.filter)((e=>"isTileOverlay"===e.name)))}$favEventsById(e){return this.$favEvents.pipe((0,i.filter)((t=>t.payload.id===e)))}}o.__serviceName="EventBus_FavoritesEvents"},885:(e,t,s)=>{"use strict";s.d(t,{r:()=>r});var i=s(471),r={data:()=>({categoryId:0,activeFilters:[],editMode:!1,removedItems:[],itemsWithPrice:[]}),computed:{getCategoryId(){return this.categoryId||0},getActiveFilters(){return this.activeFilters||[]}},created(){this.favoritesSubscription=this.$registry.use(i.T).onNextState((e=>{this.categoryId=e.categoryId,this.activeFilters=e.activeFilters,this.editMode=e.editMode,this.removedItems=e.removedItems,this.itemsWithPrice=e.itemsWithPrice}))},beforeDestroy(){this.favoritesSubscription&&this.favoritesSubscription.unsubscribe()}}},471:(e,t,s)=>{"use strict";s.d(t,{T:()=>r});var i=s(152);class r extends i.AbstractStoreService{getInitialState(){return{itemsHash:{},count:0,categoryId:0,editMode:!1,catalogEditMode:!1,selectedItemsHash:{},filteredItemsCount:0,removedItems:[],itemsWithPrice:[],activeFilters:[],analyticsItems:[]}}categoryId(){return this.state.categoryId||0}activeFilters(){return this.state.activeFilters||[]}selectedItems(){var{state:e}=this;return(0,i.isEmpty)(e.selectedItemsHash)&&(0,i.isEmpty)(e.itemsWithPrice)?[]:e.itemsWithPrice.reduce(((t,s)=>(e.selectedItemsHash[s.sku]&&t.push(s.sku),t)),[])}allSelected(){var{state:e}=this;return!(0,i.isEmpty)(e.selectedItemsHash)&&Object.keys(e.selectedItemsHash).every((t=>e.selectedItemsHash[t]))}setCategoryId(e){this.pushState((t=>{t.categoryId=e}))}setEditMode(e){this.pushState((t=>{t.editMode=e}))}setCatalogEditMode(e){this.pushState((t=>{t.catalogEditMode=e}))}setSelectedItemsHash(e={}){this.pushState((t=>{t.selectedItemsHash=e}))}changeSelectedItemsHash({id:e,value:t}){this.pushState((s=>{s.selectedItemsHash[e]=t}))}setFilteredItemsCount(e){this.pushState((t=>{t.filteredItemsCount=e}))}setRemovedItems(e=[]){this.pushState((t=>{t.removedItems=e}))}setItemsWithPrice(e=[]){this.pushState((t=>{t.itemsWithPrice=e}))}setActiveFilters(e=[]){this.pushState((t=>{t.activeFilters=e}))}setAnalyticItems(e=[]){this.pushState((t=>{t.analyticsItems=e}))}updateAnalyticItems({item:e,addItem:t}){this.pushState((s=>{var i=(s.analyticsItems||[]).findIndex((t=>!!t&&"object"==typeof t&&t.id===e.id));s.analyticsItems=i<0&&t?[...s.analyticsItems,e]:[...s.analyticsItems.slice(0,i),...s.analyticsItems.slice(i+1)]}))}}r.__serviceName="AbstractStoreService_FavoritesStore"},152:e=>{"use strict";e.exports=window.__federation__.deps["@bx-fe/platform-app-common"]||{}}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,s),o.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i,r={};i=r,Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"FavoritesActions",{get:()=>s(197).a}),Object.defineProperty(i,"FavoriteService",{get:()=>s(143).e}),Object.defineProperty(i,"FavoritesEvents",{get:()=>s(44).P}),Object.defineProperty(i,"FavoritesStore",{get:()=>s(471).T}),Object.defineProperty(i,"FavoritesStoreMixin",{get:()=>s(885).r}),window.__federation__.deps["@bx-fe/common-feature-favorites@1.2.2"]||(window.__federation__.deps["@bx-fe/common-feature-favorites@1.2.2"]=Object.defineProperties({},Object.getOwnPropertyDescriptors(r)))})();