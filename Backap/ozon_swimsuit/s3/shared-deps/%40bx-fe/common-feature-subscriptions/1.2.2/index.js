(()=>{var e={660:(e,t,s)=>{"use strict";s.d(t,{q:()=>n});var i=s(152),r=s(443);class n extends i.AbstractActionsService{toggleUserSubscribeModal({status:e,type:t}){this.container.resolve("SingletonRegistry").use(r.$).setVisibility(e),this.container.resolve("SingletonRegistry").use(r.$).setSubscriptionType(t)}hideModal(){this.container.resolve("SingletonRegistry").use(r.$).setVisibility(!1),this.container.resolve("SingletonRegistry").use(r.$).setSubscriptionType(null)}}n.__serviceName="AbstractActionsService_SubscriptionModalActions"},174:(e,t,s)=>{"use strict";s.d(t,{p:()=>b});var i=window.__federation__.deps["@bx-fe/tracker-types"]||{},r=window.__federation__.deps.lodash.isEmpty,n=s.n(r),o=s(152),a=window.__federation__.deps["@bx-fe/common-feature-favorites@1.2.2"]||{},c=s(4),u=s(728),l=s(660),h=s(783),p=(0,o.dictionary)("subscriptions",{FETCH:"Error while fetch subscriptions list",ADD:"Error while adding new item to subscriptions list",REMOVE:"Error while remove item from subscriptions list",GET_EMAIL:"Error while fetch user email"});class b extends o.AbstractActionsService{async initSubscriptions(){this.container.resolve("SingletonRegistry").use(c.o).setItemsHash(),this.container.resolve("SingletonRegistry").use(c.o).setPriceItemsHash()}setSubscriptionData({item:e,event:t}){this.container.resolve("SingletonRegistry").use(c.o).setSubscriptionItem(e),this.container.resolve("SingletonRegistry").use(c.o).setSubscriptionTrackerInfo(t)}changeHash({id:e,value:t}){this.container.resolve("SingletonRegistry").use(c.o).changeItemHash({id:e,value:t}),this.container.resolve("SingletonRegistry").use(c.o).changePriceItemHash({id:e,value:t})}async add({sku:e}){try{await this.container.resolve("SingletonRegistry").use(u.P).subscribeStock({sku:e}),this.container.resolve("SingletonRegistry").use(c.o).changeItemHash({id:e,value:!0})}catch(e){this.container.resolve("Logger").error({message:p.ADD,exception:e})}}async itemAddEmail({email:e}){try{var t=this.container.resolve("SingletonRegistry").use(c.o).state,{subscriptionItem:s={}}=t,i=await this.container.resolve("SingletonRegistry").use(a.FavoritesActions).checkItemsInFavorites([s.sku]);await this.container.resolve("SingletonRegistry").use(u.P).subscribeStock({sku:s.sku,email:e}),this.container.resolve("SingletonRegistry").use(c.o).changeItemHash({id:s.sku,value:!0}),i||await this.container.resolve("SingletonRegistry").use(a.FavoritesActions).dispatchHandleFavorite(String(s.sku)),this.emit("ITEM_ADD_EMAIL")}catch(e){this.container.resolve("Logger").error({message:p.ADD,exception:e})}}async priceAddEmail({email:e}){try{var t=this.container.resolve("SingletonRegistry").use(c.o).state,{subscriptionItem:s={},subscriptionTrackerInfo:r={}}=t,n=await this.container.resolve("SingletonRegistry").use(a.FavoritesActions).checkItemsInFavorites([s.sku]);await this.container.resolve("SingletonRegistry").use(u.P).subscribePrice(Object.assign({sku:s.sku},e?{email:e}:{})),this.container.resolve("SingletonRegistry").use(c.o).changePriceItemHash({id:s.sku,value:!0}),this.sendAnalytics({trackerInfo:r,type:i.EActionTypes.PRICE_SUBSCRIBE_ACTION}),n||(await this.container.resolve("SingletonRegistry").use(a.FavoritesActions).dispatchHandleFavorite(String(s.sku)),this.sendAnalytics({trackerInfo:r,type:i.EActionTypes.FAVORITE_ACTION})),this.emit("PRICE_ADD_EMAIL")}catch(e){this.container.resolve("Logger").error({message:p.ADD,exception:e})}}async priceAdd({sku:e}){try{await this.container.resolve("SingletonRegistry").use(u.P).subscribePrice({sku:e}),this.container.resolve("SingletonRegistry").use(c.o).changePriceItemHash({id:e,value:!0}),this.emit("PRICE_ADD")}catch(e){this.container.resolve("Logger").error({message:p.ADD,exception:e})}}async remove({sku:e}){try{await this.container.resolve("SingletonRegistry").use(u.P).unsubscribeStock({sku:e}),this.container.resolve("SingletonRegistry").use(c.o).changeItemHash({id:e,value:!1})}catch(e){this.container.resolve("Logger").error({message:p.REMOVE,exception:e})}}async priceRemove(){try{var e=this.container.resolve("SingletonRegistry").use(c.o).state,{subscriptionItem:t={},subscriptionTrackerInfo:s={}}=e;await this.container.resolve("SingletonRegistry").use(u.P).unsubscribePrice({sku:t.sku}),this.container.resolve("SingletonRegistry").use(c.o).changePriceItemHash({id:t.sku,value:!1}),this.sendAnalytics({trackerInfo:s,type:i.EActionTypes.PRICE_UNSUBSCRIBE_ACTION}),this.emit("PRICE_REMOVE")}catch(e){this.container.resolve("Logger").error({message:p.REMOVE,exception:e})}}async removeAll({sku:e}){try{await this.container.resolve("SingletonRegistry").use(u.P).unsubscribeAll({sku:e}),this.changeHash({id:e,value:!1}),this.emit("REMOVE_ALL")}catch(e){this.container.resolve("Logger").error({message:p.REMOVE,exception:e})}}async getEmail(){try{var{emails:e}=await this.container.resolve("SingletonRegistry").use(u.P).emails();if(n()(e))return;var t=(e.find((e=>e.isConfirmed))||e[0]).email;this.container.resolve("SingletonRegistry").use(c.o).setEmail(t)}catch(e){this.container.resolve("Logger").error({message:p.GET_EMAIL,exception:e})}}async subscribeItemChange({item:e={},action:t,isSubscribe:s,isPriceSubscribe:r,trackerInfo:n,isLoggedIn:o}){if(o&&s)await this[t](e),r?n&&this.sendAnalytics({trackerInfo:n,type:i.EActionTypes.PRICE_SUBSCRIBE_ACTION}):n&&this.sendAnalytics({trackerInfo:n,type:i.EActionTypes.AVAIL_ON_ACTION}),await this.container.resolve("SingletonRegistry").use(a.FavoritesActions).checkItemsInFavorites([e.sku])||(await this.container.resolve("SingletonRegistry").use(a.FavoritesActions).dispatchHandleFavorite(String(e.sku)),n&&this.sendAnalytics({trackerInfo:n,type:i.EActionTypes.FAVORITE_ACTION}));else if(s){await this.getEmail(),this.setSubscriptionData({item:e,event:n||{}});var c=r?h.ESubscriptionType.PRICE:h.ESubscriptionType.ITEM;this.container.resolve("SingletonRegistry").use(l.q).toggleUserSubscribeModal({status:!0,type:c})}else if(!s){await this[t](e);var u="UNSUBSCRIBE_ACTION";void 0!==r&&(u=r?"PRICE_UNSUBSCRIBE_ACTION":"AVAIL_OFF_ACTION"),n&&this.sendAnalytics({trackerInfo:n,type:i.EActionTypes[u]})}this.emit("SUBSCRIBE_ITEM_CHANGE")}sendAnalytics({trackerInfo:e,type:t}){e.widgetToken&&this.container.resolve("Tracker").send(t,{trinityEvent:{widgetToken:e.widgetToken,cellToken:e.cellToken.key}})}}b.__serviceName="AbstractActionsService_SubscriptionsActions"},728:(e,t,s)=>{"use strict";s.d(t,{P:()=>r});var i=s(152);class r extends i.AbstractApiService{constructor(...e){super(...e),this.serviceName="subscriptionActions",this.servicePath="composer-api.bx/_action"}subscribeAll(e){return this.fetch({method:"post",path:"/subscriptionsAllSubscribe"},Object.assign({skus:[Number(e.sku)]},e.email?{email:e.email}:{}))}unsubscribeAll(e){return this.fetch({method:"post",path:"/subscriptionsAllUnsubscribe"},Object.assign({skus:[Number(e.sku)]},e.email?{email:e.email}:{}))}subscribePrice(e){return this.fetch({method:"post",path:"/subscriptionsSubscribeToPrice"},Object.assign({skus:[Number(e.sku)]},e.email?{email:e.email}:{}))}unsubscribePrice(e){return this.fetch({method:"post",path:"/subscriptionsUnsubscribeFromPrice"},Object.assign({skus:[Number(e.sku)]},e.email?{email:e.email}:{}))}subscribeStock(e){return this.fetch({method:"post",path:"/subscriptionsSubscribeToStock"},Object.assign({skus:[Number(e.sku)]},e.email?{email:e.email}:{}))}unsubscribeStock(e){return this.fetch({method:"post",path:"/subscriptionsUnsubscribeFromStock"},Object.assign({skus:[Number(e.sku)]},e.email?{email:e.email}:{}))}emails(){return this.fetch({method:"get",path:"/subscriptionsGetEmail"})}}r.__serviceName="AbstractApiService_SubscriptionActionsService"},443:(e,t,s)=>{"use strict";s.d(t,{$:()=>r});var i=s(152);class r extends i.AbstractStoreService{getInitialState(){return{subscriptionModalVisible:!1,subscriptionType:null}}setVisibility(e=!1){this.pushState((t=>{t.subscriptionModalVisible=e}))}setSubscriptionType(e=null){this.pushState((t=>{t.subscriptionType=e}))}}r.__serviceName="AbstractStoreService_SubscriptionModalStore"},4:(e,t,s)=>{"use strict";s.d(t,{o:()=>r});var i=s(152);class r extends i.AbstractStoreService{getInitialState(){return{itemsHash:{},priceItemsHash:{},subscriptionItem:{},subscriptionTrackerInfo:{},email:""}}setItemsHash(e={}){this.pushState((t=>{t.itemsHash=e}))}setPriceItemsHash(e={}){this.pushState((t=>{t.priceItemsHash=e}))}changeItemHash({id:e,value:t}){this.pushState((s=>{s.itemsHash[e]=t}))}changePriceItemHash({id:e,value:t}){this.pushState((s=>{s.priceItemsHash[e]=t}))}setSubscriptionItem(e={}){this.pushState((t=>{t.subscriptionItem=e}))}setSubscriptionTrackerInfo(e={}){this.pushState((t=>{t.subscriptionTrackerInfo=e}))}setEmail(e=""){this.pushState((t=>{t.email=e}))}}r.__serviceName="AbstractStoreService_SubscriptionsStore"},783:(e,t,s)=>{"use strict";s.r(t),s.d(t,{ESubscriptionType:()=>i});var i=function(e){return e[e.ITEM=0]="ITEM",e[e.PRICE=1]="PRICE",e}({})},588:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"SubscriptionModalActions",{get:()=>s(660).q}),Object.defineProperty(t,"SubscriptionsActions",{get:()=>s(174).p}),Object.defineProperty(t,"SubscriptionActionsService",{get:()=>s(728).P}),Object.defineProperty(t,"SubscriptionModalStore",{get:()=>s(443).$}),Object.defineProperty(t,"SubscriptionsStore",{get:()=>s(4).o}),Object.assign(t,s(783))},152:e=>{"use strict";e.exports=window.__federation__.deps["@bx-fe/platform-app-common"]||{}}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i=s(588);window.__federation__.deps["@bx-fe/common-feature-subscriptions@1.2.2"]||(window.__federation__.deps["@bx-fe/common-feature-subscriptions@1.2.2"]=Object.defineProperties({},Object.getOwnPropertyDescriptors(i)))})();