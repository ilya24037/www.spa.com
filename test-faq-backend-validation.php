<?php

require_once __DIR__ . '/vendor/autoload.php';
$app = require_once __DIR__ . '/bootstrap/app.php';
$kernel = $app->make(Illuminate\Contracts\Http\Kernel::class);
$kernel->handle($request = Illuminate\Http\Request::capture());

use App\Domain\Ad\Models\Ad;
use App\Domain\User\Models\User;
use App\Domain\Ad\Services\DraftService;

echo "üéØ –¢–ï–°–¢ –°–ï–†–í–ï–†–ù–û–ô –í–ê–õ–ò–î–ê–¶–ò–ò FAQ\n";
echo "=====================================\n\n";

$user = User::where('email', 'anna@spa.test')->first();
if (!$user) {
    $user = User::first();
}

if ($user) {
    echo "üë§ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {$user->email} (ID: {$user->id})\n\n";
    
    $draftService = app(DraftService::class);
    
    // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö –æ–ø—Ü–∏–π
    echo "üìù –¢–µ—Å—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤ faq_2\n";
    echo "---------------------------------------------------\n";
    
    $testData = [
        'user_id' => $user->id,
        'title' => '–¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ FAQ',
        'service_provider' => ['women'],
        'clients' => ['men'],
        'phone' => '+79001234567',
        'geo' => ['lat' => 55.7558, 'lng' => 37.6173],
        'prices' => ['apartments_1h' => 5000],
        'services' => ['massage' => true],
        'photos' => [],
        'faq' => [
            'faq_1' => 1, // radio - –æ–±—ã—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å
            'faq_2' => [1, 2, 3, 4], // checkbox —Å "–ù–µ—Ç" - –¥–æ–ª–∂–Ω–æ –æ—Å—Ç–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ [4]
            'faq_3' => [1, 2], // checkbox –±–µ–∑ "–ù–µ—Ç" - –æ—Å—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å
            'faq_5' => 2 // radio - –æ–±—ã—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å
        ],
        'status' => 'draft'
    ];
    
    $draft = $draftService->saveOrUpdate($testData, $user, null);
    
    echo "‚ö†Ô∏è  –í–•–û–î: faq_2 = [1, 2, 3, 4] (–∫–æ–Ω—Ñ–ª–∏–∫—Ç: '–ù–µ—Ç' —Å –¥—Ä—É–≥–∏–º–∏ –æ–ø—Ü–∏—è–º–∏)\n";
    echo "‚úÖ –í–´–•–û–î: faq_2 = " . json_encode($draft->faq['faq_2'] ?? [], JSON_UNESCAPED_UNICODE) . "\n";
    echo "   –û–ñ–ò–î–ê–ù–ò–ï: [4] (—Ç–æ–ª—å–∫–æ '–ù–µ—Ç')\n";
    
    $isCorrect = isset($draft->faq['faq_2']) && 
                 is_array($draft->faq['faq_2']) && 
                 count($draft->faq['faq_2']) === 1 && 
                 $draft->faq['faq_2'][0] == 4;
    
    echo "   –†–ï–ó–£–õ–¨–¢–ê–¢: " . ($isCorrect ? "‚úÖ –ö–û–†–†–ï–ö–¢–ù–û" : "‚ùå –ù–ï–ö–û–†–†–ï–ö–¢–ù–û") . "\n\n";
    
    // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è faq_3
    echo "üìù –¢–µ—Å—Ç 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤ faq_3\n";
    echo "---------------------------------------------------\n";
    
    $test2Data = [
        'faq' => [
            'faq_3' => [1, 2, 3, 4] // –í—Å–µ –æ–ø—Ü–∏–∏ –≤–∫–ª—é—á–∞—è "–ù–µ—Ç"
        ]
    ];
    
    $draft2 = $draftService->saveOrUpdate($test2Data, $user, $draft->id);
    
    echo "‚ö†Ô∏è  –í–•–û–î: faq_3 = [1, 2, 3, 4] (–∫–æ–Ω—Ñ–ª–∏–∫—Ç: '–ù–µ—Ç' —Å –¥—Ä—É–≥–∏–º–∏ –æ–ø—Ü–∏—è–º–∏)\n";
    echo "‚úÖ –í–´–•–û–î: faq_3 = " . json_encode($draft2->faq['faq_3'] ?? [], JSON_UNESCAPED_UNICODE) . "\n";
    echo "   –û–ñ–ò–î–ê–ù–ò–ï: [4] (—Ç–æ–ª—å–∫–æ '–ù–µ—Ç')\n";
    
    $isCorrect2 = isset($draft2->faq['faq_3']) && 
                  is_array($draft2->faq['faq_3']) && 
                  count($draft2->faq['faq_3']) === 1 && 
                  $draft2->faq['faq_3'][0] == 4;
    
    echo "   –†–ï–ó–£–õ–¨–¢–ê–¢: " . ($isCorrect2 ? "‚úÖ –ö–û–†–†–ï–ö–¢–ù–û" : "‚ùå –ù–ï–ö–û–†–†–ï–ö–¢–ù–û") . "\n\n";
    
    // –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö –æ–ø—Ü–∏–π –±–µ–∑ "–ù–µ—Ç"
    echo "üìù –¢–µ—Å—Ç 3: –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤\n";
    echo "---------------------------------------------------\n";
    
    $test3Data = [
        'faq' => [
            'faq_2' => [1, 2, 3], // –ë–µ–∑ "–ù–µ—Ç" - –¥–æ–ª–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è –∫–∞–∫ –µ—Å—Ç—å
            'faq_3' => [1, 2]     // –ë–µ–∑ "–ù–µ—Ç" - –¥–æ–ª–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è –∫–∞–∫ –µ—Å—Ç—å
        ]
    ];
    
    $draft3 = $draftService->saveOrUpdate($test3Data, $user, $draft->id);
    
    echo "‚úÖ –í–•–û–î: faq_2 = [1, 2, 3] (–±–µ–∑ '–ù–µ—Ç')\n";
    echo "‚úÖ –í–´–•–û–î: faq_2 = " . json_encode($draft3->faq['faq_2'] ?? [], JSON_UNESCAPED_UNICODE) . "\n";
    echo "   –û–ñ–ò–î–ê–ù–ò–ï: [1, 2, 3]\n";
    
    $isCorrect3 = isset($draft3->faq['faq_2']) && 
                  is_array($draft3->faq['faq_2']) && 
                  count($draft3->faq['faq_2']) === 3;
    
    echo "   –†–ï–ó–£–õ–¨–¢–ê–¢: " . ($isCorrect3 ? "‚úÖ –ö–û–†–†–ï–ö–¢–ù–û" : "‚ùå –ù–ï–ö–û–†–†–ï–ö–¢–ù–û") . "\n\n";
    
    // –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ "–ù–µ—Ç"
    echo "üìù –¢–µ—Å—Ç 4: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –æ–ø—Ü–∏–∏ '–ù–µ—Ç'\n";
    echo "---------------------------------------------------\n";
    
    $test4Data = [
        'faq' => [
            'faq_2' => [4], // –¢–æ–ª—å–∫–æ "–ù–µ—Ç"
            'faq_3' => [4]  // –¢–æ–ª—å–∫–æ "–ù–µ—Ç"
        ]
    ];
    
    $draft4 = $draftService->saveOrUpdate($test4Data, $user, $draft->id);
    
    echo "‚úÖ –í–•–û–î: faq_2 = [4], faq_3 = [4] (—Ç–æ–ª—å–∫–æ '–ù–µ—Ç')\n";
    echo "‚úÖ –í–´–•–û–î: faq_2 = " . json_encode($draft4->faq['faq_2'] ?? [], JSON_UNESCAPED_UNICODE) . "\n";
    echo "‚úÖ –í–´–•–û–î: faq_3 = " . json_encode($draft4->faq['faq_3'] ?? [], JSON_UNESCAPED_UNICODE) . "\n";
    
    $isCorrect4 = isset($draft4->faq['faq_2']) && $draft4->faq['faq_2'] == [4] &&
                  isset($draft4->faq['faq_3']) && $draft4->faq['faq_3'] == [4];
    
    echo "   –†–ï–ó–£–õ–¨–¢–ê–¢: " . ($isCorrect4 ? "‚úÖ –ö–û–†–†–ï–ö–¢–ù–û" : "‚ùå –ù–ï–ö–û–†–†–ï–ö–¢–ù–û") . "\n\n";
    
    // –û—á–∏—Å—Ç–∫–∞
    $draft->delete();
    echo "üóëÔ∏è –¢–µ—Å—Ç–æ–≤—ã–π —á–µ—Ä–Ω–æ–≤–∏–∫ —É–¥–∞–ª–µ–Ω\n\n";
    
} else {
    echo "‚ùå –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ç–µ—Å—Ç–∞\n";
}

echo "üéØ –ò–¢–û–ì–û–í–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:\n";
echo "======================\n";
echo "‚úÖ –°–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏—Ö –æ–ø—Ü–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞\n";
echo "‚úÖ –û–ø—Ü–∏—è '–ù–µ—Ç' –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–∞–µ—Ç –¥—Ä—É–≥–∏–µ –æ–ø—Ü–∏–∏\n";
echo "‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n";
echo "‚úÖ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö checkbox –≤–æ–ø—Ä–æ—Å–æ–≤ —Å –æ–ø—Ü–∏–µ–π '–ù–µ—Ç'\n";