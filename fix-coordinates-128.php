<?php

require_once __DIR__ . '/vendor/autoload.php';

$app = require_once __DIR__ . '/bootstrap/app.php';
$app->make('Illuminate\Contracts\Console\Kernel')->bootstrap();

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è ID 128 –¥–ª—è –ú–æ—Å–∫–≤—ã...\n\n";

// –ù–∞–π–¥–µ–º –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
$ad = \App\Domain\Ad\Models\Ad::find(128);

if (!$ad) {
    echo "‚ùå –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å ID 128 –Ω–µ –Ω–∞–π–¥–µ–Ω–æ\n";
    exit(1);
}

echo "üìã –¢–ï–ö–£–©–ò–ï –î–ê–ù–ù–´–ï:\n";
echo "=================\n";
echo "ID: {$ad->id}\n";
echo "–ù–∞–∑–≤–∞–Ω–∏–µ: {$ad->title}\n";
echo "–ê–¥—Ä–µ—Å: {$ad->address}\n";
echo "–¢–µ–∫—É—â–∏–µ geo: {$ad->geo}\n";

// –ú–æ—Å–∫–æ–≤—Å–∫–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (—Ü–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞)
$moscowCoordinates = [
    'lat' => 55.7558,
    'lng' => 37.6176,
    'city' => '–ú–æ—Å–∫–≤–∞',
    'address' => '–ú–æ—Å–∫–≤–∞, —É–ª. –ê–¥–º–∏—Ä–∞–ª–∞ –£—à–∞–∫–æ–≤–∞, 10'  // –û–±–Ω–æ–≤–ª—è–µ–º –∏ –∞–¥—Ä–µ—Å
];

$newGeoData = json_encode($moscowCoordinates);
$newAddress = "–ú–æ—Å–∫–≤–∞, —É–ª. –ê–¥–º–∏—Ä–∞–ª–∞ –£—à–∞–∫–æ–≤–∞, 10";

try {
    $ad->update([
        'geo' => $newGeoData,
        'address' => $newAddress  // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –∞–¥—Ä–µ—Å –Ω–∞ –º–æ—Å–∫–æ–≤—Å–∫–∏–π
    ]);
    
    echo "\n‚úÖ –û–ë–ù–û–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û:\n";
    echo "========================\n";
    echo "–ù–æ–≤—ã–π –∞–¥—Ä–µ—Å: {$newAddress}\n";
    echo "–ù–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: lat={$moscowCoordinates['lat']}, lng={$moscowCoordinates['lng']}\n";
    echo "–ù–æ–≤—ã–µ geo –¥–∞–Ω–Ω—ã–µ: {$newGeoData}\n";
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å
    $ad->refresh();
    echo "\n‚úÖ –ü–†–û–í–ï–†–ö–ê –í –ë–î:\n";
    echo "================\n";
    echo "–ê–¥—Ä–µ—Å –≤ –ë–î: {$ad->address}\n";
    echo "Geo –≤ –ë–î: {$ad->geo}\n";
    
    echo "\nüó∫Ô∏è –†–ï–ó–£–õ–¨–¢–ê–¢:\n";
    echo "=============\n";
    echo "‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ü–µ–Ω—Ç—Ä–µ –ú–æ—Å–∫–≤—ã\n";
    echo "‚úÖ –ú–∞—Ä–∫–µ—Ä –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ\n";
    echo "‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ø–∞–¥–∞—é—Ç –≤ –≥—Ä–∞–Ω–∏—Ü—ã –ú–æ—Å–∫–≤—ã\n";
    
    echo "\nüåê –°–°–´–õ–ö–ò:\n";
    echo "==========\n";
    echo "–ì–ª–∞–≤–Ω–∞—è —Å –∫–∞—Ä—Ç–æ–π: http://spa.test/\n";
    echo "–û–±—ä—è–≤–ª–µ–Ω–∏–µ: http://spa.test/ads/{$ad->id}\n";
    
} catch (\Exception $e) {
    echo "\n‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:\n";
    echo $e->getMessage() . "\n";
    exit(1);
}

echo "\nüéâ –ì–æ—Ç–æ–≤–æ! –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–∞—Ä–∫–µ—Ä–∞.\n";