# ADR-001: Domain-Driven Design –¥–ª—è backend

## –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

- **–î–∞—Ç–∞:** 2024-08-15
- **–°—Ç–∞—Ç—É—Å:** Accepted
- **Deciders:** –¢–µ—Ö–ª–∏–¥, Backend team
- **–¢–µ–≥–∏:** #architecture #backend #ddd #laravel

## –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–æ–±–ª–µ–º–∞

–ü—Ä–æ–µ–∫—Ç SPA Platform —Ä–∞—Å—Ç–µ—Ç, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è MVC —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Laravel –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–æ–ª—Å—Ç—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º –∏ –º–æ–¥–µ–ª—è–º. –ù—É–∂–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª–∏—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [x] –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- [x] –õ–µ–≥–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- [x] –ü–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- [x] –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–∞–Ω–¥ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Laravel –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞
- –ö–æ–º–∞–Ω–¥–∞ –∑–Ω–∞–∫–æ–º–∞ —Å Laravel, –Ω–æ –Ω–µ —Å DDD
- –ù—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞–±–æ—Ç–∞—é—â–∏–π –∫–æ–¥

## –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π Laravel MVC
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É Laravel

**–ü–ª—é—Å—ã:**
- –ö–æ–º–∞–Ω–¥–∞ —É–∂–µ –∑–Ω–∞–µ—Ç –ø–æ–¥—Ö–æ–¥
- –ú–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

**–ú–∏–Ω—É—Å—ã:**
- Fat controllers –ø—Ä–∏ —Ä–æ—Å—Ç–µ –ª–æ–≥–∏–∫–∏
- –°–ª–æ–∂–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°–º–µ—à–∏–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –í–∞—Ä–∏–∞–Ω—Ç 2: Domain-Driven Design (DDD)
**–û–ø–∏—Å–∞–Ω–∏–µ:** –†–∞–∑–¥–µ–ª–∏—Ç—å –∫–æ–¥ –ø–æ –¥–æ–º–µ–Ω–∞–º —Å —è–≤–Ω—ã–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

**–ü–ª—é—Å—ã:**
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –õ–µ–≥–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥

**–ú–∏–Ω—É—Å—ã:**
- –ö—Ä–∏–≤–∞—è –æ–±—É—á–µ–Ω–∏—è –¥–ª—è –∫–æ–º–∞–Ω–¥—ã
- –ë–æ–ª—å—à–µ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫
- –ù–∞—á–∞–ª—å–Ω—ã–π –æ–≤–µ—Ä—Ö–µ–¥

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Modules)
**–û–ø–∏—Å–∞–Ω–∏–µ:** –†–∞–∑–¥–µ–ª–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–æ–¥—É–ª–∏

**–ü–ª—é—Å—ã:**
- –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–æ–¥—É–ª–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ú–∏–Ω—É—Å—ã:**
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–æ–¥—É–ª–µ–π
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- –ù–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ –≤ Laravel

## –†–µ—à–µ–Ω–∏–µ

–í—ã–±—Ä–∞–Ω **–í–∞—Ä–∏–∞–Ω—Ç 2: Domain-Driven Design**

### –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ
DDD –¥–∞–µ—Ç —á–µ—Ç–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å—Ç—É—â–µ–≥–æ –∫–æ–¥–∞, —Ä–∞–∑–¥–µ–ª—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –æ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å. –•–æ—Ç—è –µ—Å—Ç—å –∫—Ä–∏–≤–∞—è –æ–±—É—á–µ–Ω–∏—è, –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–µ—à–∏–≤–∞—é—Ç –Ω–∞—á–∞–ª—å–Ω—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.

### –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
```
app/Domain/
‚îú‚îÄ‚îÄ User/
‚îÇ   ‚îú‚îÄ‚îÄ Models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ User.php
‚îÇ   ‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UserService.php
‚îÇ   ‚îú‚îÄ‚îÄ Actions/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CreateUserAction.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UpdateProfileAction.php
‚îÇ   ‚îú‚îÄ‚îÄ DTOs/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CreateUserDTO.php
‚îÇ   ‚îî‚îÄ‚îÄ Events/
‚îÇ       ‚îî‚îÄ‚îÄ UserCreated.php
‚îú‚îÄ‚îÄ Master/
‚îÇ   ‚îú‚îÄ‚îÄ Models/
‚îÇ   ‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îî‚îÄ‚îÄ Actions/
‚îú‚îÄ‚îÄ Booking/
‚îî‚îÄ‚îÄ Ad/
```

## –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

### –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ
- ‚úÖ –ß–µ—Ç–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞ –ø–æ –¥–æ–º–µ–Ω–∞–º
- ‚úÖ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –≤ Services –∏ Actions
- ‚úÖ –õ–µ–≥–∫–æ–µ unit-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- ‚úÖ –ù–æ–≤—ã–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±—ã—Å—Ç—Ä–µ–µ –ø–æ–Ω–∏–º–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ —Ä–∞–∑–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

### –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ
- ‚ö†Ô∏è –ë–æ–ª—å—à–µ —Ñ–∞–π–ª–æ–≤ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- ‚ö†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã DDD –ø—Ä–∏–Ω—Ü–∏–ø–∞–º
- ‚ö†Ô∏è –ù–∞—á–∞–ª—å–Ω—ã–π –æ–≤–µ—Ä—Ö–µ–¥ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ñ–∏—á

### –†–∏—Å–∫–∏
- üî¥ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –¥–æ–º–µ–Ω–æ–≤ ‚Üí –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ä–µ–≤—å—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- üî¥ –°–º–µ—à–∏–≤–∞–Ω–∏–µ —Å–ª–æ–µ–≤ ‚Üí Code review –∏ –ª–∏–Ω—Ç–µ—Ä—ã

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
```php
// app/Http/Controllers/MasterController.php
class MasterController extends Controller
{
    public function store(Request $request)
    {
        $data = $request->validate([...]);

        // –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
        if ($data['experience'] < 3) {
            $data['level'] = 'junior';
        } else {
            $data['level'] = 'senior';
        }

        $master = Master::create($data);

        // –ï—â–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
        if ($master->level === 'senior') {
            $master->priority = true;
            $master->save();
        }

        return response()->json($master);
    }
}
```

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
```php
// app/Http/Controllers/MasterController.php
class MasterController extends Controller
{
    public function __construct(
        private MasterService $masterService
    ) {}

    public function store(StoreMasterRequest $request)
    {
        $dto = CreateMasterDTO::fromRequest($request);
        $master = $this->masterService->create($dto);

        return new MasterResource($master);
    }
}

// app/Domain/Master/Services/MasterService.php
class MasterService
{
    public function create(CreateMasterDTO $dto): Master
    {
        return DB::transaction(function () use ($dto) {
            $master = Master::create($dto->toArray());

            $this->assignLevel($master);
            $this->setPriority($master);

            event(new MasterCreated($master));

            return $master;
        });
    }

    private function assignLevel(Master $master): void
    {
        // –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω–∞
        $master->level = $master->experience < 3 ? 'junior' : 'senior';
        $master->save();
    }
}
```

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

- [ADR-002](./002-fsd-frontend.md) - –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è frontend
- [ADR-005](./005-repository-pattern.md) - –ü–∞—Ç—Ç–µ—Ä–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è –¥–æ–º–µ–Ω–æ–≤

## –°—Å—ã–ª–∫–∏

- [Domain-Driven Design by Eric Evans](https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215)
- [DDD in Laravel](https://stitcher.io/blog/laravel-beyond-crud-01-domain-oriented-laravel)
- [Our DDD Guidelines](./../CONVENTIONS.md#backend-ddd)

## –ó–∞–º–µ—Ç–∫–∏

–ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ, –ø–æ –º–µ—Ä–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞. –ù–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å—Ä–∞–∑—É –ø–∏—à–µ—Ç—Å—è –≤ DDD —Å—Ç–∏–ª–µ.

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-01-22*