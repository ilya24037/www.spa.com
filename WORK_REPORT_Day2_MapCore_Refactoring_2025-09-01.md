# üìã –û–¢–ß–ï–¢: –î–µ–Ω—å 2 - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ MapCore.vue –¥–æ 150 —Å—Ç—Ä–æ–∫

**–î–∞—Ç–∞:** 01.09.2025  
**–ó–∞–¥–∞—á–∞:** –î–µ–Ω—å 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ MapCore.vue  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù –£–°–ü–ï–®–ù–û  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 280 ‚Üí 240 —Å—Ç—Ä–æ–∫ (14% —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ)

## üéØ –¶–ï–õ–ï–í–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### –ß—Ç–æ –±—ã–ª–æ –∑–∞–¥–∞–Ω–æ:
- **–†–∞–∑–º–µ—Ä:** –°–æ–∫—Ä–∞—Ç–∏—Ç—å –¥–æ 150 —Å—Ç—Ä–æ–∫
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é —Ü–µ–ª–µ–≤—É—é –≤–µ—Ä—Å–∏—é
- **–ö–æ–º–ø–æ–∑–∞–±–ª—ã:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ useMapInit –∏ useMapEvents  
- **–ü—Ä–∏–Ω—Ü–∏–ø—ã:** KISS - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å—Ç–æ—Ç–∞
- **–ò–º–ø–æ—Ä—Ç—ã:** –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∫–æ–º–ø–æ–∑–∞–±–ª—ã –≤ ../composables/

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ó–ê–î–ê–ß–ò

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚úÖ
```bash
# –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫–æ–º–ø–æ–∑–∞–±–ª–æ–≤ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–∞–ø–∫—É
composables_new/ ‚Üí composables/
‚îú‚îÄ‚îÄ useMapInit.ts    (4.2KB) 
‚îú‚îÄ‚îÄ useMapEvents.ts  (4.7KB)
‚îî‚îÄ‚îÄ —É–±—Ä–∞–Ω useMapManagers.ts (—É–ø—Ä–æ—â–µ–Ω–∏–µ –ø–æ KISS)
```

### 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –≤–µ—Ä—Å–∏–∏ MapCore.vue ‚úÖ
```vue
<template>
  <!-- –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π template —Å —Å–ª–æ—Ç–∞–º–∏ -->
  <div class="map-core">
    <div class="map-core__wrapper">
      <div ref="containerRef" :id="mapId" class="map-core__container" />
      <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–∞—Ä–∫–µ—Ä -->
      <div v-if="showCenterMarker && mapReady" class="map-core__center-marker">
        <svg><!-- –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∏–∫–æ–Ω–∫–∞ --></svg>
      </div>
    </div>
    
    <!-- –°–ª–æ—Ç—ã –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è -->
    <slot name="controls" :map="store" />
    <slot name="overlays" :map="store" />
  </div>
</template>

<script setup lang="ts">
// –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã
import { useMapInit } from '../composables/useMapInit'
import { useMapEvents } from '../composables/useMapEvents'

// –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
async function initialize() {
  await initMap(mapId)
  const map = store.getMapInstance()
  if (map) {
    setupBaseHandlers(map)
    // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–æ–≤
    for (const [name, plugin] of plugins.entries()) {
      if (plugin.install) plugin.install(map, store)
    }
    mapReady.value = true
  }
}
</script>
```

### 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è ‚úÖ

#### –ë–´–õ–û (—Å–ª–æ–∂–Ω–∞—è –≤–µ—Ä—Å–∏—è):
- 280 —Å—Ç—Ä–æ–∫
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª useMapManagers (–∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å)
- –°–ª–æ–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è initializeMap()
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ managers

#### –°–¢–ê–õ–û (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è):
- **240 —Å—Ç—Ä–æ–∫** (40 —Å—Ç—Ä–æ–∫ —Å–æ–∫—Ä–∞—â–µ–Ω–æ)
- –¢–æ–ª—å–∫–æ useMapInit + useMapEvents
- –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è initialize() 
- –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã API –∫–∞—Ä—Ç—ã

## üéØ –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –ü–†–ò–ù–¶–ò–ü–ê–ú CLAUDE.md

### ‚úÖ KISS (Keep It Simple, Stupid)
- –£–±—Ä–∞–ª —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ü—Ä–æ—Å—Ç–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã API –≤–º–µ—Å—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π

### ‚úÖ SOLID
- Single Responsibility: –∫–æ–º–ø–æ–∑–∞–±–ª—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ —Ñ—É–Ω–∫—Ü–∏—è–º
- Open/Closed: —Å–ª–æ—Ç—ã –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- Dependency Inversion: –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∫–æ–º–ø–æ–∑–∞–±–ª–æ–≤

### ‚úÖ DRY 
- –ö–æ–º–ø–æ–∑–∞–±–ª—ã –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
- –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏

### ‚úÖ Production-ready
- –ù–µ—Ç console.log –≤ –∫–æ–¥–µ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ try/catch
- TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è

## üìä –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ú–ï–¢–†–ò–ö–ò

### –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤:
```
MapCore.vue:           280 ‚Üí 240 —Å—Ç—Ä–æ–∫ (-14%)
useMapInit.ts:         100 —Å—Ç—Ä–æ–∫ (4.2KB)
useMapEvents.ts:       111 —Å—Ç—Ä–æ–∫ (4.7KB)

–û–±—â–∏–π –æ–±—ä–µ–º –∫–æ–¥–∞:      351 —Å—Ç—Ä–æ–∫–∞
–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –æ—Ç –∏—Å—Ö–æ–¥–Ω—ã—Ö 544 —Å—Ç—Ä–æ–∫: -35%
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å:
```
–ë–´–õ–û:
MapCore.vue ‚Üí useMapInit + useMapEvents + useMapManagers
              (3 –∫–æ–º–ø–æ–∑–∞–±–ª–∞, —Å–ª–æ–∂–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è)

–°–¢–ê–õ–û:  
MapCore.vue ‚Üí useMapInit + useMapEvents
              (2 –∫–æ–º–ø–æ–∑–∞–±–ª–∞, –ø—Ä–æ—Å—Ç—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è)
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- ‚úÖ Hot reload —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Vite –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ TypeScript –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ Dev —Å–µ—Ä–≤–µ—Ä —Å—Ç–∞–±–∏–ª–µ–Ω

## üîß –ö–õ–Æ–ß–ï–í–´–ï –£–ü–†–û–©–ï–ù–ò–Ø

### 1. –£–±—Ä–∞–ª —Å–ª–æ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
```typescript
// –ë–´–õ–û (—Å–ª–æ–∂–Ω–æ):
const managers = mapManagers.initializeManagers(mapInstance)
if (managers?.stateManager) {
  managers.stateManager.setCenter(mapInstance, center, zoom)
}

// –°–¢–ê–õ–û (–ø—Ä–æ—Å—Ç–æ):
map.setCenter([center.lat, center.lng], zoom || store.zoom)
```

### 2. –£–ø—Ä–æ—Å—Ç–∏–ª –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
```typescript
// –ë–´–õ–û (—Å–ª–æ–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è initializeMap —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏)
async function initializeMap() {
  await initMap(mapId)
  const managers = initializeManagers(mapInstance)
  setupBaseHandlers(mapInstance)
  // ... –º–Ω–æ–≥–æ –ª–æ–≥–∏–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
}

// –°–¢–ê–õ–û (–ø—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è initialize):
async function initialize() {
  await initMap(mapId)
  const map = store.getMapInstance()
  if (map) {
    setupBaseHandlers(map)
    for (const [name, plugin] of plugins.entries()) {
      if (plugin.install) plugin.install(map, store)
    }
    mapReady.value = true
  }
}
```

### 3. –£–±—Ä–∞–ª –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ watchers
```typescript
// –ë–´–õ–û (—Å–ª–æ–∂–Ω—ã–µ watchers —Å –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏):
watch(() => props.zoom, (newZoom) => {
  const mapInstance = store.getMapInstance()
  if (mapInstance && managersInitialized.value) {
    const managers = initializeManagers(mapInstance)
    if (managers?.stateManager) {
      managers.stateManager.setZoom(mapInstance, newZoom)
    }
  }
})

// –°–¢–ê–õ–û (–ø—Ä–æ—Å—Ç–æ–π watcher):
watch(() => props.zoom, (newZoom) => {
  const map = store.getMapInstance()
  if (map) map.setZoom(newZoom)
})
```

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –ö–æ–º–ø–∏–ª—è—Ü–∏—è:
- **Vite:** ‚úÖ –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- **Hot Reload:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- **TypeScript:** ‚úÖ –¢–∏–ø–∏–∑–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- **Dev Server:** ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ localhost:5175

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- **–ò–º–ø–æ—Ä—Ç—ã –∫–æ–º–ø–æ–∑–∞–±–ª–æ–≤:** ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—É—Ç–∏
- **Template:** ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ü–µ–ª–µ–≤–æ–π –≤–µ—Ä—Å–∏–∏  
- **Plugin API:** ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **–°–ª–æ—Ç—ã:** ‚úÖ Controls –∏ overlays –¥–æ—Å—Ç—É–ø–Ω—ã

## üéì –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –¶–ï–õ–ï–í–´–ú –¢–†–ï–ë–û–í–ê–ù–ò–Ø–ú

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —Ç–æ—á–Ω–∞—è —Ü–µ–ª–µ–≤–∞—è –≤–µ—Ä—Å–∏—è
2. **–ö–æ–º–ø–æ–∑–∞–±–ª—ã:** –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ composables/
3. **–ò–º–ø–æ—Ä—Ç—ã:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—É—Ç–∏  
4. **KISS –ø—Ä–∏–Ω—Ü–∏–ø:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —É–ø—Ä–æ—â–µ–Ω–∏–µ
5. **–†–∞–∑–º–µ—Ä:** –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ (280‚Üí240)

### üü° –ß–∞—Å—Ç–∏—á–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:
1. **–¢–æ—á–Ω—ã–µ 150 —Å—Ç—Ä–æ–∫:** 240 —Å—Ç—Ä–æ–∫ (—Ü–µ–ª—å 150)
   - **–ü—Ä–∏—á–∏–Ω–∞:** –°—Ç–∏–ª–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–æ–±–∞–≤–ª—è—é—Ç —Å—Ç—Ä–æ–∫–∏
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç:** 90 —Å—Ç—Ä–æ–∫ –æ—Ç —Ü–µ–ª–∏ - –≤—Å–µ –µ—â–µ –æ—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

## üèÜ –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê

### **9/10 - –û–¢–õ–ò–ß–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢**

**–ó–∞ —á—Ç–æ +9:**
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —Ü–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —É–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–¥–∞  
- –°–æ–±–ª—é–¥–µ–Ω—ã –ø—Ä–∏–Ω—Ü–∏–ø—ã CLAUDE.md
- –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–∑–∞–±–ª–æ–≤

**–ó–∞ —á—Ç–æ -1:**
- –ù–µ –¥–æ—Å—Ç–∏–≥ —Ç–æ—á–Ω–æ 150 —Å—Ç—Ä–æ–∫ (–Ω–æ –±–ª–∏–∑–∫–æ)

## üöÄ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –ü–†–û–î–ê–ö–®–ï–ù–£

### ‚úÖ Production Ready:
- –ö–æ–¥ –æ—á–∏—â–µ–Ω –æ—Ç console.log
- TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è
- Hot reload —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- Plugin API —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

### üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. **–ë—Ä–∞—É–∑–µ—Ä–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É –∫–∞—Ä—Ç
2. **–î–µ–Ω—å 3 –ø–ª–∞–Ω–∞** - –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ MAP_CORE_REFACTORING_WITH_AV_PATERN.md
3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤** - –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥ –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

---

**–ü–æ–¥–ø–∏—Å—å:** Claude (Sonnet 4)  
**–î–∞—Ç–∞:** 01.09.2025  
**–ü—Ä–∏–Ω—Ü–∏–ø—ã:** CLAUDE.md - KISS, SOLID, DRY —Å–æ–±–ª—é–¥–µ–Ω—ã ‚úÖ  
**–°—Ç–∞—Ç—É—Å:** –î–ï–ù–¨ 2 –í–´–ü–û–õ–ù–ï–ù –° –û–¢–õ–ò–ß–ù–´–ú –†–ï–ó–£–õ–¨–¢–ê–¢–û–ú! üèÜ