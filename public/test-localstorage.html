<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç LocalStorage –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .section {
            margin: 25px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
            border-left: 4px solid #2196F3;
        }
        .data-box {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .key-item {
            padding: 8px;
            margin: 5px 0;
            background: #e8f5e9;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .key-item:hover {
            background: #c8e6c9;
            transform: translateX(5px);
        }
        .key-item.ad-form {
            background: #fff3e0;
            border: 1px solid #ff9800;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        .btn-check {
            background: #2196F3;
            color: white;
        }
        .btn-check:hover {
            background: #1976D2;
        }
        .btn-clear {
            background: #f44336;
            color: white;
        }
        .btn-clear:hover {
            background: #d32f2f;
        }
        .btn-show {
            background: #4CAF50;
            color: white;
        }
        .btn-show:hover {
            background: #388E3C;
        }
        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
        }
        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .found-data {
            background: #ffebee;
            border: 2px solid #ef5350;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .json-viewer {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –¢–µ—Å—Ç LocalStorage –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π SPA</h1>

        <div class="section">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ localStorage</h2>
            <div id="stats"></div>
        </div>

        <div class="section">
            <h2>üîë –í—Å–µ –∫–ª—é—á–∏ –≤ localStorage</h2>
            <button class="btn-check" onclick="checkLocalStorage()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage</button>
            <button class="btn-clear" onclick="clearAdFormData()">–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º</button>
            <button class="btn-clear" onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç—å –í–°–Å</button>
            <div id="keys" class="data-box"></div>
        </div>

        <div class="section">
            <h2>üìù –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º –æ–±—ä—è–≤–ª–µ–Ω–∏–π</h2>
            <div id="adFormData"></div>
        </div>

        <div class="section">
            <h2>üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h2>
            <input type="number" id="adId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –æ–±—ä—è–≤–ª–µ–Ω–∏—è" style="padding: 8px; font-size: 16px;">
            <button class="btn-show" onclick="checkSpecificAd()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            <div id="specificAd"></div>
        </div>

        <div class="section">
            <h2>üí° –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h2>
            <div class="alert alert-warning">
                <strong>–ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:</strong><br>
                1. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –∫–ª—é—á–∏ <code>adFormData_draft_*</code> - —ç—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º<br>
                2. –ü–æ–ª—è <code>specialty</code>, <code>work_format</code>, <code>service_provider</code> —Ö—Ä–∞–Ω—è—Ç—Å—è –ó–î–ï–°–¨<br>
                3. –ü—Ä–∏ –æ—á–∏—Å—Ç–∫–µ localStorage —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∏—Å—á–µ–∑–Ω—É—Ç<br>
                4. –ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–±—ä—è–≤–ª–µ–Ω–∏—è - –ø–æ–ª—è –±—É–¥—É—Ç –ø—É—Å—Ç—ã–º–∏!
            </div>
        </div>
    </div>

    <script>
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            checkLocalStorage();
        };

        function checkLocalStorage() {
            const keys = Object.keys(localStorage);
            const stats = document.getElementById('stats');
            const keysDiv = document.getElementById('keys');
            const adFormDiv = document.getElementById('adFormData');

            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const totalSize = new Blob(Object.values(localStorage)).size;
            stats.innerHTML = `
                <p>üì¶ –í—Å–µ–≥–æ –∫–ª—é—á–µ–π: <strong>${keys.length}</strong></p>
                <p>üíæ –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö: <strong>${(totalSize / 1024).toFixed(2)} KB</strong></p>
                <p>üìÖ –í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏: <strong>${new Date().toLocaleString('ru-RU')}</strong></p>
            `;

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª—é—á–µ–π
            keysDiv.innerHTML = '';
            const adFormKeys = [];

            keys.forEach(key => {
                const div = document.createElement('div');
                div.className = 'key-item';

                if (key.includes('adForm')) {
                    div.className += ' ad-form';
                    adFormKeys.push(key);
                    div.innerHTML = `<strong>üìå ${key}</strong> (–î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã!)`;
                } else {
                    div.innerHTML = key;
                }

                div.onclick = () => showData(key);
                keysDiv.appendChild(div);
            });

            // –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º
            if (adFormKeys.length > 0) {
                adFormDiv.innerHTML = '<div class="alert alert-error"><strong>‚ö†Ô∏è –ù–∞–π–¥–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º!</strong></div>';

                adFormKeys.forEach(key => {
                    try {
                        const data = JSON.parse(localStorage.getItem(key));
                        const div = document.createElement('div');
                        div.className = 'found-data';

                        div.innerHTML = `
                            <h3>üìã ${key}</h3>
                            <p><strong>specialty:</strong> ${data.specialty || '–ù–ï–¢'}</p>
                            <p><strong>work_format:</strong> ${data.work_format || '–ù–ï–¢'}</p>
                            <p><strong>service_provider:</strong> ${JSON.stringify(data.service_provider) || '–ù–ï–¢'}</p>
                            <details>
                                <summary>–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</summary>
                                <div class="json-viewer">
                                    <pre>${JSON.stringify(data, null, 2)}</pre>
                                </div>
                            </details>
                            <button class="btn-clear" onclick="removeKey('${key}')">–£–¥–∞–ª–∏—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ</button>
                        `;

                        adFormDiv.appendChild(div);
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:', e);
                    }
                });
            } else {
                adFormDiv.innerHTML = '<div class="alert alert-success">‚úÖ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º –ù–ï –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage</div>';
            }
        }

        function showData(key) {
            const data = localStorage.getItem(key);
            let formatted;

            try {
                formatted = JSON.stringify(JSON.parse(data), null, 2);
            } catch {
                formatted = data;
            }

            alert(`–ö–ª—é—á: ${key}\n\n–î–∞–Ω–Ω—ã–µ:\n${formatted.substring(0, 1000)}...`);
        }

        function removeKey(key) {
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –∫–ª—é—á "${key}"?`)) {
                localStorage.removeItem(key);
                checkLocalStorage();
                alert('‚úÖ –ö–ª—é—á —É–¥–∞–ª–µ–Ω!');
            }
        }

        function clearAdFormData() {
            const keys = Object.keys(localStorage).filter(k => k.includes('adForm'));

            if (keys.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                return;
            }

            if (confirm(`–£–¥–∞–ª–∏—Ç—å ${keys.length} –∫–ª—é—á–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ —Ñ–æ—Ä–º?`)) {
                keys.forEach(key => localStorage.removeItem(key));
                checkLocalStorage();
                alert('‚úÖ –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º —É–¥–∞–ª–µ–Ω—ã! –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–±—ä—è–≤–ª–µ–Ω–∏—è.');
            }
        }

        function clearAll() {
            if (confirm('‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage?')) {
                localStorage.clear();
                checkLocalStorage();
                alert('‚úÖ localStorage –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω!');
            }
        }

        function checkSpecificAd() {
            const id = document.getElementById('adId').value;
            if (!id) {
                alert('–í–≤–µ–¥–∏—Ç–µ ID –æ–±—ä—è–≤–ª–µ–Ω–∏—è');
                return;
            }

            const key = `adFormData_draft_${id}`;
            const data = localStorage.getItem(key);
            const div = document.getElementById('specificAd');

            if (data) {
                try {
                    const parsed = JSON.parse(data);
                    div.innerHTML = `
                        <div class="found-data">
                            <h3>‚úÖ –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –¥–ª—è ID: ${id}</h3>
                            <p><strong>specialty:</strong> ${parsed.specialty || '–ù–ï–¢'}</p>
                            <p><strong>work_format:</strong> ${parsed.work_format || '–ù–ï–¢'}</p>
                            <p><strong>service_provider:</strong> ${JSON.stringify(parsed.service_provider) || '–ù–ï–¢'}</p>
                            <div class="json-viewer">
                                <pre>${JSON.stringify(parsed, null, 2)}</pre>
                            </div>
                            <button class="btn-clear" onclick="removeKey('${key}')">–£–¥–∞–ª–∏—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ</button>
                        </div>
                    `;
                } catch (e) {
                    div.innerHTML = '<div class="alert alert-error">–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö</div>';
                }
            } else {
                div.innerHTML = `<div class="alert alert-warning">–î–∞–Ω–Ω—ã–µ –¥–ª—è ID ${id} –ù–ï –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage</div>`;
            }
        }
    </script>
</body>
</html>