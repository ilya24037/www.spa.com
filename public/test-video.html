<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест видео в черновике</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
        }
        .video-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        video {
            width: 100%;
            max-width: 800px;
            height: auto;
            background: #000;
            border-radius: 4px;
        }
        .info {
            margin-top: 10px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 4px;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Тест воспроизведения видео из черновика</h1>
    
    <div class="video-container">
        <h2>Видео из объявления ID: 182</h2>
        <p>Путь: /storage/users/anna-1/ads/182/videos/bc74bf22-f3f0-4efc-8450-00656cc63c4e.mp4</p>
        
        <video controls preload="metadata" id="testVideo">
            <source src="/storage/users/anna-1/ads/182/videos/bc74bf22-f3f0-4efc-8450-00656cc63c4e.mp4" type="video/mp4">
            Ваш браузер не поддерживает воспроизведение видео.
        </video>
        
        <div class="info">
            <p><strong>Статус:</strong> <span id="status">Проверка...</span></p>
            <p><strong>Информация:</strong></p>
            <ul id="info-list"></ul>
        </div>
    </div>

    <script>
        const video = document.getElementById('testVideo');
        const status = document.getElementById('status');
        const infoList = document.getElementById('info-list');
        
        function addInfo(text, isError = false) {
            const li = document.createElement('li');
            li.textContent = text;
            if (isError) {
                li.style.color = 'red';
            }
            infoList.appendChild(li);
        }
        
        // Проверка доступности видео
        video.addEventListener('loadedmetadata', () => {
            status.textContent = 'Видео загружено успешно!';
            status.className = 'success';
            addInfo(`Длительность: ${Math.round(video.duration)} секунд`);
            addInfo(`Размер: ${video.videoWidth}x${video.videoHeight}`);
        });
        
        video.addEventListener('error', (e) => {
            status.textContent = 'Ошибка загрузки видео!';
            status.className = 'error';
            
            const errorMessages = {
                1: 'MEDIA_ERR_ABORTED - загрузка прервана',
                2: 'MEDIA_ERR_NETWORK - сетевая ошибка',
                3: 'MEDIA_ERR_DECODE - ошибка декодирования',
                4: 'MEDIA_ERR_SRC_NOT_SUPPORTED - формат не поддерживается'
            };
            
            if (video.error) {
                addInfo(errorMessages[video.error.code] || 'Неизвестная ошибка', true);
            }
        });
        
        video.addEventListener('canplay', () => {
            addInfo('Видео готово к воспроизведению');
        });
        
        // Проверка через fetch
        fetch('/storage/users/anna-1/ads/182/videos/bc74bf22-f3f0-4efc-8450-00656cc63c4e.mp4', { method: 'HEAD' })
            .then(response => {
                if (response.ok) {
                    addInfo(`Файл доступен по HTTP (статус: ${response.status})`);
                    addInfo(`Content-Type: ${response.headers.get('Content-Type')}`);
                } else {
                    addInfo(`Файл недоступен (HTTP ${response.status})`, true);
                }
            })
            .catch(err => {
                addInfo(`Ошибка проверки: ${err.message}`, true);
            });
    </script>
</body>
</html>