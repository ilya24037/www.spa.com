<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button.danger {
            background: #dc3545;
        }
        
        button.danger:hover {
            background: #c82333;
        }
        
        button.success {
            background: #28a745;
        }
        
        button.success:hover {
            background: #218838;
        }
        
        #map {
            width: 100%;
            height: 600px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .stats {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .stats-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .mobile-info {
            display: none;
            background: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .mobile-info {
                display: block;
            }
            
            .controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó∫Ô∏è –¢–µ—Å—Ç –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –∫–∞—Ä—Ç—ã</h1>
        
        <div class="info">
            <p><strong>–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º:</strong></p>
            <ul>
                <li>‚úÖ –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤ (–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –±–ª–∏–∑–∫–∏—Ö —Ç–æ—á–µ–∫)</li>
                <li>‚úÖ –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤)</li>
                <li>‚úÖ –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–º—É–ª—å—Ç–∏—Ç–∞—á, –∏–Ω–µ—Ä—Ü–∏—è)</li>
                <li>‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –º–∞—Ä–∫–µ—Ä–æ–≤</li>
            </ul>
        </div>
        
        <div class="mobile-info">
            üì± <strong>–ú–æ–±–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω!</strong><br>
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∂–µ—Å—Ç—ã: —â–∏–ø–æ–∫ –¥–ª—è –∑—É–º–∞, —Å–≤–∞–π–ø –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
        </div>
        
        <div class="controls">
            <button onclick="addRandomMarkers(10)">+ 10 –º–∞—Ä–∫–µ—Ä–æ–≤</button>
            <button onclick="addRandomMarkers(50)">+ 50 –º–∞—Ä–∫–µ—Ä–æ–≤</button>
            <button onclick="addRandomMarkers(100)">+ 100 –º–∞—Ä–∫–µ—Ä–æ–≤</button>
            <button onclick="addRandomMarkers(500)" class="success">+ 500 –º–∞—Ä–∫–µ—Ä–æ–≤ (—Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç)</button>
            <button onclick="clearAllMarkers()" class="danger">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
            <button onclick="toggleClustering()">–í–∫–ª/–í—ã–∫–ª –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é</button>
            <button onclick="centerOnPerm()">–¶–µ–Ω—Ç—Ä –Ω–∞ –ü–µ—Ä–º—å</button>
        </div>
        
        <div id="map"></div>
        
        <div class="stats">
            <div class="stats-row">
                <span>–í—Å–µ–≥–æ –º–∞—Ä–∫–µ—Ä–æ–≤:</span>
                <strong id="totalMarkers">0</strong>
            </div>
            <div class="stats-row">
                <span>–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è:</span>
                <strong id="clusterStatus">–í–∫–ª—é—á–µ–Ω–∞</strong>
            </div>
            <div class="stats-row">
                <span>–¢–µ–∫—É—â–∏–π –∑—É–º:</span>
                <strong id="currentZoom">12</strong>
            </div>
            <div class="stats-row">
                <span>–í–∏–¥–∏–º–∞—è –æ–±–ª–∞—Å—Ç—å:</span>
                <strong id="visibleBounds">-</strong>
            </div>
        </div>
    </div>

    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey=23ff8acc-835f-4e99-8b19-d33c5d346e18"></script>
    
    <script>
        let myMap;
        let clusterer;
        let markers = [];
        let clusteringEnabled = true;
        const PERM_CENTER = [58.0105, 56.2502];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        ymaps.ready(init);
        
        function init() {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏
            myMap = new ymaps.Map("map", {
                center: PERM_CENTER,
                zoom: 12,
                controls: ['zoomControl', 'searchControl', 'typeSelector'],
                behaviors: isMobile 
                    ? ['drag', 'dblClickZoom', 'multiTouch'] 
                    : ['default']
            });
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
            if (isMobile) {
                myMap.behaviors.enable('multiTouch');
                myMap.options.set('suppressMapOpenBlock', true);
                myMap.options.set('dragInertiaEnable', true);
                myMap.options.set('dragInertiaFriction', 0.9);
            }
            
            // –°–æ–∑–¥–∞–µ–º –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ç–æ—Ä
            createClusterer();
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Ä—Ç—ã
            myMap.events.add('boundschange', onBoundsChange);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
            addRandomMarkers(20);
        }
        
        function createClusterer() {
            clusterer = new ymaps.Clusterer({
                preset: 'islands#invertedBlueClusterIcons',
                groupByCoordinates: false,
                clusterDisableClickZoom: false,
                clusterHideIconOnBalloonOpen: false,
                geoObjectHideIconOnBalloonOpen: false,
                clusterBalloonContentLayout: 'cluster#balloonCarousel',
                clusterBalloonPanelMaxMapArea: 0,
                clusterBalloonContentLayoutWidth: 300,
                clusterBalloonContentLayoutHeight: 200,
                clusterBalloonPagerSize: 5,
                clusterNumbers: [2],
                clusterMaxZoom: 16,
                gridSize: 80
            });
            
            myMap.geoObjects.add(clusterer);
        }
        
        function addRandomMarkers(count) {
            const newMarkers = [];
            const center = myMap.getCenter();
            
            for (let i = 0; i < count; i++) {
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–æ–∫—Ä—É–≥ —Ü–µ–Ω—Ç—Ä–∞
                const offset = 0.1; // –†–∞–¥–∏—É—Å —Ä–∞–∑–±—Ä–æ—Å–∞
                const lat = center[0] + (Math.random() - 0.5) * offset;
                const lng = center[1] + (Math.random() - 0.5) * offset;
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫
                const rating = Math.random() * 5;
                let preset = 'islands#grayIcon';
                
                if (rating >= 4.5) {
                    preset = 'islands#goldIcon';
                } else if (rating >= 4) {
                    preset = 'islands#greenIcon';
                } else if (rating >= 3) {
                    preset = 'islands#blueIcon';
                }
                
                const placemark = new ymaps.Placemark([lat, lng], {
                    balloonContentHeader: `–ú–∞—Å—Ç–µ—Ä #${markers.length + i + 1}`,
                    balloonContentBody: `
                        <div>
                            <p>‚≠ê –†–µ–π—Ç–∏–Ω–≥: ${rating.toFixed(1)}</p>
                            <p>üí∞ –æ—Ç ${Math.floor(1000 + Math.random() * 4000)} ‚ÇΩ</p>
                            <p>üìç ${getRandomDistrict()}</p>
                        </div>
                    `,
                    clusterCaption: `–ú–∞—Å—Ç–µ—Ä #${markers.length + i + 1}`
                }, {
                    preset: preset,
                    draggable: false
                });
                
                newMarkers.push(placemark);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã
            if (clusteringEnabled) {
                clusterer.add(newMarkers);
            } else {
                newMarkers.forEach(marker => {
                    myMap.geoObjects.add(marker);
                });
            }
            
            markers.push(...newMarkers);
            updateStats();
        }
        
        function clearAllMarkers() {
            if (clusteringEnabled) {
                clusterer.removeAll();
            } else {
                markers.forEach(marker => {
                    myMap.geoObjects.remove(marker);
                });
            }
            markers = [];
            updateStats();
        }
        
        function toggleClustering() {
            clusteringEnabled = !clusteringEnabled;
            
            // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –≤—Å–µ –º–∞—Ä–∫–µ—Ä—ã
            const tempMarkers = [...markers];
            clearAllMarkers();
            
            if (clusteringEnabled) {
                clusterer.add(tempMarkers);
            } else {
                tempMarkers.forEach(marker => {
                    myMap.geoObjects.add(marker);
                });
            }
            
            markers = tempMarkers;
            updateStats();
        }
        
        function centerOnPerm() {
            myMap.setCenter(PERM_CENTER, 12, {
                duration: 500
            });
        }
        
        function onBoundsChange() {
            const zoom = myMap.getZoom();
            const bounds = myMap.getBounds();
            
            document.getElementById('currentZoom').textContent = zoom.toFixed(0);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—ã
            if (bounds) {
                const sw = bounds[0];
                const ne = bounds[1];
                document.getElementById('visibleBounds').textContent = 
                    `${sw[0].toFixed(3)}, ${sw[1].toFixed(3)} - ${ne[0].toFixed(3)}, ${ne[1].toFixed(3)}`;
                
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–µ–Ω–∏–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É
                // loadMarkersInBounds(bounds);
            }
        }
        
        function updateStats() {
            document.getElementById('totalMarkers').textContent = markers.length;
            document.getElementById('clusterStatus').textContent = 
                clusteringEnabled ? '–í–∫–ª—é—á–µ–Ω–∞' : '–í—ã–∫–ª—é—á–µ–Ω–∞';
        }
        
        function getRandomDistrict() {
            const districts = [
                '–õ–µ–Ω–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω',
                '–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω',
                '–ú–æ—Ç–æ–≤–∏–ª–∏—Ö–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω',
                '–ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π —Ä–∞–π–æ–Ω',
                '–î–∑–µ—Ä–∂–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω',
                '–ö–∏—Ä–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω',
                '–û—Ä–¥–∂–æ–Ω–∏–∫–∏–¥–∑–µ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω'
            ];
            return districts[Math.floor(Math.random() * districts.length)];
        }
    </script>
</body>
</html>