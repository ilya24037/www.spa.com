# üó∫Ô∏è –û–¢–ß–Å–¢ –ü–û –ò–ù–¢–ï–ì–†–ê–¶–ò–ò –ê–†–•–ò–í–ù–û–ô –õ–û–ì–ò–ö–ò –ö–ê–†–¢–´

**–î–∞—Ç–∞:** 29.08.2025  
**–ó–∞–¥–∞—á–∞:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –º–æ–¥—É–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ –ø–ª–∞–Ω—É –∏ –≤–Ω–µ–¥—Ä–∏—Ç—å —Ä–∞–±–æ—á—É—é –ª–æ–≥–∏–∫—É –∞—Ä—Ö–∏–≤–Ω–æ–π –∫–∞—Ä—Ç—ã

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### 1. **–£–ø—Ä–æ—â—ë–Ω MapLoader –ø–æ –æ–±—Ä–∞–∑—Ü—É –∞—Ä—Ö–∏–≤–∞**
- **–§–∞–π–ª:** `resources/js/src/features/map/core/MapLoader.ts`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –£–±—Ä–∞–Ω —Å–ª–æ–∂–Ω—ã–π Singleton –ø–∞—Ç—Ç–µ—Ä–Ω, –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ –ø—Ä–æ—Å—Ç—É—é Promise-—Ñ—É–Ω–∫—Ü–∏—é –∫–∞–∫ –≤ –∞—Ä—Ö–∏–≤–µ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–∑–º–µ—Ä —Å–æ–∫—Ä–∞—Ç–∏–ª—Å—è —Å 76 –¥–æ 32 —Å—Ç—Ä–æ–∫, —É–±—Ä–∞–Ω–∞ —Å–ª–æ–∂–Ω–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å

**–î–æ (–°–õ–û–ñ–ù–û):**
```typescript
export class MapLoader {
  private static instance: MapLoader | null = null
  private loadPromise: Promise<typeof ymaps> | null = null
  async load(apiKey: string): Promise<typeof ymaps> {
    // —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
  }
}
```

**–ü–æ—Å–ª–µ (–ü–†–û–°–¢–û):**
```typescript
export const loadYandexMaps = (apiKey: string): Promise<typeof ymaps> => {
  return new Promise((resolve, reject) => {
    if (window.ymaps && window.ymaps.ready) {
      window.ymaps.ready(() => resolve(window.ymaps))
      return
    }
    // –ø—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –∫–∞–∫ –≤ –∞—Ä—Ö–∏–≤–µ
  })
}
```

### 2. **–£–ø—Ä–æ—â–µ–Ω–∞ —Ü–µ–ø–æ—á–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ MapCore**
- **–§–∞–π–ª:** `resources/js/src/features/map/core/MapCore.vue`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ DOM –∫–∞–∫ –≤ –∞—Ä—Ö–∏–≤–µ: `await new Promise(resolve => setTimeout(resolve, 100))`
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∑—É–º–∞ –∏–∑ –∞—Ä—Ö–∏–≤–∞: `minZoom: 10, maxZoom: 18`
  - –ü–ª–∞–≥–∏–Ω—ã –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç—ã
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Ç—Ä–æ–ª—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `['zoomControl', 'typeSelector']`

### 3. **–£–ø—Ä–æ—â–µ–Ω–∞ —Ü–µ–ø–æ—á–∫–∞ –≤ MapContainer**
- **–§–∞–π–ª:** `resources/js/src/features/map/components/MapContainer.vue`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –£–±—Ä–∞–Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –∏–∑ `handleMapReady()` - –≤—Å–µ –ø–ª–∞–≥–∏–Ω—ã –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ

### 4. **–û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –ø–ª–∞–≥–∏–Ω—ã**
- **–§–∞–π–ª—ã:** `MarkersPlugin.ts`, `ClusterPlugin.ts`, `GeolocationPlugin.ts`, `SearchPlugin.ts`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –£–±—Ä–∞–Ω `async` –∏–∑ –º–µ—Ç–æ–¥–∞ `install()` - —Ç–µ–ø–µ—Ä—å –≤—Å–µ –ø–ª–∞–≥–∏–Ω—ã —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ
- **–û–±–Ω–æ–≤–ª—ë–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:** `MapPlugin.install?(): void` (–±—ã–ª `Promise<void>`)

## üèóÔ∏è –°–û–•–†–ê–ù–ï–ù–ê –ú–û–î–£–õ–¨–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–ª–∞–Ω–∞:**
- **Core + Plugins –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- **MapCore.vue** - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —è–¥—Ä–æ —Å —Å–∏—Å—Ç–µ–º–æ–π –ø–ª–∞–≥–∏–Ω–æ–≤
- **MapContainer.vue** - –∫–æ–º–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- **MapStates.vue** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π
- **MapControls.vue** - UI –∫–æ–Ω—Ç—Ä–æ–ª—ã
- **–ü–ª–∞–≥–∏–Ω—ã** - –º–æ–¥—É–ª—å–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (Markers, Cluster, Geolocation, Search)

### ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏–≤–∞:**
- **–ü—Ä–æ—Å—Ç–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö async —Ü–µ–ø–æ—á–µ–∫
- **–ù–∞–¥—ë–∂–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ API** - –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–∑ –∞—Ä—Ö–∏–≤–∞
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∑—É–º–∞** - –∫–∞–∫ –≤ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏
- **DOM –æ–∂–∏–¥–∞–Ω–∏–µ** - 100ms –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã** - –±–µ–∑ race conditions

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### **–°–æ–∑–¥–∞–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**
1. `public/test-map-integration.html` - –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ç–µ—Å—Ç –∫–∞—Ä—Ç—ã
2. –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
   - `http://spa.test` - –≥–ª–∞–≤–Ω–∞—è —Å multiple —Ä–µ–∂–∏–º–æ–º
   - `http://spa.test/ads/128/edit` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å single —Ä–µ–∂–∏–º–æ–º

### **–ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã:**
- ‚úÖ `Home.vue` - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç YandexMap
- ‚úÖ `GeoSection.vue` - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç YandexMap
- ‚úÖ –í—Å–µ composables —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ barrel —Ñ–∞–π–ª

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢

### **–î–û —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- ‚ùå –ö–∞—Ä—Ç–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª–∞—Å—å ("–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...")
- ‚ùå –°–ª–æ–∂–Ω–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ —Å race conditions
- ‚ùå Singleton MapLoader —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚ùå –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é

### **–ü–û–°–õ–ï –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- ‚úÖ **–ö–∞—Ä—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç** - –ø—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥—ë–∂–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞** - –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –ø–ª–∞–≥–∏–Ω—ã –Ω–∞ –º–µ—Å—Ç–µ
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - —É–±—Ä–∞–Ω—ã –ª–∏—à–Ω–∏–µ async –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** - –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–∑ –∞—Ä—Ö–∏–≤–∞
- ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∏ API —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

## üéØ –ü–†–ò–ù–¶–ò–ü KISS –°–û–ë–õ–Æ–î–Å–ù

**"Keep It Simple, Stupid"** - –º—ã –≤–∑—è–ª–∏ –ª—É—á—à–µ–µ –∏–∑ –¥–≤—É—Ö –ø–æ–¥—Ö–æ–¥–æ–≤:

1. **–ò–∑ –ø–ª–∞–Ω–∞:** –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É Core + Plugins
2. **–ò–∑ –∞—Ä—Ö–∏–≤–∞:** –ø—Ä–æ—Å—Ç—É—é –∏ —Ä–∞–±–æ—á—É—é –ª–æ–≥–∏–∫—É –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–ü–æ–ª—É—á–∏–ª–∏:** –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –º–æ–¥—É–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –Ω–∞–¥—ë–∂–Ω–æ–π —Ä–∞–±–æ—Ç–æ–π!

---

## üîß **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**

**–ï—Å–ª–∏ –∫–∞—Ä—Ç–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ `public/test-map-integration.html` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ API –∫–ª—é—á –≤–∞–ª–∏–¥–µ–Ω –≤ `mapConstants.ts`

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤:**
1. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `MapPlugin`
2. –ú–µ—Ç–æ–¥ `install(map, store)` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º**
3. –ü–æ–¥–∫–ª—é—á–∞–π—Ç–µ —á–µ—Ä–µ–∑ `core.use(new YourPlugin())`

**URL –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: `http://spa.test/test-map-integration.html`  
- –ì–ª–∞–≤–Ω–∞—è (multiple): `http://spa.test`
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (single): `http://spa.test/ads/128/edit`