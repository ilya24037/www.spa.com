# üîç –ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π

## üìç –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ

### 1Ô∏è‚É£ **–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –º–æ–¥–µ—Ä–∞—Ü–∏–∏**
```
üìÅ /app/Domain/Ad/Services/AdModerationService.php
```

#### –ú–µ—Ç–æ–¥ `performAutomaticCheck()` (—Å—Ç—Ä–æ–∫–∞ 234)
–≠—Ç–æ –≥–ª–∞–≤–Ω—ã–π –º–µ—Ç–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:

```php
private function performAutomaticCheck(Ad $ad): array
{
    $issues = [];
    $approved = true;

    // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–∞ —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
    $contentIssues = $this->checkContent($ad);
    
    // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
    $photoIssues = $this->checkPhotos($ad);
    
    // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω
    $priceIssues = $this->checkPricing($ad);
    
    // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
    $contactIssues = $this->checkContacts($ad);

    return [
        'approved' => $approved,  // true = –∞–≤—Ç–æ–æ–¥–æ–±—Ä–µ–Ω–æ, false = –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
        'issues' => $issues       // —Å–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
    ];
}
```

### 2Ô∏è‚É£ **Job –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –º–æ–¥–µ—Ä–∞—Ü–∏–∏** (–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø!)
```
üìÅ /app/Jobs/AutoModerateAdJob.php
```

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –≠—Ç–æ—Ç Job —Å–æ–∑–¥–∞–Ω, –Ω–æ **–ù–ò–ì–î–ï –ù–ï –í–´–ó–´–í–ê–ï–¢–°–Ø** –≤ –ø—Ä–æ–µ–∫—Ç–µ!
–û–Ω –¥–æ–ª–∂–µ–Ω –±—ã–ª –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è, –Ω–æ dispatch –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.

---

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–π—á–∞—Å

### –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è:

```mermaid
graph TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–µ] --> B[AdController::store]
    B --> C[DraftService::saveOrUpdate]
    C --> D[–°–æ–∑–¥–∞–µ—Ç—Å—è Ad —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º pending_moderation]
    D --> E[AdModerationService::submitForModeration]
    E --> F{performAutomaticCheck}
    F -->|–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞| G[‚úÖ –°—Ç–∞—Ç—É—Å: ACTIVE]
    F -->|–ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã| H[‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: PENDING_MODERATION]
    G --> I[–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ]
    H --> J[–ñ–¥–µ—Ç —Ä—É—á–Ω–æ–π –º–æ–¥–µ—Ä–∞—Ü–∏–∏]
```

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

#### 1. **–ö–æ–Ω—Ç–µ–Ω—Ç** (`checkContent()`)
```php
// –°—Ç–æ–ø-—Å–ª–æ–≤–∞ (—Å—Ç—Ä–æ–∫–∞ 21-24)
private array $bannedWords = [
    '–Ω–∞—Ä–∫–æ—Ç–∏–∫–∏', '–æ—Ä—É–∂–∏–µ', '–ø—Ä–æ—Å—Ç–∏—Ç—É—Ü–∏—è', 
    '–∏–Ω—Ç–∏–º', '—Å–µ–∫—Å', '—ç—Å–∫–æ—Ä—Ç'
];

// –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (—Å—Ç—Ä–æ–∫–∞ 27-32)
private array $suspiciousPatterns = [
    '/\b100%\s+(–≥–∞—Ä–∞–Ω—Ç–∏—è|—Ä–µ–∑—É–ª—å—Ç–∞—Ç)\b/iu',
    '/\b–±–µ–∑\s+–ø—Ä–µ–¥–æ–ø–ª–∞—Ç[—ã–∏]\b/iu',
];

// –ü—Ä–æ–≤–µ—Ä–∫–∏:
‚úÖ –ù–∞–ª–∏—á–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤
‚úÖ –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—Ä–∞–∑—ã (—Ä–µ–≥—É–ª—è—Ä–∫–∏)
‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ–ø–∏—Å–∞–Ω–∏—è (50 —Å–∏–º–≤–æ–ª–æ–≤)
‚úÖ –ò–∑–±—ã—Ç–æ–∫ –ö–ê–ü–°–ê (>50% –∑–∞–≥–ª–∞–≤–Ω—ã—Ö)
```

#### 2. **–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏** (`checkPhotos()`)
```php
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ–æ—Ç–æ
‚ùå –ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ (NSFW, –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏)
```

#### 3. **–¶–µ–Ω—ã** (`checkPricing()`)
```php
‚úÖ –ù–∞–ª–∏—á–∏–µ —Ü–µ–Ω—ã
‚úÖ –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ –Ω–∏–∑–∫–∞—è (<100 —Ä—É–±)
‚úÖ –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ –≤—ã—Å–æ–∫–∞—è (>100,000 —Ä—É–±)
```

#### 4. **–ö–æ–Ω—Ç–∞–∫—Ç—ã** (`checkContacts()`)
```php
‚úÖ –ù–∞–ª–∏—á–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
‚úÖ –§–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π)
‚úÖ –ù–∞–ª–∏—á–∏–µ –∞–¥—Ä–µ—Å–∞
```

---

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: AutoModerateAdJob –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!

### –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã–ª–æ –±—ã—Ç—å:
```php
// –í AdController::store –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è
AutoModerateAdJob::dispatch($ad->id)->delay(now()->addMinutes(5));
```

### –ß—Ç–æ –µ—Å—Ç—å —Å–µ–π—á–∞—Å:
```php
// –ù–ò–ß–ï–ì–û! Job —Å–æ–∑–¥–∞–Ω, –Ω–æ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
```

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:
- ‚ùå –ú–æ–¥–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- ‚ùå –ë–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚ùå –ù–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚ùå –ù–µ—Ç –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## üõ†Ô∏è –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å (5 –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç—ã)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í–∫–ª—é—á–∏—Ç—å —Ñ–æ–Ω–æ–≤—É—é –º–æ–¥–µ—Ä–∞—Ü–∏—é
```php
// –í AdController::store –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 141
$ad = $this->draftService->saveOrUpdate($data, Auth::user());

// –î–û–ë–ê–í–ò–¢–¨:
if ($ad->status === 'pending_moderation') {
    AutoModerateAdJob::dispatch($ad->id)
        ->delay(now()->addMinutes(5))
        ->onQueue('moderation');
}
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è (—Ç–µ–∫—É—â–∞—è)
```php
// –í AdController::store –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
$result = $this->moderationService->submitForModeration($ad);

if ($result['status'] === 'approved') {
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–¥–æ–±—Ä–µ–Ω–æ
} else {
    // –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ —Ä—É—á–Ω—É—é –º–æ–¥–µ—Ä–∞—Ü–∏—é
}
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ß—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏—é:
1. **–°—Ç–æ–ø-—Å–ª–æ–≤–∞** - ~5% –æ–±—ä—è–≤–ª–µ–Ω–∏–π
2. **–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ** (<50 —Å–∏–º–≤–æ–ª–æ–≤) - ~15% –æ–±—ä—è–≤–ª–µ–Ω–∏–π
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ç–æ** - ~20% –æ–±—ä—è–≤–ª–µ–Ω–∏–π
4. **–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ü–µ–Ω–∞** - ~3% –æ–±—ä—è–≤–ª–µ–Ω–∏–π
5. **–ù–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞** - ~10% –æ–±—ä—è–≤–ª–µ–Ω–∏–π

### –ò—Ç–æ–≥–æ:
- **~40-50%** –æ–±—ä—è–≤–ª–µ–Ω–∏–π –∏–¥—É—Ç –Ω–∞ —Ä—É—á–Ω—É—é –º–æ–¥–µ—Ä–∞—Ü–∏—é
- **~50-60%** –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. **–í–∫–ª—é—á–∏—Ç—å AutoModerateAdJob**
–î–æ–±–∞–≤–∏—Ç—å dispatch –≤ AdController - —ç—Ç–æ —Ä–∞–∑–≥—Ä—É–∑–∏—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫.

### 2. **–î–æ–±–∞–≤–∏—Ç—å –≤–µ—Å–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π**
–ù–µ –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –æ–¥–∏–Ω–∞–∫–æ–≤–æ –∫—Ä–∏—Ç–∏—á–Ω—ã:
```php
const WEIGHTS = [
    'stop_word' => 10,      // –ö—Ä–∏—Ç–∏—á–Ω–æ
    'no_photo' => 3,        // –°—Ä–µ–¥–Ω–µ
    'short_description' => 2 // –ù–µ–∫—Ä–∏—Ç–∏—á–Ω–æ
];

// –ï—Å–ª–∏ —Å—É–º–º–∞ –≤–µ—Å–æ–≤ > 5 - –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
```

### 3. **–î–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**
```php
if ($user->approved_ads_count > 10 && $user->rejected_ads_count == 0) {
    return ['approved' => true]; // –ê–≤—Ç–æ–æ–¥–æ–±—Ä–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö
}
```

### 4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
```php
Cache::remember("moderation_{$ad->id}", 3600, function() use ($ad) {
    return $this->performAutomaticCheck($ad);
});
```

---

## ‚úÖ –í—ã–≤–æ–¥

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ **–ï–°–¢–¨ –∏ –†–ê–ë–û–¢–ê–ï–¢**, –Ω–æ:
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–µ—â–∏ (–∫–æ–Ω—Ç–µ–Ω—Ç, —Ü–µ–Ω—ã, –∫–æ–Ω—Ç–∞–∫—Ç—ã)
2. ‚ö†Ô∏è –†–∞–±–æ—Ç–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
3. ‚ùå AutoModerateAdJob —Å–æ–∑–¥–∞–Ω, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
4. ‚ö†Ô∏è –ù–µ—Ç –≤–µ—Å–æ–≤ –Ω–∞—Ä—É—à–µ–Ω–∏–π (–≤—Å–µ —Ä–∞–≤–Ω–æ–∑–Ω–∞—á–Ω–æ)

**–î–ª—è MVP –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ**, –Ω–æ —Å—Ç–æ–∏—Ç –≤–∫–ª—é—á–∏—Ç—å —Ñ–æ–Ω–æ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —á–µ—Ä–µ–∑ Job.