<!DOCTYPE html>
<html>
<head>
    <title>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –º–∞—Å—Ç–µ—Ä—É</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 50px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        .button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 15px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .photo-preview { max-width: 200px; max-height: 200px; margin: 10px 0; }
        .instructions { background: #e9ecef; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –º–∞—Å—Ç–µ—Ä—É</h1>
    
    <div class="instructions">
        <h3>üìÅ –ì–¥–µ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏:</h3>
        <p><strong>–í–∞—Ä–∏–∞–Ω—Ç 1:</strong> –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤ –ø–∞–ø–∫—É <code>public/images/masters/</code></p>
        <p><strong>–í–∞—Ä–∏–∞–Ω—Ç 2:</strong> –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤ –ø–∞–ø–∫—É <code>storage/app/public/masters/</code></p>
        <p><strong>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:</strong> JPG, PNG, GIF (–¥–æ 2MB)</p>
    </div>

    <form id="uploadForm">
        <div class="form-group">
            <label for="master_id">ID –º–∞—Å—Ç–µ—Ä–∞:</label>
            <input type="number" id="master_id" value="3" required>
            <small>ID –º–∞—Å—Ç–µ—Ä–∞ –ï–ª–µ–Ω—ã –°–∏–¥–æ—Ä–æ–≤–æ–π: 3</small>
        </div>

        <div class="form-group">
            <label for="file_path">–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É:</label>
            <input type="text" id="file_path" placeholder="images/masters/photo1.jpg" required>
            <small>–ü—Ä–∏–º–µ—Ä: images/masters/elena1.jpg –∏–ª–∏ storage/masters/elena2.jpg</small>
        </div>

        <div class="form-group">
            <label for="is_main">–°–¥–µ–ª–∞—Ç—å –≥–ª–∞–≤–Ω–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π:</label>
            <select id="is_main">
                <option value="false">–ù–µ—Ç</option>
                <option value="true">–î–∞</option>
            </select>
        </div>

        <button type="submit" class="button">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</button>
    </form>

    <div id="result"></div>

    <hr>

    <h2>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h2>
    <form id="fileUploadForm" enctype="multipart/form-data">
        <div class="form-group">
            <label for="master_id_upload">ID –º–∞—Å—Ç–µ—Ä–∞:</label>
            <input type="number" id="master_id_upload" value="3" required>
        </div>

        <div class="form-group">
            <label for="photos">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏:</label>
            <input type="file" id="photos" name="photos[]" multiple accept="image/*" required>
        </div>

        <button type="submit" class="button">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</button>
    </form>

    <div id="uploadResult"></div>

    <script>
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            
            const formData = {
                master_id: document.getElementById('master_id').value,
                file_path: document.getElementById('file_path').value,
                is_main: document.getElementById('is_main').value === 'true'
            };
            
            try {
                const response = await fetch('http://127.0.0.1:8000/master/photos/local', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-TOKEN': await getCSRFToken()
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="result success">
                            <h3>‚úÖ –£—Å–ø–µ—à–Ω–æ!</h3>
                            <p>${data.message}</p>
                            <img src="${data.photo.url}" class="photo-preview" alt="–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ —Ñ–æ—Ç–æ">
                            <p><a href="http://127.0.0.1:8000/masters/elena-sidorova-3" target="_blank">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º–∞—Å—Ç–µ—Ä–∞</a></p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result error">
                            <h3>‚ùå –û—à–∏–±–∫–∞</h3>
                            <p>${data.error}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå –û—à–∏–±–∫–∞</h3>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å: ${error.message}</p>
                    </div>
                `;
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
        document.getElementById('fileUploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('uploadResult');
            resultDiv.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            
            const formData = new FormData();
            const masterId = document.getElementById('master_id_upload').value;
            const photos = document.getElementById('photos').files;
            
            for (let i = 0; i < photos.length; i++) {
                formData.append('photos[]', photos[i]);
            }
            
            try {
                const response = await fetch(`http://127.0.0.1:8000/masters/${masterId}/photos`, {
                    method: 'POST',
                    headers: {
                        'X-CSRF-TOKEN': await getCSRFToken()
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    let photosHtml = '';
                    data.photos.forEach(photo => {
                        photosHtml += `<img src="${photo.url}" class="photo-preview" alt="–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ —Ñ–æ—Ç–æ">`;
                    });
                    
                    resultDiv.innerHTML = `
                        <div class="result success">
                            <h3>‚úÖ –£—Å–ø–µ—à–Ω–æ!</h3>
                            <p>${data.message}</p>
                            <div>${photosHtml}</div>
                            <p><a href="http://127.0.0.1:8000/masters/elena-sidorova-3" target="_blank">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º–∞—Å—Ç–µ—Ä–∞</a></p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result error">
                            <h3>‚ùå –û—à–∏–±–∫–∞</h3>
                            <p>${data.error}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå –û—à–∏–±–∫–∞</h3>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å: ${error.message}</p>
                    </div>
                `;
            }
        });

        // –ü–æ–ª—É—á–µ–Ω–∏–µ CSRF —Ç–æ–∫–µ–Ω–∞
        async function getCSRFToken() {
            try {
                const response = await fetch('http://127.0.0.1:8000/');
                const text = await response.text();
                const match = text.match(/name="csrf-token" content="([^"]+)"/);
                return match ? match[1] : '';
            } catch {
                return '';
            }
        }
    </script>
</body>
</html> 