# Инженерия контекста (Context Engineering)

Обновлено: 08.08.2025

Этот документ описывает правила и шаблоны работы с ИИ‑помощником в проекте SPA Platform. Цель — ускорить совместную работу, снизить стоимость токенов и повысить качество решений за счёт правильной подачи контекста.

Ссылка на источник идей: https://habr.com/ru/articles/934244/

## 1) Базовые принципы

- Минимальный релевантный контекст: даём только нужные файлы/фрагменты.
- Структура запроса: Цель → Ограничения → Пути к файлам → Формат ответа.
- «Один шаг — один файл»: выполняем правки маленькими порциями, сразу проверяем.
- RAG‑лайт: вместо «всего проекта» — короткие выдержки + пути.
- Формат ответа от ИИ: полный код файла без сокращений + 1 команда PowerShell + шаги проверки.
- Фронтенд‑правило: страницы — `resources/js/Pages/*`, UI/логика — в `resources/js/src/*` по FSD.
- Прод: тестовые/временные маршруты скрывать (feature flag или не подключать в prod).

## 2) Политика токен‑бюджета

- Бриф задачи ≤ 10–15 строк.
- Контекст‑пак (конспект файлов) ≤ 50–100 КБ или ≤ ~500 строк суммарно.
- Длинные логи/бинарники не прикладываем — делаем выжимку.
- Если контекста много — делим задачу на подпроцессы (A/B/C) и решаем последовательно.

## 3) Ритуал работы «Ты + ИИ»

1. Ты формулируешь мини‑бриф (см. шаблон ниже). Можно свободным текстом — ИИ структурирует.
2. ИИ делает короткий discovery и отдаёт план шагов.
3. Идём по шагам: «один шаг — один файл». ИИ присылает полный файл + 1 команду + проверку.
4. Ты запускаешь команду, присылаешь результат. При успехе — следующий шаг; при ошибке — мини‑диагностика.

## 4) Шаблоны

### 4.1 task-brief.md (бриф задачи)
```
Цель: <что должно получиться за этот шаг>
Контекст: <модуль/где правим>
Ограничения: Laravel 12, Vue 3 + Inertia, Pinia, Tailwind, Windows
Файлы/модули: <точные пути>
Формат ответа: полный код файла + 1 команда PowerShell + шаги проверки
```

### 4.2 code-change.md (правка кода)
```
Что изменить: <суть правки и ожидаемое поведение>
Где: `путь/к/файлу`
Критерии готовности: <что и как проверяем>
Формат ответа: полный код файла + 1 команда PowerShell + шаги проверки
```

### 4.3 debug.md (отладка)
```
Симптом: <что не работает>
Гипотезы: <1–3 возможные причины>
Проверки: <какие логи/маршруты/запросы проверить>
Ожидание: <какой результат хотим увидеть>
```

### 4.4 review.md (код‑ревью)
```
Контекст: <какие файлы/компоненты>
Фокус: архитектура / производительность / DX / соответствие FSD
Вывод: <итог, must‑fix / можно позже>
```

### 4.5 bug-report.md (баг‑репорт)
```
Шаги воспроизведения: 1) … 2) … 3) …
Ожидали: …
Фактически: …
Окружение: браузер/Windows, версия ветки
Логи/скрин: кратко (без гигантских вложений)
```

## 5) Автоматизация (контекст‑пак)

Мы добавим скрипт `scripts/ai/create-context-pack.ps1`, который:
- Принимает параметры: `-Module <routes|booking|search|...>` и `-Out <путь к .md>`.
- Ищет релевантные файлы по модулю (php, vue, ts), извлекает заголовки/сигнатуры, формирует выжимку.
- Сохраняет Markdown‑файл в `storage/ai-sessions/<yyyy-mm-dd>/<task>.md`.
- Опционально может исключать большие файлы/папки (`node_modules`, `public/build`, `vendor`).

Пример использования (после добавления скрипта):
```
chcp 65001 >nul; .\scripts\ai\create-context-pack.ps1 -Module routes -Out "storage/ai-sessions/$(Get-Date -Format yyyy-MM-dd)/routes-cleanup.md"
```

## 6) Команды и проверка (Windows)

- Вывод файла в UTF‑8: `chcp 65001 >nul; type .\path\to\file.md`
- Список маршрутов: `php artisan route:list | cat`
- Поиск дублей по маршрутам: `php artisan route:list | findstr /I "masters/.*/avatar"`
- Жёсткое обновление фронта: в браузере Ctrl+F5 (vite dev уже запущен).

## 7) Нормы проекта (важно)

- Не грузим «весь проект» в запрос — только нужные пути и выдержки.
- От ИИ всегда просим: полный код изменённого файла + 1 команда + «как проверить».
- Фронт: используем `npm run dev`, сборку делаем только по запросу.
- Windows/кодировка: для bat/PowerShell добавляем `chcp 65001`.
- Навигация Inertia: используем `Link`, избегаем нестандартных кликов.

---

Если документ нужно расширить примерами под конкретный модуль (например, Booking или Routes), добавим раздел 8) с готовыми сценариями.
