# üì∏ –û–¢–ß–ï–¢: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

**–î–∞—Ç–∞:** 19 –∞–≤–≥—É—Å—Ç–∞ 2025  
**–ü—Ä–æ–µ–∫—Ç:** SPA Platform  
**–ü—Ä–æ–±–ª–µ–º–∞:** –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —á–µ—Ä–Ω–æ–≤–∏–∫–∞

---

## üî¥ –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

### –°–∏–º–ø—Ç–æ–º—ã:
1. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è –æ–Ω–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
2. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫" —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
3. –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤–∏–¥–Ω—ã –æ—à–∏–±–∫–∏ —Ç–∏–ø–∞ `TypeError: form.photos.forEach is not a function`

### –°–∫—Ä–∏–Ω—à–æ—Ç –æ—à–∏–±–∫–∏:
- –ö–æ–Ω—Å–æ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Ä–∞–±–æ—Ç—ã —Å –º–∞—Å—Å–∏–≤–æ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- FormData —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏, –Ω–æ –æ–Ω–∏ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –¥–ª—è PUT –∑–∞–ø—Ä–æ—Å–∞

---

## üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´

### –ö–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ FormData**
   - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç PhotoGallery –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã —Å –ø–æ–ª—è–º–∏ (id, url, preview, file)
   - –ü—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ FormData –≤ plainData —ç—Ç–∏ –æ–±—ä–µ–∫—Ç—ã —Ç–µ—Ä—è–ª–∏—Å—å

2. **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö**
   - Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
   - Backend –æ–∂–∏–¥–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ (URL)

3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π –º–∞—Å—Å–∏–≤–æ–≤**
   - –ü—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ `photos[0]`, `photos[1]` –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ–±–∏—Ä–∞–ª–∏—Å—å –≤ –º–∞—Å—Å–∏–≤

---

## ‚úÖ –ü–†–ò–ú–ï–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ FormData

**–§–∞–π–ª:** `resources/js/src/features/ad-creation/model/adFormModel.ts`

```typescript
// –ë–´–õ–û: —Ç–æ–ª—å–∫–æ File –∏ string
if (photo instanceof File) {
  formData.append(`photos[${index}]`, photo)
} else if (typeof photo === 'string') {
  formData.append(`photos[${index}]`, photo)
}

// –°–¢–ê–õ–û: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤
if (photo instanceof File) {
  formData.append(`photos[${index}]`, photo)
} else if (typeof photo === 'string') {
  formData.append(`photos[${index}]`, photo)
} else if (typeof photo === 'object' && photo !== null) {
  // –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ä–µ–∫—Ç —Å url –∏–ª–∏ –¥—Ä—É–≥–∏–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏, –ø–µ—Ä–µ–¥–∞–µ–º url
  formData.append(`photos[${index}]`, photo.url || photo.preview || JSON.stringify(photo))
}
```

### 2. –£–ª—É—á—à–µ–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è FormData –≤ plainData

```typescript
// –ë–´–õ–û: –ø—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –º–∞—Å—Å–∏–≤
if (arrayMatch) {
  const fieldName = arrayMatch[1]
  if (!plainData[fieldName]) {
    plainData[fieldName] = []
  }
  plainData[fieldName].push(value)
}

// –°–¢–ê–õ–û: —Å —É—á–µ—Ç–æ–º –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ –ø–∞—Ä—Å–∏–Ω–≥–æ–º JSON
if (arrayMatch) {
  const fieldName = arrayMatch[1]
  const index = parseInt(arrayMatch[2])
  if (!plainData[fieldName]) {
    plainData[fieldName] = []
  }
  // –î–ª—è –º–µ–¥–∏–∞ –ø–æ–ª–µ–π –ø—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON
  if ((fieldName === 'photos' || fieldName === 'video') && typeof value === 'string') {
    if (value.startsWith('{')) {
      try {
        plainData[fieldName][index] = JSON.parse(value)
      } catch (e) {
        plainData[fieldName][index] = value
      }
    } else {
      plainData[fieldName][index] = value
    }
  } else {
    plainData[fieldName][index] = value
  }
}
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```typescript
console.log('üì∏ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ photos:', {
  photos: plainData.photos,
  photos_length: plainData.photos?.length,
  photos_type: typeof plainData.photos,
  first_photo: plainData.photos?.[0]
})
```

**Backend –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```php
\Log::info('DraftService: –í—Ö–æ–¥—è—â–∏–µ —Ñ–æ—Ç–æ', [
    'photos_raw' => $data['photos'] ?? '–ù–ï–¢',
    'photos_type' => gettype($data['photos'] ?? null),
    'photos_is_array' => is_array($data['photos'] ?? null)
]);
```

---

## üìã –ß–¢–û –ù–£–ñ–ù–û –ü–†–û–í–ï–†–ò–¢–¨

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (Ctrl+F5)
2. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤ —Ñ–æ—Ä–º—É
3. –ù–∞–∂–∞—Ç—å "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫"
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å - –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ `üì∏ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ photos:`
5. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å

### –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∏–¥–Ω–æ:
```javascript
üì∏ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ photos: {
  photos: ["url1", "url2", ...],
  photos_length: 3,
  photos_type: "object",
  first_photo: "url1"
}
```

### –í –ª–æ–≥–∞—Ö Laravel:
```
[2025-08-19 XX:XX:XX] laravel.INFO: DraftService: –í—Ö–æ–¥—è—â–∏–µ —Ñ–æ—Ç–æ 
{"photos_raw":["url1","url2"],"photos_type":"array","photos_is_array":true}
```

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã:**
   - –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ console.log –∏–∑ frontend
   - –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ Log::info –∏–∑ backend

2. **–í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—Å–∂–∞—Ç–∏–µ –Ω–∞ frontend)
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –Ω–∞ CDN

---

## üìö –£–†–û–ö–ò

1. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö** –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –º–µ–∂–¥—É frontend –∏ backend
2. **FormData + PUT –≤ Inertia** —Ç—Ä–µ–±—É–µ—Ç –æ—Å–æ–±–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
3. **–û–±—ä–µ–∫—Ç—ã –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤** –Ω—É–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å
4. **–ò–Ω–¥–µ–∫—Å—ã –º–∞—Å—Å–∏–≤–æ–≤** –≤–∞–∂–Ω—ã –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ FormData

---

## üîß –§–ò–ù–ê–õ–¨–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (19.08.2025 - –æ–±–Ω–æ–≤–ª–µ–Ω–æ)

### –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ DraftController

**–§–∞–π–ª:** `app/Application/Http/Controllers/Ad/DraftController.php`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π FormData:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Å—Å–∏–≤–∞ `photos` –Ω–∞–ø—Ä—è–º—É—é
- Fallback –Ω–∞ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è `photos[0]`, `photos[1]`
- –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∫ –≤ –º–µ—Ç–æ–¥–µ `update`, —Ç–∞–∫ –∏ –≤ `store`

```php
// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª –ø–æ –∏–Ω–¥–µ–∫—Å—É
if ($request->hasFile("photos.{$index}")) {
    $file = $request->file("photos.{$index}");
    Log::info("DraftController::update - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞ photos[{$index}]", [
        'original_name' => $file->getClientOriginalName(),
        'size' => $file->getSize()
    ]);
    $path = $file->store('photos/' . Auth::id(), 'public');
    $uploadedPhotos[] = '/storage/' . $path;
}
```

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û - –û–∂–∏–¥–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º