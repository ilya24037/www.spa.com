# üîß –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó: –ü–æ–ª—è specialty, work_format, service_provider

**–î–∞—Ç–∞:** 19.09.2025
**–°—Ç–∞—Ç—É—Å:** –¢–†–ï–ë–£–ï–¢ –ü–†–û–í–ï–†–ö–ò

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –ø–æ–ª—è:
- `specialty` - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Å—Ç–µ—Ä–∞
- `work_format` - —Ñ–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã (–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π/—Å–∞–ª–æ–Ω/–∏ —Ç.–¥.)
- `service_provider` - –∫—Ç–æ –æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å–ª—É–≥–∏

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω—ã

### –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–∏–∞–≥–Ω–æ–∑:
–ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏–ª –ø—Ä–∏—á–∏–Ω—É –∏ –∏–∑–º–µ–Ω–∏–ª –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∞–π–ª—ã:
- ‚ùå `AdCreationService` - –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- ‚ùå `AddItemController` - –ù–ï –∏–º–µ–µ—Ç —Ä–æ—É—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –¥–∞–Ω–Ω—ã—Ö:
```
Frontend (AdForm.vue)
    ‚Üì POST /draft
DraftController::store()
    ‚Üì $request->all()
DraftService::saveOrUpdate()
    ‚Üì prepareData()
Ad::create() –∏–ª–∏ Ad::update()
    ‚Üì
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–±–ª–∏—Ü–∞ ads)
```

### –ò—Å—Ç–∏–Ω–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:
–í—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –æ—Ç frontend –¥–æ DraftService, –Ω–æ —Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏ —É–±–µ–¥–∏—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ.

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. DraftService (`app/Domain/Ad/Services/DraftService.php`)

#### –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `saveOrUpdate()`:
```php
// –õ–æ–≥–∏—Ä—É–µ–º –≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–æ–ª–µ–π
Log::info('üîç DraftService::saveOrUpdate - –í—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ', [
    'has_specialty' => isset($data['specialty']),
    'specialty_value' => $data['specialty'] ?? null,
    'has_work_format' => isset($data['work_format']),
    'work_format_value' => $data['work_format'] ?? null,
    'has_service_provider' => isset($data['service_provider']),
    'service_provider_value' => $data['service_provider'] ?? null
]);
```

#### –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `prepareData()`:
```php
// –õ–æ–≥–∏—Ä—É–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è –≤ –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
Log::info('üìã DraftService::prepareData - –ù–ê–ß–ê–õ–û', [
    'specialty' => $data['specialty'] ?? '–ù–ï –ü–ï–†–ï–î–ê–ù–û',
    'work_format' => $data['work_format'] ?? '–ù–ï –ü–ï–†–ï–î–ê–ù–û',
    'service_provider' => $data['service_provider'] ?? '–ù–ï –ü–ï–†–ï–î–ê–ù–û'
]);
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
```php
// –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è
$ad->refresh();
Log::info('‚úÖ DraftService: –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ', [
    'ad_id' => $ad->id,
    'saved_specialty' => $ad->specialty,
    'saved_work_format' => $ad->work_format,
    'saved_service_provider' => $ad->service_provider
]);
```

### 2. DraftController (`app/Application/Http/Controllers/Ad/DraftController.php`)

–î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö:
```php
// –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –õ–æ–≥–∏—Ä—É–µ–º –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å—á–µ–∑–∞—é—Ç
\Log::info("üîç DraftController: –ü–†–û–í–ï–†–ö–ê –ü–†–û–ë–õ–ï–ú–ù–´–• –ü–û–õ–ï–ô", [
    'has_specialty' => $request->has('specialty'),
    'specialty_value' => $request->input('specialty'),
    'has_work_format' => $request->has('work_format'),
    'work_format_value' => $request->input('work_format'),
    'has_service_provider' => $request->has('service_provider'),
    'service_provider_value' => $request->input('service_provider')
]);
```

### 3. –û—Ç–∫–∞—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é:
- ‚úÖ `app/Domain/Service/Services/AdCreationService.php`
- ‚úÖ `app/Application/Http/Controllers/AddItemController.php`

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∏–ø—ã –ø–æ–ª–µ–π –≤ –ë–î:
- `specialty` - VARCHAR(255) - –æ–±—ã—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
- `work_format` - VARCHAR(255) - —Å—Ç—Ä–æ–∫–∞ (–¥–ª—è enum –∑–Ω–∞—á–µ–Ω–∏–π)
- `service_provider` - JSON - –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ DraftService:
- `specialty` - –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (string)
- `work_format` - –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (string)
- `service_provider` - –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –≤ JSON (–≤ —Å–ø–∏—Å–∫–µ jsonFields)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:
- `test_final_fix.php` - –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
- `check_draft_fields.php` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î –∏ –∫–æ–¥–∞

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:
1. –ù–∞–ª–∏—á–∏–µ –ø–æ–ª–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ ads ‚úÖ
2. –ù–∞–ª–∏—á–∏–µ –ø–æ–ª–µ–π –≤ fillable –º–∞—Å—Å–∏–≤–µ –º–æ–¥–µ–ª–∏ Ad ‚úÖ
3. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ DraftService ‚úÖ
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–µ —á—Ç–µ–Ω–∏–µ ‚úÖ

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- ‚úÖ –ü–æ–ª–µ `specialty` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞
- ‚úÖ –ü–æ–ª–µ `work_format` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞
- ‚úÖ –ü–æ–ª–µ `service_provider` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ JSON –º–∞—Å—Å–∏–≤
- ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø—É—Ç—å –¥–∞–Ω–Ω—ã—Ö

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
1. –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è
2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –ø–æ–ª—è –≤–∫–ª—é—á–∞—è:
   - –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (specialty)
   - –§–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã (work_format)
   - –ö—Ç–æ –æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å–ª—É–≥–∏ (service_provider)
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ —á–µ—Ä–Ω–æ–≤–∏–∫
4. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
5. –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è –Ω–∞ –º–µ—Å—Ç–µ

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
```bash
# Windows PowerShell
Get-Content storage\logs\laravel.log -Tail 100 | Select-String "DraftService"

# –ò–ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
http://spa.test/telescope/logs
```

## üìù –£—Ä–æ–∫–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

1. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã** - –Ω–µ –≤—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
2. **–°–ª–µ–¥–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫—É –¥–∞–Ω–Ω—ã—Ö** - –æ—Ç frontend –¥–æ –ë–î
3. **–î–æ–±–∞–≤–ª—è—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞–π—Ç–∏ –≥–¥–µ —Ç–µ—Ä—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ
4. **–ü—Ä–æ–≤–µ—Ä—è—Ç—å fillable** - –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å–ø–∏—Å–∫–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö
5. **–†–∞–∑–ª–∏—á–∞—Ç—å —Ç–∏–ø—ã –ø–æ–ª–µ–π** - JSON vs String –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É

## üöÄ –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è DraftService
2. –°–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è work_format (enum –∑–Ω–∞—á–µ–Ω–∏—è)
3. –î–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è enum constraint –Ω–∞ work_format
4. –°–æ–∑–¥–∞—Ç—å DTO –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–ª–æ—è–º–∏

---
*–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º SOLID –∏ KISS*
*–ê–≤—Ç–æ—Ä: Claude (AI Assistant)*