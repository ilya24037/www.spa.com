# üó∫Ô∏è –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –î–ï–¢–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–ê –ö–ê–†–¢

## üìã –û–ì–õ–ê–í–õ–ï–ù–ò–ï
1. [–ò—Å—Ö–æ–¥–Ω—ã–π –∞–Ω–∞–ª–∏–∑](#–∏—Å—Ö–æ–¥–Ω—ã–π-–∞–Ω–∞–ª–∏–∑)
2. [–¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#—Ü–µ–ª–µ–≤–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏](#–ø–æ—à–∞–≥–æ–≤—ã–π-–ø–ª–∞–Ω-–º–∏–≥—Ä–∞—Ü–∏–∏)
4. [–î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞](#–¥–µ—Ç–∞–ª—å–Ω–∞—è-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
5. [–ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](#–ø–ª–∞–Ω-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
6. [Rollback —Å—Ç—Ä–∞—Ç–µ–≥–∏—è](#rollback-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è)
7. [Timeline –∏ —Ä–µ—Å—É—Ä—Å—ã](#timeline)

---

## üîç –ò–°–•–û–î–ù–´–ô –ê–ù–ê–õ–ò–ó

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (30 —Ñ–∞–π–ª–æ–≤, ~2500 —Å—Ç—Ä–æ–∫)

```
/features/map/
‚îú‚îÄ‚îÄ composables/ (12 —Ñ–∞–π–ª–æ–≤, ~1200 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ useAddressGeocoding.ts      // 120 —Å—Ç—Ä–æ–∫ - –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ useGeolocation.ts           // 80 —Å—Ç—Ä–æ–∫ - –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ useMapClustering.ts         // 90 —Å—Ç—Ä–æ–∫ - –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ useMapController.ts         // 150 —Å—Ç—Ä–æ–∫ - –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ useMapEventHandlers.ts      // 100 —Å—Ç—Ä–æ–∫ - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ useMapInitializer.ts        // 140 —Å—Ç—Ä–æ–∫ - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ useMapMarkers.ts            // 110 —Å—Ç—Ä–æ–∫ - –º–∞—Ä–∫–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ useMapMethods.ts            // 130 —Å—Ç—Ä–æ–∫ - –º–µ—Ç–æ–¥—ã
‚îÇ   ‚îú‚îÄ‚îÄ useMapMobileOptimization.ts // 70 —Å—Ç—Ä–æ–∫ - –º–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ useMapModes.ts              // 60 —Å—Ç—Ä–æ–∫ - —Ä–µ–∂–∏–º—ã –∫–∞—Ä—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ useMapState.ts              // 90 —Å—Ç—Ä–æ–∫ - —Å–æ—Å—Ç–æ—è–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ useMapWithMasters.ts        // 60 —Å—Ç—Ä–æ–∫ - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–∞—Å—Ç–µ—Ä–∞–º–∏
‚îú‚îÄ‚îÄ ui/ (14 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, ~1100 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ YandexMapBase.vue           // 180 —Å—Ç—Ä–æ–∫ - –±–∞–∑–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ MapStates.vue               // 80 —Å—Ç—Ä–æ–∫ - —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ MapControls.vue             // 70 —Å—Ç—Ä–æ–∫ - –∫–æ–Ω—Ç—Ä–æ–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ MapMarkers.vue              // 90 —Å—Ç—Ä–æ–∫ - –º–∞—Ä–∫–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ MapMarkersManager.vue       // 100 —Å—Ç—Ä–æ–∫ - –º–µ–Ω–µ–¥–∂–µ—Ä –º–∞—Ä–∫–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ MapMarker.vue               // 60 —Å—Ç—Ä–æ–∫ - –æ–¥–∏–Ω –º–∞—Ä–∫–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ MapCenterMarker.vue         // 50 —Å—Ç—Ä–æ–∫ - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–∞—Ä–∫–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ MapAddressTooltip.vue       // 60 —Å—Ç—Ä–æ–∫ - —Ç—É–ª—Ç–∏–ø –∞–¥—Ä–µ—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ MapGeolocationButton.vue    // 40 —Å—Ç—Ä–æ–∫ - –∫–Ω–æ–ø–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ MapView.vue                 // 120 —Å—Ç—Ä–æ–∫ - –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ UniversalMap.vue            // 100 —Å—Ç—Ä–æ–∫ - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ MapSkeleton.vue             // 40 —Å—Ç—Ä–æ–∫ - —Å–∫–µ–ª–µ—Ç–æ–Ω
‚îÇ   ‚îú‚îÄ‚îÄ MapEmptyState.vue           // 30 —Å—Ç—Ä–æ–∫ - –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ MapErrorState.vue           // 30 —Å—Ç—Ä–æ–∫ - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏
‚îú‚îÄ‚îÄ lib/ (3 —Ñ–∞–π–ª–∞, ~200 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ yandexMapsLoader.ts         // 100 —Å—Ç—Ä–æ–∫ - –∑–∞–≥—Ä—É–∑—á–∏–∫ API
‚îÇ   ‚îú‚îÄ‚îÄ mapConstants.ts             // 50 —Å—Ç—Ä–æ–∫ - –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ deviceDetector.ts           // 50 —Å—Ç—Ä–æ–∫ - –¥–µ—Ç–µ–∫—Ç–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤
‚îî‚îÄ‚îÄ types/ (1 —Ñ–∞–π–ª, ~100 —Å—Ç—Ä–æ–∫)
    ‚îî‚îÄ‚îÄ index.ts                     // —Ç–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
```

### –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

#### 1. Over-engineering
- 12 composables —Å –ø–µ—Ä–µ–ø–ª–µ—Ç–µ–Ω–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- 14 UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π –∫–∞—Ä—Ç—ã
- –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π –¥–ª—è –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

#### 2. Circular Dependencies
```
useMapController ‚Üí useMapState ‚Üí useMapMethods ‚Üí useMapController
```

#### 3. Performance Issues
- –í—Å–µ composables –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è —Å—Ä–∞–∑—É (–Ω–µ—Ç lazy loading)
- Bundle size > 200KB —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–∞—Ä—Ç—ã
- –í—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ > 2 —Å–µ–∫—É–Ω–¥—ã

#### 4. Maintenance Hell
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –æ–¥–Ω–æ–º composable —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º—ã—Ö
- –°–ª–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ

#### 5. –¢–µ–∫—É—â–∏–µ –±–∞–≥–∏
- –ö–∞—Ä—Ç–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- –ú–∞—Ä–∫–µ—Ä—ã –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ

---

## üéØ –¶–ï–õ–ï–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –ü–∞—Ç—Ç–µ—Ä–Ω "–Ø–¥—Ä–æ + –ü–ª–∞–≥–∏–Ω—ã" (12 —Ñ–∞–π–ª–æ–≤, ~650 —Å—Ç—Ä–æ–∫)

```
/features/map/
‚îú‚îÄ‚îÄ core/ (3 —Ñ–∞–π–ª–∞, ~280 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ MapCore.vue          // 150 —Å—Ç—Ä–æ–∫ - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —è–¥—Ä–æ
‚îÇ   ‚îú‚îÄ‚îÄ MapLoader.ts         // 50 —Å—Ç—Ä–æ–∫ - singleton –∑–∞–≥—Ä—É–∑—á–∏–∫
‚îÇ   ‚îî‚îÄ‚îÄ MapStore.ts          // 80 —Å—Ç—Ä–æ–∫ - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞—Ä—Ç—ã
‚îú‚îÄ‚îÄ plugins/ (4 —Ñ–∞–π–ª–∞, ~220 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ ClusterPlugin.ts     // 60 —Å—Ç—Ä–æ–∫ - –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ GeolocationPlugin.ts // 40 —Å—Ç—Ä–æ–∫ - –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ SearchPlugin.ts      // 50 —Å—Ç—Ä–æ–∫ - –ø–æ–∏—Å–∫ –∏ –≥–µ–æ–∫–æ–¥–∏–Ω–≥
‚îÇ   ‚îî‚îÄ‚îÄ MarkersPlugin.ts     // 70 —Å—Ç—Ä–æ–∫ - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞–º–∏
‚îú‚îÄ‚îÄ components/ (3 —Ñ–∞–π–ª–∞, ~190 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ MapContainer.vue     // 100 —Å—Ç—Ä–æ–∫ - –≥–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ MapControls.vue      // 50 —Å—Ç—Ä–æ–∫ - UI –∫–æ–Ω—Ç—Ä–æ–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ MapStates.vue        // 40 —Å—Ç—Ä–æ–∫ - —Å–æ—Å—Ç–æ—è–Ω–∏—è (loading/error)
‚îî‚îÄ‚îÄ utils/ (2 —Ñ–∞–π–ª–∞, ~80 —Å—Ç—Ä–æ–∫)
    ‚îú‚îÄ‚îÄ mapConstants.ts       // 30 —Å—Ç—Ä–æ–∫ - –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
    ‚îî‚îÄ‚îÄ mapHelpers.ts         // 50 —Å—Ç—Ä–æ–∫ - —É—Ç–∏–ª–∏—Ç—ã
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –ø–ª–∞–≥–∏–Ω—ã –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - lazy loading –ø–ª–∞–≥–∏–Ω–æ–≤
3. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π –ø–ª–∞–≥–∏–Ω —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
4. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–ª–∞–≥–∏–Ω
5. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —è–¥—Ä–æ, –≤—Å—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤ –ø–ª–∞–≥–∏–Ω–∞—Ö

---

## üìù –ü–û–®–ê–ì–û–í–´–ô –ü–õ–ê–ù –ú–ò–ì–†–ê–¶–ò–ò

### –§–ê–ó–ê 0: –ü–û–î–ì–û–¢–û–í–ö–ê (–î–µ–Ω—å 0, 4 —á–∞—Å–∞)

#### –®–∞–≥ 0.1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è (30 –º–∏–Ω—É—Ç)

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –±—Ä–∞–Ω—á
git checkout -b feature/map-refactoring-core-plugins

# 2. –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –±—ç–∫–∞–ø–∞
mkdir resources/js/src/features/map_backup
cp -r resources/js/src/features/map/* resources/js/src/features/map_backup/

# 3. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
touch public/test-map-refactoring.html
```

#### –®–∞–≥ 0.2: –ù–∞–ø–∏—Å–∞–Ω–∏–µ E2E —Ç–µ—Å—Ç–æ–≤ —Ç–µ–∫—É—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ (2 —á–∞—Å–∞)

```javascript
// tests/e2e/map-before-refactoring.spec.js
import { test, expect } from '@playwright/test'

test.describe('–ö–∞—Ä—Ç–∞ –î–û —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞', () => {
  test('–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è', async ({ page }) => {
    await page.goto('/ad/create')
    await page.waitForSelector('.yandex-map', { timeout: 5000 })
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ Yandex Maps –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
    const hasYmaps = await page.evaluate(() => window.ymaps !== undefined)
    expect(hasYmaps).toBe(true)
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–∞—Ä—Ç–∞ –≤–∏–¥–∏–º–∞
    const mapVisible = await page.isVisible('.yandex-map')
    expect(mapVisible).toBe(true)
  })

  test('—Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∫–ª–∏–∫ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–∞—Ä–∫–µ—Ä', async ({ page }) => {
    await page.goto('/ad/create')
    await page.waitForSelector('.yandex-map')
    
    // –ö–ª–∏–∫–∞–µ–º –ø–æ –∫–∞—Ä—Ç–µ
    await page.click('.yandex-map', { position: { x: 200, y: 200 } })
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∑–∞–ø–∏—Å–∞–ª–∏—Å—å
    const geoValue = await page.inputValue('[name="geo"]')
    expect(geoValue).toMatch(/\d+\.\d+,\d+\.\d+/)
  })

  test('–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–¥—Ä–µ—Å –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∞—Ä–∫–µ—Ä–∞', async ({ page }) => {
    await page.goto('/ad/create')
    await page.waitForSelector('.yandex-map')
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Ä–∫–µ—Ä
    await page.click('.yandex-map', { position: { x: 200, y: 200 } })
    
    // –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞
    await page.waitForSelector('[data-test="address-display"]')
    const address = await page.textContent('[data-test="address-display"]')
    expect(address).not.toBe('')
  })

  test('–≥–µ–æ–ª–æ–∫–∞—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ', async ({ page, context }) => {
    // –î–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
    await context.grantPermissions(['geolocation'])
    await context.setGeolocation({ latitude: 59.9311, longitude: 30.3609 })
    
    await page.goto('/ad/create')
    await page.waitForSelector('.yandex-map')
    
    // –ù–∞–∂–∏–º–∞–µ–º –∫–Ω–æ–ø–∫—É –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
    await page.click('[data-test="geolocation-button"]')
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–∞—Ä—Ç–∞ –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∞—Å—å
    await page.waitForTimeout(1000)
    const geoValue = await page.inputValue('[name="geo"]')
    expect(geoValue).toContain('59.93')
  })

  test('—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É', async ({ page }) => {
    await page.goto('/ad/create')
    await page.waitForSelector('.yandex-map')
    
    // –í–≤–æ–¥–∏–º –∞–¥—Ä–µ—Å
    await page.fill('[data-test="address-search"]', '–ú–æ—Å–∫–≤–∞, –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å')
    await page.press('[data-test="address-search"]', 'Enter')
    
    // –ñ–¥–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç—ã
    await page.waitForTimeout(2000)
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–±–Ω–æ–≤–∏–ª–∏—Å—å
    const geoValue = await page.inputValue('[name="geo"]')
    expect(geoValue).toContain('55.75') // —à–∏—Ä–æ—Ç–∞ –ú–æ—Å–∫–≤—ã
  })
})

// tests/e2e/map-masters.spec.js
test.describe('–ö–∞—Ä—Ç–∞ –º–∞—Å—Ç–µ—Ä–æ–≤', () => {
  test('–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–∞—Ä–∫–µ—Ä—ã –º–∞—Å—Ç–µ—Ä–æ–≤', async ({ page }) => {
    await page.goto('/masters/map')
    await page.waitForSelector('.yandex-map')
    
    // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ä–∫–µ—Ä–æ–≤
    await page.waitForSelector('[data-test="master-marker"]')
    
    // –°—á–∏—Ç–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã
    const markers = await page.$$('[data-test="master-marker"]')
    expect(markers.length).toBeGreaterThan(0)
  })

  test('–∫–ª–∞—Å—Ç–µ—Ä–∏–∑—É–µ—Ç –º–∞—Ä–∫–µ—Ä—ã –ø—Ä–∏ –∑—É–º–µ', async ({ page }) => {
    await page.goto('/masters/map')
    await page.waitForSelector('.yandex-map')
    
    // –£–º–µ–Ω—å—à–∞–µ–º –∑—É–º
    for (let i = 0; i < 5; i++) {
      await page.keyboard.press('Minus')
      await page.waitForTimeout(300)
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
    const clusters = await page.$$('[data-test="marker-cluster"]')
    expect(clusters.length).toBeGreaterThan(0)
  })

  test('–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –º–∞—Å—Ç–µ—Ä–∞ –ø–æ –∫–ª–∏–∫—É', async ({ page }) => {
    await page.goto('/masters/map')
    await page.waitForSelector('.yandex-map')
    await page.waitForSelector('[data-test="master-marker"]')
    
    // –ö–ª–∏–∫–∞–µ–º –ø–æ –º–∞—Ä–∫–µ—Ä—É
    await page.click('[data-test="master-marker"]:first-child')
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—è–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
    await page.waitForSelector('[data-test="master-card-popup"]')
    const cardVisible = await page.isVisible('[data-test="master-card-popup"]')
    expect(cardVisible).toBe(true)
  })
})
```

#### –®–∞–≥ 0.3: –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ API (30 –º–∏–Ω—É—Ç)

```typescript
// docs/REFACTORING/map-api-before.md

# API –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ YandexMap –¥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

## Props
| Prop | Type | Default | Description |
|------|------|---------|-------------|
| modelValue | string | '' | –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã "lat,lng" |
| height | number | 400 | –í—ã—Å–æ—Ç–∞ –∫–∞—Ä—Ç—ã –≤ px |
| center | Coordinates | PERM_CENTER | –¶–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã |
| zoom | number | 14 | –£—Ä–æ–≤–µ–Ω—å –∑—É–º–∞ |
| apiKey | string | DEFAULT_API_KEY | API –∫–ª—é—á –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç |
| mode | 'single' \| 'multiple' | 'single' | –†–µ–∂–∏–º –º–∞—Ä–∫–µ—Ä–æ–≤ |
| markers | MapMarker[] | [] | –ú–∞—Å—Å–∏–≤ –º–∞—Ä–∫–µ—Ä–æ–≤ |
| showGeolocationButton | boolean | false | –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ |
| autoDetectLocation | boolean | false | –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è |
| clusterize | boolean | false | –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤ |
| draggable | boolean | true | –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞ |
| showSingleMarker | boolean | true | –ü–æ–∫–∞–∑–∞—Ç—å –æ–¥–∏–Ω–æ—á–Ω—ã–π –º–∞—Ä–∫–µ—Ä |
| showAddressTooltip | boolean | true | –ü–æ–∫–∞–∑–∞—Ç—å —Ç—É–ª—Ç–∏–ø —Å –∞–¥—Ä–µ—Å–æ–º |
| currentAddress | string | '' | –¢–µ–∫—É—â–∏–π –∞–¥—Ä–µ—Å |

## Events
| Event | Payload | Description |
|-------|---------|-------------|
| update:modelValue | string | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç |
| marker-moved | Coordinates | –ú–∞—Ä–∫–µ—Ä –ø–µ—Ä–µ–º–µ—â–µ–Ω |
| marker-click | MapMarker | –ö–ª–∏–∫ –ø–æ –º–∞—Ä–∫–µ—Ä—É |
| cluster-click | MapMarker[] | –ö–ª–∏–∫ –ø–æ –∫–ª–∞—Å—Ç–µ—Ä—É |
| address-found | {address, coords} | –ê–¥—Ä–µ—Å –Ω–∞–π–¥–µ–Ω |
| search-error | string | –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ |

## Exposed Methods
| Method | Arguments | Return | Description |
|--------|-----------|--------|-------------|
| searchAddress | (address: string) | Promise<void> | –ü–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É |
| setCoordinates | (coords: Coordinates) | void | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç |
| getCurrentAddress | () | string | –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∞–¥—Ä–µ—Å |
| clearMap | () | void | –û—á–∏—Å—Ç–∏—Ç—å –∫–∞—Ä—Ç—É |
```

#### –®–∞–≥ 0.4: Performance baseline (1 —á–∞—Å)

```javascript
// scripts/measure-map-performance.js
import { chromium } from 'playwright'

async function measurePerformance() {
  const browser = await chromium.launch()
  const page = await browser.newPage()
  
  // –í–∫–ª—é—á–∞–µ–º —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫
  await page.coverage.startJSCoverage()
  
  // –ó–∞–º–µ—Ä—è–µ–º –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
  const startTime = Date.now()
  await page.goto('/ad/create')
  await page.waitForSelector('.yandex-map')
  const loadTime = Date.now() - startTime
  
  // –°–æ–±–∏—Ä–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏
  const coverage = await page.coverage.stopJSCoverage()
  const metrics = await page.evaluate(() => {
    return {
      memory: performance.memory?.usedJSHeapSize || 0,
      domNodes: document.querySelectorAll('*').length,
      mapInitTime: window.__mapInitTime || 0,
    }
  })
  
  // Bundle size
  const bundleSize = coverage.reduce((acc, entry) => {
    if (entry.url.includes('/map/')) {
      return acc + entry.text.length
    }
    return acc
  }, 0)
  
  console.log('Performance Baseline:')
  console.log(`- Load time: ${loadTime}ms`)
  console.log(`- Map init: ${metrics.mapInitTime}ms`)
  console.log(`- Memory: ${(metrics.memory / 1024 / 1024).toFixed(2)}MB`)
  console.log(`- DOM nodes: ${metrics.domNodes}`)
  console.log(`- Bundle size: ${(bundleSize / 1024).toFixed(2)}KB`)
  
  await browser.close()
}

measurePerformance()
```

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã baseline:
- Load time: ~3000ms
- Map init: ~2000ms  
- Memory: ~25MB
- DOM nodes: ~500
- Bundle size: ~200KB

---

### –§–ê–ó–ê 1: –°–û–ó–î–ê–ù–ò–ï –Ø–î–†–ê (–î–µ–Ω—å 1, 6 —á–∞—Å–æ–≤)

#### –®–∞–≥ 1.1: MapLoader - Singleton –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ API (1 —á–∞—Å)

```typescript
// features/map/core/MapLoader.ts

/**
 * Singleton –∑–∞–≥—Ä—É–∑—á–∏–∫ Yandex Maps API
 * –ü–∞—Ç—Ç–µ—Ä–Ω: Singleton + Promise caching
 * –†–∞–∑–º–µ—Ä: 50 —Å—Ç—Ä–æ–∫
 */
export class MapLoader {
  private static instance: MapLoader | null = null
  private loadPromise: Promise<typeof ymaps> | null = null
  private isLoaded = false

  private constructor() {}

  static getInstance(): MapLoader {
    if (!MapLoader.instance) {
      MapLoader.instance = new MapLoader()
    }
    return MapLoader.instance
  }

  async load(apiKey: string): Promise<typeof ymaps> {
    // –ï—Å–ª–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ä–∞–∑—É
    if (this.isLoaded && window.ymaps) {
      return window.ymaps
    }

    // –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ–º–∏—Å
    if (this.loadPromise) {
      return this.loadPromise
    }

    // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    this.loadPromise = this.loadScript(apiKey)
    const ymaps = await this.loadPromise
    this.isLoaded = true
    return ymaps
  }

  private loadScript(apiKey: string): Promise<typeof ymaps> {
    return new Promise((resolve, reject) => {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
      if (window.ymaps?.ready) {
        window.ymaps.ready(() => resolve(window.ymaps))
        return
      }

      // –°–æ–∑–¥–∞–µ–º script tag
      const script = document.createElement('script')
      script.src = `https://api-maps.yandex.ru/2.1/?apikey=${apiKey}&lang=ru_RU`
      script.async = true

      script.onload = () => {
        window.ymaps.ready(() => {
          console.log('[MapLoader] Yandex Maps API loaded')
          resolve(window.ymaps)
        })
      }

      script.onerror = () => {
        this.loadPromise = null
        reject(new Error('Failed to load Yandex Maps API'))
      }

      document.head.appendChild(script)
    })
  }

  // –î–ª—è —Ç–µ—Å—Ç–æ–≤
  reset(): void {
    this.loadPromise = null
    this.isLoaded = false
  }
}

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≥–æ—Ç–æ–≤—ã–π –∏–Ω—Å—Ç–∞–Ω—Å
export const mapLoader = MapLoader.getInstance()
```

**–¢–µ—Å—Ç—ã –¥–ª—è MapLoader:**

```typescript
// features/map/core/__tests__/MapLoader.test.ts
import { MapLoader } from '../MapLoader'

describe('MapLoader', () => {
  let loader: MapLoader
  
  beforeEach(() => {
    loader = MapLoader.getInstance()
    loader.reset()
    delete window.ymaps
  })

  it('should be singleton', () => {
    const loader1 = MapLoader.getInstance()
    const loader2 = MapLoader.getInstance()
    expect(loader1).toBe(loader2)
  })

  it('should load Yandex Maps API', async () => {
    // Mock script loading
    const mockYmaps = { ready: jest.fn(cb => cb()) }
    window.ymaps = mockYmaps as any

    const result = await loader.load('test-key')
    expect(result).toBe(mockYmaps)
  })

  it('should cache load promise', async () => {
    const mockYmaps = { ready: jest.fn(cb => cb()) }
    window.ymaps = mockYmaps as any

    const promise1 = loader.load('test-key')
    const promise2 = loader.load('test-key')
    
    expect(promise1).toBe(promise2)
  })

  it('should handle load errors', async () => {
    // Mock script error
    jest.spyOn(document.head, 'appendChild').mockImplementation((script: any) => {
      setTimeout(() => script.onerror(), 0)
      return script
    })

    await expect(loader.load('test-key')).rejects.toThrow('Failed to load')
  })
})
```

#### –®–∞–≥ 1.2: MapStore - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (1 —á–∞—Å)

```typescript
// features/map/core/MapStore.ts

import { reactive, ref, computed } from 'vue'
import type { Coordinates, MapState, MapMarker } from '../types'

/**
 * –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–∞—Ä—Ç—ã
 * –ü–∞—Ç—Ç–µ—Ä–Ω: Reactive Store (Vue 3)
 * –†–∞–∑–º–µ—Ä: 80 —Å—Ç—Ä–æ–∫
 */
export class MapStore {
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞—Ä—Ç—ã
  private state = reactive<MapState>({
    isLoading: true,
    isReady: false,
    error: null,
    center: { lat: 58.0105, lng: 56.2502 }, // –ü–µ—Ä–º—å
    zoom: 14,
    bounds: null,
    address: '',
    coordinates: null
  })

  // –ú–∞—Ä–∫–µ—Ä—ã
  private markers = ref<Map<string, MapMarker>>(new Map())

  // –ò–Ω—Å—Ç–∞–Ω—Å –∫–∞—Ä—Ç—ã
  private mapInstance = ref<any>(null)

  // Getters
  get isLoading() {
    return this.state.isLoading
  }

  get isReady() {
    return this.state.isReady
  }

  get error() {
    return this.state.error
  }

  get center() {
    return this.state.center
  }

  get zoom() {
    return this.state.zoom
  }

  get address() {
    return this.state.address
  }

  get coordinates() {
    return this.state.coordinates
  }

  get markersArray() {
    return Array.from(this.markers.value.values())
  }

  // Actions
  setLoading(loading: boolean) {
    this.state.isLoading = loading
  }

  setReady(ready: boolean) {
    this.state.isReady = ready
    if (ready) {
      this.state.isLoading = false
      this.state.error = null
    }
  }

  setError(error: string | null) {
    this.state.error = error
    this.state.isLoading = false
  }

  setCenter(center: Coordinates) {
    this.state.center = center
  }

  setZoom(zoom: number) {
    this.state.zoom = zoom
  }

  setAddress(address: string) {
    this.state.address = address
  }

  setCoordinates(coords: Coordinates | null) {
    this.state.coordinates = coords
  }

  setMapInstance(instance: any) {
    this.mapInstance.value = instance
  }

  getMapInstance() {
    return this.mapInstance.value
  }

  // –ú–∞—Ä–∫–µ—Ä—ã
  addMarker(marker: MapMarker) {
    this.markers.value.set(marker.id, marker)
  }

  removeMarker(id: string) {
    this.markers.value.delete(id)
  }

  clearMarkers() {
    this.markers.value.clear()
  }

  reset() {
    this.state.isLoading = true
    this.state.isReady = false
    this.state.error = null
    this.state.address = ''
    this.state.coordinates = null
    this.clearMarkers()
  }
}

// –°–æ–∑–¥–∞–µ–º store –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–∞ –∫–∞—Ä—Ç—ã
export function createMapStore() {
  return new MapStore()
}
```

#### –®–∞–≥ 1.3: MapCore - –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —è–¥—Ä–æ —Å –ø–ª–∞–≥–∏–Ω–∞–º–∏ (2 —á–∞—Å–∞)

```vue
<!-- features/map/core/MapCore.vue -->
<template>
  <div class="map-core" :class="{ 'map-core--mobile': isMobile }">
    <div 
      ref="containerRef"
      :id="mapId"
      class="map-core__container"
      :style="{ height: `${height}px` }"
    />
    
    <!-- –°–ª–æ—Ç –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ -->
    <div v-if="$slots.controls" class="map-core__controls">
      <slot name="controls" :map="store" />
    </div>

    <!-- –°–ª–æ—Ç –¥–ª—è –æ–≤–µ—Ä–ª–µ–µ–≤ -->
    <div v-if="$slots.overlays" class="map-core__overlays">
      <slot name="overlays" :map="store" />
    </div>
  </div>
</template>

<script setup lang="ts">
/**
 * MapCore - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —è–¥—Ä–æ –∫–∞—Ä—Ç—ã —Å —Å–∏—Å—Ç–µ–º–æ–π –ø–ª–∞–≥–∏–Ω–æ–≤
 * –ü—Ä–∏–Ω—Ü–∏–ø—ã:
 * 1. –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≤ —è–¥—Ä–µ
 * 2. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–ª–∞–≥–∏–Ω—ã
 * 3. –†–µ–∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ store
 * –†–∞–∑–º–µ—Ä: 150 —Å—Ç—Ä–æ–∫
 */
import { ref, onMounted, onUnmounted, watch, provide } from 'vue'
import { mapLoader } from './MapLoader'
import { createMapStore } from './MapStore'
import type { MapPlugin, Coordinates, MapConfig } from '../types'
import { DEFAULT_API_KEY, PERM_CENTER, DEFAULT_ZOOM } from '../utils/mapConstants'
import { isMobileDevice } from '../utils/mapHelpers'

interface Props {
  height?: number
  center?: Coordinates
  zoom?: number
  apiKey?: string
  config?: Partial<MapConfig>
}

const props = withDefaults(defineProps<Props>(), {
  height: 400,
  center: () => PERM_CENTER,
  zoom: DEFAULT_ZOOM,
  apiKey: DEFAULT_API_KEY
})

const emit = defineEmits<{
  ready: [map: any]
  error: [error: Error]
  'center-change': [center: Coordinates]
  'zoom-change': [zoom: number]
  click: [coords: Coordinates]
}>()

// Refs
const containerRef = ref<HTMLElement>()
const mapId = `map-${Math.random().toString(36).substr(2, 9)}`
const isMobile = isMobileDevice()

// Store
const store = createMapStore()
provide('mapStore', store)

// Plugins
const plugins = new Map<string, MapPlugin>()

// Public API
async function use(plugin: MapPlugin) {
  console.log(`[MapCore] Installing plugin: ${plugin.name}`)
  plugins.set(plugin.name, plugin)
  
  // –ï—Å–ª–∏ –∫–∞—Ä—Ç–∞ —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–ª–∞–≥–∏–Ω —Å—Ä–∞–∑—É
  const mapInstance = store.getMapInstance()
  if (mapInstance && plugin.install) {
    await plugin.install(mapInstance, store)
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
async function initMap() {
  try {
    store.setLoading(true)
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º API
    const ymaps = await mapLoader.load(props.apiKey)
    
    // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É
    const mapConfig = {
      center: [props.center.lat, props.center.lng],
      zoom: props.zoom,
      controls: [],
      ...props.config
    }
    
    const map = new ymaps.Map(mapId, mapConfig)
    store.setMapInstance(map)
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∞–∑–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    setupBaseHandlers(map)
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–ª–∞–≥–∏–Ω—ã
    for (const plugin of plugins.values()) {
      if (plugin.install) {
        console.log(`[MapCore] Installing plugin: ${plugin.name}`)
        await plugin.install(map, store)
      }
    }
    
    // –ú–æ–±–∏–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
    if (isMobile) {
      map.behaviors.disable('drag')
      map.behaviors.enable('multiTouch')
    }
    
    store.setReady(true)
    emit('ready', map)
    
  } catch (error) {
    console.error('[MapCore] Init error:', error)
    store.setError(error.message)
    emit('error', error)
  }
}

// –ë–∞–∑–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
function setupBaseHandlers(map: any) {
  // –ö–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–µ
  map.events.add('click', (e: any) => {
    const coords = e.get('coords')
    const coordinates = {
      lat: coords[0],
      lng: coords[1]
    }
    store.setCoordinates(coordinates)
    emit('click', coordinates)
  })
  
  // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞
  map.events.add('actionend', () => {
    const center = map.getCenter()
    const newCenter = {
      lat: center[0],
      lng: center[1]
    }
    store.setCenter(newCenter)
    emit('center-change', newCenter)
    
    const zoom = map.getZoom()
    store.setZoom(zoom)
    emit('zoom-change', zoom)
  })
}

// –ú–µ—Ç–æ–¥—ã –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
function setCenter(center: Coordinates, zoom?: number) {
  const map = store.getMapInstance()
  if (map) {
    map.setCenter([center.lat, center.lng], zoom || store.zoom)
  }
}

function getCenter(): Coordinates {
  return store.center
}

function destroy() {
  const map = store.getMapInstance()
  if (map) {
    // –í—ã–∑—ã–≤–∞–µ–º destroy –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞–≥–∏–Ω–æ–≤
    for (const plugin of plugins.values()) {
      if (plugin.destroy) {
        plugin.destroy()
      }
    }
    
    map.destroy()
    store.reset()
  }
}

// Lifecycle
onMounted(() => {
  initMap()
})

onUnmounted(() => {
  destroy()
})

// –°–ª–µ–¥–∏–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–ø—Å–æ–≤
watch(() => props.center, (newCenter) => {
  if (newCenter) {
    setCenter(newCenter)
  }
})

watch(() => props.zoom, (newZoom) => {
  const map = store.getMapInstance()
  if (map) {
    map.setZoom(newZoom)
  }
})

// Expose public API
defineExpose({
  use,
  setCenter,
  getCenter,
  destroy,
  store
})
</script>

<style lang="scss">
.map-core {
  position: relative;
  width: 100%;
  
  &__container {
    width: 100%;
    background: #f5f5f5;
    position: relative;
  }
  
  &__controls {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 1000;
  }
  
  &__overlays {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: 999;
    
    > * {
      pointer-events: auto;
    }
  }
  
  &--mobile {
    .map-core__controls {
      top: auto;
      bottom: 10px;
    }
  }
}
</style>
```

#### –®–∞–≥ 1.4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —è–¥—Ä–∞ (2 —á–∞—Å–∞)

```typescript
// features/map/core/__tests__/MapCore.test.ts
import { mount } from '@vue/test-utils'
import { describe, it, expect, vi, beforeEach } from 'vitest'
import MapCore from '../MapCore.vue'
import { mapLoader } from '../MapLoader'

// Mock Yandex Maps
const mockYmaps = {
  Map: vi.fn().mockImplementation(() => ({
    events: {
      add: vi.fn()
    },
    behaviors: {
      disable: vi.fn(),
      enable: vi.fn()
    },
    setCenter: vi.fn(),
    setZoom: vi.fn(),
    getCenter: vi.fn(() => [58.0105, 56.2502]),
    getZoom: vi.fn(() => 14),
    destroy: vi.fn()
  }))
}

vi.mock('../MapLoader', () => ({
  mapLoader: {
    load: vi.fn().mockResolvedValue(mockYmaps)
  }
}))

describe('MapCore', () => {
  beforeEach(() => {
    vi.clearAllMocks()
    window.ymaps = mockYmaps
  })

  it('should mount and initialize map', async () => {
    const wrapper = mount(MapCore, {
      props: {
        height: 500,
        apiKey: 'test-key'
      }
    })

    // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    await wrapper.vm.$nextTick()
    await new Promise(resolve => setTimeout(resolve, 100))

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞
    expect(mockYmaps.Map).toHaveBeenCalled()
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ store –æ–±–Ω–æ–≤–∏–ª—Å—è
    const store = wrapper.vm.store
    expect(store.isReady).toBe(true)
    expect(store.isLoading).toBe(false)
  })

  it('should emit ready event after init', async () => {
    const wrapper = mount(MapCore)

    await wrapper.vm.$nextTick()
    await new Promise(resolve => setTimeout(resolve, 100))

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–±—ã—Ç–∏–µ
    expect(wrapper.emitted('ready')).toBeTruthy()
    expect(wrapper.emitted('ready')[0][0]).toBeDefined()
  })

  it('should handle click events', async () => {
    const wrapper = mount(MapCore)

    await wrapper.vm.$nextTick()
    await new Promise(resolve => setTimeout(resolve, 100))

    // –ü–æ–ª—É—á–∞–µ–º mock –∫–∞—Ä—Ç—ã
    const mapInstance = wrapper.vm.store.getMapInstance()
    const clickHandler = mapInstance.events.add.mock.calls.find(
      call => call[0] === 'click'
    )[1]

    // –°–∏–º—É–ª–∏—Ä—É–µ–º –∫–ª–∏–∫
    const mockEvent = {
      get: vi.fn(() => [55.7558, 37.6173])
    }
    clickHandler(mockEvent)

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–±—ã—Ç–∏–µ
    expect(wrapper.emitted('click')).toBeTruthy()
    expect(wrapper.emitted('click')[0][0]).toEqual({
      lat: 55.7558,
      lng: 37.6173
    })
  })

  it('should install plugins', async () => {
    const mockPlugin = {
      name: 'test-plugin',
      install: vi.fn()
    }

    const wrapper = mount(MapCore)
    
    // –î–æ–±–∞–≤–ª—è–µ–º –ø–ª–∞–≥–∏–Ω
    await wrapper.vm.use(mockPlugin)
    
    // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    await wrapper.vm.$nextTick()
    await new Promise(resolve => setTimeout(resolve, 100))

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–ª–∞–≥–∏–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
    expect(mockPlugin.install).toHaveBeenCalledWith(
      expect.any(Object),
      expect.any(Object)
    )
  })

  it('should handle errors', async () => {
    // –ó–∞—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–≥—Ä—É–∑—á–∏–∫ –≤—ã–±—Ä–æ—Å–∏—Ç—å –æ—à–∏–±–∫—É
    mapLoader.load.mockRejectedValueOnce(new Error('Load failed'))

    const wrapper = mount(MapCore)

    await wrapper.vm.$nextTick()
    await new Promise(resolve => setTimeout(resolve, 100))

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏
    expect(wrapper.vm.store.error).toBe('Load failed')
    expect(wrapper.emitted('error')).toBeTruthy()
  })

  it('should destroy map on unmount', async () => {
    const wrapper = mount(MapCore)

    await wrapper.vm.$nextTick()
    await new Promise(resolve => setTimeout(resolve, 100))

    const mapInstance = wrapper.vm.store.getMapInstance()
    
    // –†–∞–∑–º–æ–Ω—Ç–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
    wrapper.unmount()

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ destroy –≤—ã–∑–≤–∞–Ω
    expect(mapInstance.destroy).toHaveBeenCalled()
  })
})
```

---

### –§–ê–ó–ê 2: –°–û–ó–î–ê–ù–ò–ï –ü–õ–ê–ì–ò–ù–û–í (–î–µ–Ω—å 2, 6 —á–∞—Å–æ–≤)

#### –®–∞–≥ 2.1: ClusterPlugin - –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤ (1.5 —á–∞—Å–∞)

```typescript
// features/map/plugins/ClusterPlugin.ts

import type { MapPlugin, MapMarker, MapStore } from '../types'

/**
 * –ü–ª–∞–≥–∏–Ω –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –º–∞—Ä–∫–µ—Ä–æ–≤
 * –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –±–ª–∏–∑–∫–∏–µ –º–∞—Ä–∫–µ—Ä—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä—ã –ø—Ä–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–∏ –º–∞—Å—à—Ç–∞–±–∞
 * –†–∞–∑–º–µ—Ä: 60 —Å—Ç—Ä–æ–∫
 */
export class ClusterPlugin implements MapPlugin {
  name = 'cluster'
  private clusterer: any = null
  private map: any = null
  private store: MapStore | null = null

  constructor(private options: any = {}) {
    this.options = {
      preset: 'islands#invertedVioletClusterIcons',
      clusterDisableClickZoom: true,
      clusterOpenBalloonOnClick: false,
      gridSize: 64,
      ...options
    }
  }

  async install(map: any, store: MapStore) {
    this.map = map
    this.store = store

    // –°–æ–∑–¥–∞–µ–º –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ç–æ—Ä
    this.clusterer = new ymaps.Clusterer(this.options)

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–ª–∞—Å—Ç–µ—Ä—É
    this.clusterer.events.add('click', (e: any) => {
      const cluster = e.get('target')
      const markers = cluster.getGeoObjects()
      
      // –≠–º–∏—Ç–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ store
      if (this.store) {
        this.store.emit('cluster-click', markers)
      }
    })

    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞ –∫–∞—Ä—Ç—É
    map.geoObjects.add(this.clusterer)

    // –°–ª–µ–¥–∏–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –º–∞—Ä–∫–µ—Ä–æ–≤
    if (store) {
      store.on('markers-change', this.updateMarkers.bind(this))
    }
  }

  updateMarkers(markers: MapMarker[]) {
    if (!this.clusterer) return

    // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –º–∞—Ä–∫–µ—Ä—ã
    this.clusterer.removeAll()

    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ
    const placemarks = markers.map(marker => {
      const placemark = new ymaps.Placemark(
        [marker.coordinates.lat, marker.coordinates.lng],
        {
          balloonContentHeader: marker.title,
          balloonContentBody: marker.description,
          markerId: marker.id
        },
        {
          preset: marker.preset || 'islands#blueIcon',
          iconColor: marker.color || '#0095b6'
        }
      )

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –º–∞—Ä–∫–µ—Ä—É
      placemark.events.add('click', () => {
        if (this.store) {
          this.store.emit('marker-click', marker)
        }
      })

      return placemark
    })

    this.clusterer.add(placemarks)
  }

  destroy() {
    if (this.clusterer && this.map) {
      this.map.geoObjects.remove(this.clusterer)
      this.clusterer = null
    }
  }
}
```

#### –®–∞–≥ 2.2: GeolocationPlugin - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è (1 —á–∞—Å)

```typescript
// features/map/plugins/GeolocationPlugin.ts

import type { MapPlugin, MapStore, Coordinates } from '../types'

/**
 * –ü–ª–∞–≥–∏–Ω –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
 * –î–æ–±–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏ –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
 * –†–∞–∑–º–µ—Ä: 40 —Å—Ç—Ä–æ–∫
 */
export class GeolocationPlugin implements MapPlugin {
  name = 'geolocation'
  private control: any = null
  private map: any = null

  constructor(private options: any = {}) {
    this.options = {
      autoDetect: false,
      showButton: true,
      ...options
    }
  }

  async install(map: any, store: MapStore) {
    this.map = map

    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
    if (this.options.showButton) {
      this.control = new ymaps.control.GeolocationControl({
        options: {
          float: 'right',
          position: {
            bottom: 20,
            right: 20
          }
        }
      })

      map.controls.add(this.control)

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ–π –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
      this.control.events.add('locationchange', (e: any) => {
        const position = e.get('position')
        const coords: Coordinates = {
          lat: position[0],
          lng: position[1]
        }
        
        store.setCenter(coords)
        store.emit('geolocation-success', coords)
      })
    }

    // –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    if (this.options.autoDetect) {
      this.detectLocation(store)
    }
  }

  private async detectLocation(store: MapStore) {
    if (!navigator.geolocation) {
      console.warn('[GeolocationPlugin] Geolocation not supported')
      return
    }

    navigator.geolocation.getCurrentPosition(
      (position) => {
        const coords: Coordinates = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        }
        
        this.map.setCenter([coords.lat, coords.lng], 15)
        store.setCenter(coords)
        store.emit('geolocation-auto-detected', coords)
      },
      (error) => {
        console.warn('[GeolocationPlugin] Auto-detect failed:', error)
      }
    )
  }

  destroy() {
    if (this.control && this.map) {
      this.map.controls.remove(this.control)
      this.control = null
    }
  }
}
```

#### –®–∞–≥ 2.3: SearchPlugin - –ü–æ–∏—Å–∫ –∏ –≥–µ–æ–∫–æ–¥–∏–Ω–≥ (1.5 —á–∞—Å–∞)

```typescript
// features/map/plugins/SearchPlugin.ts

import type { MapPlugin, MapStore, Coordinates } from '../types'

/**
 * –ü–ª–∞–≥–∏–Ω –ø–æ–∏—Å–∫–∞ –ø–æ –∞–¥—Ä–µ—Å—É –∏ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≥–µ–æ–∫–æ–¥–∏–Ω–≥–∞
 * –†–∞–∑–º–µ—Ä: 50 —Å—Ç—Ä–æ–∫
 */
export class SearchPlugin implements MapPlugin {
  name = 'search'
  private geocoder: any = null
  private searchControl: any = null
  private map: any = null

  constructor(private options: any = {}) {
    this.options = {
      showSearchControl: false,
      reverseGeocode: true,
      ...options
    }
  }

  async install(map: any, store: MapStore) {
    this.map = map

    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç—Ä–æ–ª –ø–æ–∏—Å–∫–∞
    if (this.options.showSearchControl) {
      this.searchControl = new ymaps.control.SearchControl({
        options: {
          float: 'left',
          floatIndex: 100,
          noPlacemark: true
        }
      })

      map.controls.add(this.searchControl)

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–∏—Å–∫–∞
      this.searchControl.events.add('resultselect', (e: any) => {
        const index = e.get('index')
        this.searchControl.getResult(index).then((res: any) => {
          const coords = res.geometry.getCoordinates()
          const address = res.properties.get('text')
          
          store.setCoordinates({
            lat: coords[0],
            lng: coords[1]
          })
          store.setAddress(address)
          store.emit('search-result', { address, coords })
        })
      })
    }

    // –û–±—Ä–∞—Ç–Ω–æ–µ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ
    if (this.options.reverseGeocode) {
      map.events.add('click', (e: any) => {
        const coords = e.get('coords')
        this.reverseGeocode(coords, store)
      })
    }
  }

  // –ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–∞ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
  async reverseGeocode(coords: number[], store: MapStore) {
    try {
      const geocodeResult = await ymaps.geocode(coords)
      const firstGeoObject = geocodeResult.geoObjects.get(0)
      
      if (firstGeoObject) {
        const address = firstGeoObject.getAddressLine()
        store.setAddress(address)
        store.emit('address-found', {
          address,
          coords: {
            lat: coords[0],
            lng: coords[1]
          }
        })
      }
    } catch (error) {
      console.error('[SearchPlugin] Reverse geocode failed:', error)
    }
  }

  // –ü–æ–∏—Å–∫ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–æ –∞–¥—Ä–µ—Å—É
  async searchAddress(address: string): Promise<Coordinates | null> {
    try {
      const geocodeResult = await ymaps.geocode(address)
      const firstGeoObject = geocodeResult.geoObjects.get(0)
      
      if (firstGeoObject) {
        const coords = firstGeoObject.geometry.getCoordinates()
        return {
          lat: coords[0],
          lng: coords[1]
        }
      }
    } catch (error) {
      console.error('[SearchPlugin] Address search failed:', error)
    }
    
    return null
  }

  destroy() {
    if (this.searchControl && this.map) {
      this.map.controls.remove(this.searchControl)
      this.searchControl = null
    }
  }
}
```

#### –®–∞–≥ 2.4: MarkersPlugin - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞–º–∏ (2 —á–∞—Å–∞)

```typescript
// features/map/plugins/MarkersPlugin.ts

import type { MapPlugin, MapStore, MapMarker, Coordinates } from '../types'

/**
 * –ü–ª–∞–≥–∏–Ω —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–∞–º–∏
 * –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞–º–∏
 * –†–∞–∑–º–µ—Ä: 70 —Å—Ç—Ä–æ–∫
 */
export class MarkersPlugin implements MapPlugin {
  name = 'markers'
  private map: any = null
  private store: MapStore | null = null
  private markers: Map<string, any> = new Map()
  private singleMarker: any = null

  constructor(private options: any = {}) {
    this.options = {
      mode: 'single', // 'single' | 'multiple'
      draggable: true,
      preset: 'islands#blueIcon',
      ...options
    }
  }

  async install(map: any, store: MapStore) {
    this.map = map
    this.store = store

    // –í —Ä–µ–∂–∏–º–µ single –¥–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –ø—Ä–∏ –∫–ª–∏–∫–µ
    if (this.options.mode === 'single') {
      map.events.add('click', (e: any) => {
        const coords = e.get('coords')
        this.setSingleMarker({
          lat: coords[0],
          lng: coords[1]
        })
      })
    }

    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ store
    store.on('markers-add', this.addMarker.bind(this))
    store.on('markers-remove', this.removeMarker.bind(this))
    store.on('markers-clear', this.clearMarkers.bind(this))
  }

  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞
  setSingleMarker(coords: Coordinates) {
    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –º–∞—Ä–∫–µ—Ä
    if (this.singleMarker) {
      this.map.geoObjects.remove(this.singleMarker)
    }

    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π
    this.singleMarker = new ymaps.Placemark(
      [coords.lat, coords.lng],
      {
        balloonContentHeader: '–í—ã–±—Ä–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ',
        balloonContentBody: this.store?.address || '–ó–∞–≥—Ä—É–∑–∫–∞ –∞–¥—Ä–µ—Å–∞...'
      },
      {
        preset: this.options.preset,
        draggable: this.options.draggable
      }
    )

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
    if (this.options.draggable) {
      this.singleMarker.events.add('dragend', () => {
        const newCoords = this.singleMarker.geometry.getCoordinates()
        const coordinates = {
          lat: newCoords[0],
          lng: newCoords[1]
        }
        
        this.store?.setCoordinates(coordinates)
        this.store?.emit('marker-moved', coordinates)
      })
    }

    this.map.geoObjects.add(this.singleMarker)
    
    // –û–±–Ω–æ–≤–ª—è–µ–º store
    this.store?.setCoordinates(coords)
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞ –≤ —Ä–µ–∂–∏–º–µ multiple
  addMarker(marker: MapMarker) {
    if (this.options.mode !== 'multiple') return

    const placemark = new ymaps.Placemark(
      [marker.coordinates.lat, marker.coordinates.lng],
      {
        balloonContentHeader: marker.title,
        balloonContentBody: marker.description,
        hintContent: marker.title
      },
      {
        preset: marker.preset || this.options.preset,
        iconColor: marker.color
      }
    )

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
    placemark.events.add('click', () => {
      this.store?.emit('marker-click', marker)
    })

    this.markers.set(marker.id, placemark)
    this.map.geoObjects.add(placemark)
  }

  // –£–¥–∞–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞
  removeMarker(id: string) {
    const placemark = this.markers.get(id)
    if (placemark) {
      this.map.geoObjects.remove(placemark)
      this.markers.delete(id)
    }
  }

  // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –º–∞—Ä–∫–µ—Ä–æ–≤
  clearMarkers() {
    if (this.singleMarker) {
      this.map.geoObjects.remove(this.singleMarker)
      this.singleMarker = null
    }

    for (const placemark of this.markers.values()) {
      this.map.geoObjects.remove(placemark)
    }
    this.markers.clear()
  }

  destroy() {
    this.clearMarkers()
  }
}
```

---

### –§–ê–ó–ê 3: –°–û–ó–î–ê–ù–ò–ï UI –ö–û–ú–ü–û–ù–ï–ù–¢–û–í (–î–µ–Ω—å 3, 4 —á–∞—Å–∞)

#### –®–∞–≥ 3.1: MapContainer - –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (1.5 —á–∞—Å–∞)

```vue
<!-- features/map/components/MapContainer.vue -->
<template>
  <div class="map-container" :class="containerClasses">
    <MapStates 
      :loading="loading"
      :error="error"
      @retry="handleRetry"
    >
      <MapCore
        ref="mapCoreRef"
        v-bind="coreProps"
        @ready="handleMapReady"
        @error="handleMapError"
        @click="handleMapClick"
        @center-change="$emit('center-change', $event)"
        @zoom-change="$emit('zoom-change', $event)"
      >
        <template #controls>
          <MapControls 
            v-if="showControls"
            :show-geolocation="showGeolocationButton"
            :show-search="showSearchControl"
            @geolocation-click="handleGeolocationClick"
            @search="handleSearch"
          />
        </template>
        
        <template #overlays>
          <slot name="overlays" />
        </template>
      </MapCore>
    </MapStates>
  </div>
</template>

<script setup lang="ts">
/**
 * MapContainer - –≥–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç—ã
 * –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —è–¥—Ä–æ, –ø–ª–∞–≥–∏–Ω—ã –∏ UI
 * –†–∞–∑–º–µ—Ä: 100 —Å—Ç—Ä–æ–∫
 */
import { ref, computed, onMounted, watch } from 'vue'
import MapCore from '../core/MapCore.vue'
import MapStates from './MapStates.vue'
import MapControls from './MapControls.vue'

// –ü–ª–∞–≥–∏–Ω—ã
import { ClusterPlugin } from '../plugins/ClusterPlugin'
import { GeolocationPlugin } from '../plugins/GeolocationPlugin'
import { SearchPlugin } from '../plugins/SearchPlugin'
import { MarkersPlugin } from '../plugins/MarkersPlugin'

import type { MapMarker, Coordinates } from '../types'

interface Props {
  // –û—Å–Ω–æ–≤–Ω—ã–µ
  modelValue?: string
  height?: number
  center?: Coordinates
  zoom?: number
  
  // –†–µ–∂–∏–º—ã
  mode?: 'single' | 'multiple'
  markers?: MapMarker[]
  
  // UI
  showControls?: boolean
  showGeolocationButton?: boolean
  showSearchControl?: boolean
  
  // –û–ø—Ü–∏–∏
  clusterize?: boolean
  draggable?: boolean
  autoDetectLocation?: boolean
  reverseGeocode?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  height: 400,
  zoom: 14,
  mode: 'single',
  markers: () => [],
  showControls: true,
  showGeolocationButton: false,
  showSearchControl: false,
  clusterize: false,
  draggable: true,
  autoDetectLocation: false,
  reverseGeocode: true
})

const emit = defineEmits<{
  'update:modelValue': [value: string]
  'ready': [map: any]
  'marker-click': [marker: MapMarker]
  'cluster-click': [markers: MapMarker[]]
  'address-found': [data: { address: string, coords: Coordinates }]
  'center-change': [center: Coordinates]
  'zoom-change': [zoom: number]
}>()

// Refs
const mapCoreRef = ref<InstanceType<typeof MapCore>>()
const loading = ref(true)
const error = ref<string | null>(null)

// Computed
const containerClasses = computed(() => ({
  'map-container--loading': loading.value,
  'map-container--error': !!error.value
}))

const coreProps = computed(() => ({
  height: props.height,
  center: props.center || parseCoordinates(props.modelValue),
  zoom: props.zoom
}))

// Methods
function parseCoordinates(value?: string): Coordinates | undefined {
  if (!value) return undefined
  const [lat, lng] = value.split(',').map(Number)
  return { lat, lng }
}

function formatCoordinates(coords: Coordinates): string {
  return `${coords.lat},${coords.lng}`
}

// Handlers
async function handleMapReady(map: any) {
  loading.value = false
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–ª–∞–≥–∏–Ω—ã
  const core = mapCoreRef.value
  if (!core) return

  // Markers –ø–ª–∞–≥–∏–Ω
  await core.use(new MarkersPlugin({
    mode: props.mode,
    draggable: props.draggable
  }))

  // Cluster –ø–ª–∞–≥–∏–Ω
  if (props.clusterize && props.mode === 'multiple') {
    await core.use(new ClusterPlugin())
  }

  // Geolocation –ø–ª–∞–≥–∏–Ω
  if (props.showGeolocationButton || props.autoDetectLocation) {
    await core.use(new GeolocationPlugin({
      showButton: props.showGeolocationButton,
      autoDetect: props.autoDetectLocation
    }))
  }

  // Search –ø–ª–∞–≥–∏–Ω
  if (props.showSearchControl || props.reverseGeocode) {
    await core.use(new SearchPlugin({
      showSearchControl: props.showSearchControl,
      reverseGeocode: props.reverseGeocode
    }))
  }

  // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è store
  const store = core.store
  store.on('coordinates-change', (coords: Coordinates) => {
    emit('update:modelValue', formatCoordinates(coords))
  })
  
  store.on('marker-click', (marker: MapMarker) => {
    emit('marker-click', marker)
  })
  
  store.on('cluster-click', (markers: MapMarker[]) => {
    emit('cluster-click', markers)
  })
  
  store.on('address-found', (data: any) => {
    emit('address-found', data)
  })

  emit('ready', map)
}

function handleMapError(err: Error) {
  error.value = err.message
  loading.value = false
}

function handleMapClick(coords: Coordinates) {
  if (props.mode === 'single') {
    emit('update:modelValue', formatCoordinates(coords))
  }
}

function handleRetry() {
  error.value = null
  loading.value = true
  mapCoreRef.value?.initMap()
}

function handleGeolocationClick() {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
  console.log('Geolocation clicked')
}

function handleSearch(query: string) {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∏—Å–∫–∞
  console.log('Search:', query)
}

// Watchers
watch(() => props.markers, (newMarkers) => {
  if (mapCoreRef.value && props.mode === 'multiple') {
    const store = mapCoreRef.value.store
    store.emit('markers-change', newMarkers)
  }
}, { deep: true })

// Public API
defineExpose({
  setCenter: (coords: Coordinates, zoom?: number) => {
    mapCoreRef.value?.setCenter(coords, zoom)
  },
  searchAddress: async (address: string) => {
    // TODO: Implement via SearchPlugin
  }
})
</script>

<style lang="scss">
.map-container {
  position: relative;
  width: 100%;
  
  &--loading {
    pointer-events: none;
  }
  
  &--error {
    .map-core {
      opacity: 0.5;
    }
  }
}
</style>
```

#### –®–∞–≥ 3.2: MapStates - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π (1 —á–∞—Å)

```vue
<!-- features/map/components/MapStates.vue -->
<template>
  <div class="map-states">
    <!-- Loading —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
    <div v-if="loading" class="map-states__loading">
      <div class="map-states__spinner">
        <svg class="animate-spin h-8 w-8 text-blue-600" viewBox="0 0 24 24">
          <circle 
            class="opacity-25" 
            cx="12" 
            cy="12" 
            r="10" 
            stroke="currentColor" 
            stroke-width="4"
          />
          <path 
            class="opacity-75" 
            fill="currentColor" 
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"
          />
        </svg>
      </div>
      <p class="map-states__loading-text">
        {{ loadingText }}
      </p>
    </div>

    <!-- Error —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
    <div v-else-if="error" class="map-states__error">
      <div class="map-states__error-icon">
        <svg class="w-12 h-12 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" 
          />
        </svg>
      </div>
      <h3 class="map-states__error-title">{{ errorTitle }}</h3>
      <p class="map-states__error-message">{{ error }}</p>
      <button 
        @click="$emit('retry')"
        class="map-states__retry-button"
      >
        –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
      </button>
    </div>

    <!-- Content -->
    <div v-else class="map-states__content">
      <slot />
    </div>
  </div>
</template>

<script setup lang="ts">
/**
 * MapStates - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –∫–∞—Ä—Ç—ã
 * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç loading, error –∏–ª–∏ content
 * –†–∞–∑–º–µ—Ä: 40 —Å—Ç—Ä–æ–∫
 */
interface Props {
  loading?: boolean
  error?: string | null
  loadingText?: string
  errorTitle?: string
}

withDefaults(defineProps<Props>(), {
  loading: false,
  error: null,
  loadingText: '–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...',
  errorTitle: '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã'
})

defineEmits<{
  retry: []
}>()
</script>

<style lang="scss">
.map-states {
  position: relative;
  width: 100%;
  height: 100%;
  
  &__loading,
  &__error {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.95);
    z-index: 1000;
  }
  
  &__spinner {
    margin-bottom: 1rem;
  }
  
  &__loading-text {
    color: #6b7280;
    font-size: 0.875rem;
  }
  
  &__error-icon {
    margin-bottom: 1rem;
  }
  
  &__error-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 0.5rem;
  }
  
  &__error-message {
    color: #6b7280;
    font-size: 0.875rem;
    margin-bottom: 1.5rem;
    text-align: center;
    max-width: 300px;
  }
  
  &__retry-button {
    padding: 0.5rem 1rem;
    background: #3b82f6;
    color: white;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    font-weight: 500;
    transition: background 0.2s;
    
    &:hover {
      background: #2563eb;
    }
    
    &:active {
      transform: scale(0.98);
    }
  }
  
  &__content {
    width: 100%;
    height: 100%;
  }
}
</style>
```

#### –®–∞–≥ 3.3: MapControls - UI –∫–æ–Ω—Ç—Ä–æ–ª—ã (1.5 —á–∞—Å–∞)

```vue
<!-- features/map/components/MapControls.vue -->
<template>
  <div class="map-controls">
    <!-- –ü–æ–∏—Å–∫ -->
    <div v-if="showSearch" class="map-controls__search">
      <input
        v-model="searchQuery"
        @keyup.enter="handleSearch"
        type="text"
        placeholder="–ü–æ–∏—Å–∫ –º–µ—Å—Ç–∞..."
        class="map-controls__search-input"
      />
      <button 
        @click="handleSearch"
        class="map-controls__search-button"
        :disabled="!searchQuery"
      >
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" 
          />
        </svg>
      </button>
    </div>

    <!-- –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è -->
    <button
      v-if="showGeolocation"
      @click="$emit('geolocation-click')"
      class="map-controls__button map-controls__button--geolocation"
      title="–ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"
    >
      <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
          d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" 
        />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
          d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" 
        />
      </svg>
    </button>

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã -->
    <slot />
  </div>
</template>

<script setup lang="ts">
/**
 * MapControls - UI –∫–æ–Ω—Ç—Ä–æ–ª—ã –∫–∞—Ä—Ç—ã
 * –ü–æ–∏—Å–∫, –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è –∏ –¥—Ä—É–≥–∏–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
 * –†–∞–∑–º–µ—Ä: 50 —Å—Ç—Ä–æ–∫
 */
import { ref } from 'vue'

interface Props {
  showSearch?: boolean
  showGeolocation?: boolean
}

withDefaults(defineProps<Props>(), {
  showSearch: false,
  showGeolocation: false
})

const emit = defineEmits<{
  'search': [query: string]
  'geolocation-click': []
}>()

const searchQuery = ref('')

function handleSearch() {
  if (searchQuery.value.trim()) {
    emit('search', searchQuery.value.trim())
  }
}
</script>

<style lang="scss">
.map-controls {
  display: flex;
  gap: 0.5rem;
  
  &__search {
    display: flex;
    background: white;
    border-radius: 0.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    overflow: hidden;
  }
  
  &__search-input {
    padding: 0.5rem 1rem;
    border: none;
    outline: none;
    min-width: 200px;
    font-size: 0.875rem;
    
    &::placeholder {
      color: #9ca3af;
    }
  }
  
  &__search-button {
    padding: 0.5rem;
    background: transparent;
    border: none;
    border-left: 1px solid #e5e7eb;
    color: #6b7280;
    cursor: pointer;
    transition: all 0.2s;
    
    &:hover:not(:disabled) {
      background: #f3f4f6;
      color: #1f2937;
    }
    
    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  }
  
  &__button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: white;
    border: none;
    border-radius: 0.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    color: #6b7280;
    cursor: pointer;
    transition: all 0.2s;
    
    &:hover {
      background: #f3f4f6;
      color: #1f2937;
      transform: scale(1.05);
    }
    
    &:active {
      transform: scale(0.95);
    }
    
    &--geolocation {
      color: #3b82f6;
      
      &:hover {
        color: #2563eb;
      }
    }
  }
  
  // Mobile styles
  @media (max-width: 640px) {
    &__search {
      flex: 1;
    }
    
    &__search-input {
      min-width: auto;
      width: 100%;
    }
  }
}
</style>
```

---

### –§–ê–ó–ê 4: –ú–ò–ì–†–ê–¶–ò–Ø –ò –ê–î–ê–ü–¢–ï–† (–î–µ–Ω—å 4, 4 —á–∞—Å–∞)

#### –®–∞–≥ 4.1: –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (2 —á–∞—Å–∞)

```vue
<!-- shared/ui/molecules/YandexMapPicker/YandexMap.vue -->
<template>
  <MapContainer
    ref="mapContainerRef"
    v-bind="adapterProps"
    @update:modelValue="handleUpdate"
    @ready="handleReady"
    @marker-click="$emit('marker-click', $event)"
    @cluster-click="$emit('cluster-click', $event)"
    @address-found="handleAddressFound"
    @center-change="$emit('bounds-change', { center: $event })"
  >
    <template #overlays>
      <!-- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–≤–µ—Ä–ª–µ–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ -->
      <slot name="overlays" />
    </template>
  </MapContainer>
</template>

<script setup lang="ts">
/**
 * YandexMap - –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
 * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å—Ç–∞—Ä–æ–µ API –∫ –Ω–æ–≤–æ–º—É MapContainer
 */
import { ref, computed } from 'vue'
import MapContainer from '@/src/features/map/components/MapContainer.vue'
import type { MapMarker, Coordinates } from '@/src/features/map/types'

// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ä—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å props
interface Props {
  modelValue?: string
  height?: number
  center?: Coordinates
  zoom?: number
  apiKey?: string
  mode?: 'single' | 'multiple'
  markers?: MapMarker[]
  showGeolocationButton?: boolean
  autoDetectLocation?: boolean
  clusterize?: boolean
  draggable?: boolean
  showSingleMarker?: boolean
  showAddressTooltip?: boolean
  currentAddress?: string
  loadingText?: string
  errorTitle?: string
  emptyTitle?: string
  emptyMessage?: string
  ariaLabel?: string
}

const props = withDefaults(defineProps<Props>(), {
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ defaults
  height: 400,
  zoom: 14,
  mode: 'single',
  markers: () => [],
  showGeolocationButton: false,
  autoDetectLocation: false,
  clusterize: false,
  draggable: true,
  showSingleMarker: true,
  showAddressTooltip: true,
  currentAddress: '',
  ariaLabel: '–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞'
})

// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ä—ã–µ events
const emit = defineEmits<{
  'update:modelValue': [value: string]
  'marker-moved': [coords: Coordinates]
  'marker-click': [marker: MapMarker]
  'cluster-click': [markers: MapMarker[]]
  'address-found': [address: string, coords: Coordinates]
  'search-error': [error: string]
  'marker-address-hover': [address: string]
  'bounds-change': [bounds: any]
}>()

const mapContainerRef = ref<InstanceType<typeof MapContainer>>()

// –ê–¥–∞–ø—Ç–∏—Ä—É–µ–º props –∫ –Ω–æ–≤–æ–º—É API
const adapterProps = computed(() => ({
  modelValue: props.modelValue,
  height: props.height,
  center: props.center,
  zoom: props.zoom,
  mode: props.mode,
  markers: props.markers,
  showControls: props.showGeolocationButton || props.showAddressTooltip,
  showGeolocationButton: props.showGeolocationButton,
  showSearchControl: false, // –í —Å—Ç–∞—Ä–æ–º API –Ω–µ –±—ã–ª–æ
  clusterize: props.clusterize,
  draggable: props.draggable,
  autoDetectLocation: props.autoDetectLocation,
  reverseGeocode: props.showAddressTooltip
}))

// Handlers
function handleUpdate(value: string) {
  emit('update:modelValue', value)
  
  // –≠–º—É–ª–∏—Ä—É–µ–º —Å—Ç–∞—Ä–æ–µ —Å–æ–±—ã—Ç–∏–µ marker-moved
  if (value) {
    const [lat, lng] = value.split(',').map(Number)
    emit('marker-moved', { lat, lng })
  }
}

function handleReady(map: any) {
  console.log('[YandexMap Adapter] Map ready, old API preserved')
}

function handleAddressFound(data: { address: string, coords: Coordinates }) {
  emit('address-found', data.address, data.coords)
}

// Expose —Å—Ç–∞—Ä—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
defineExpose({
  // –°—Ç–∞—Ä—ã–µ –º–µ—Ç–æ–¥—ã
  searchAddress: async (address: string) => {
    await mapContainerRef.value?.searchAddress(address)
  },
  setCoordinates: (coords: Coordinates) => {
    mapContainerRef.value?.setCenter(coords)
  },
  getCurrentAddress: () => {
    // TODO: Implement via store
    return props.currentAddress
  },
  clearMap: () => {
    // TODO: Implement
  }
})
</script>
```

#### –®–∞–≥ 4.2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–æ–≤ (1 —á–∞—Å)

```typescript
// scripts/migrate-map-imports.js

const glob = require('glob')
const fs = require('fs')
const path = require('path')

// –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Ñ–∞–π–ª—ã —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏ —Å—Ç–∞—Ä–æ–π –∫–∞—Ä—Ç—ã
const files = glob.sync('resources/js/**/*.{vue,ts,js}', {
  ignore: ['**/node_modules/**', '**/map/**']
})

const OLD_IMPORTS = [
  '@/src/features/map/ui/YandexMapBase/YandexMapBase.vue',
  '@/src/features/map/ui/UniversalMap/UniversalMap.vue',
  '@/src/features/map/composables/useMapController',
  '@/src/features/map/composables/useMapWithMasters'
]

const NEW_IMPORT = '@/src/shared/ui/molecules/YandexMapPicker/YandexMap.vue'

let updatedCount = 0

files.forEach(file => {
  let content = fs.readFileSync(file, 'utf8')
  let hasChanges = false
  
  OLD_IMPORTS.forEach(oldImport => {
    if (content.includes(oldImport)) {
      content = content.replace(oldImport, NEW_IMPORT)
      hasChanges = true
      console.log(`‚úÖ Updated: ${file}`)
    }
  })
  
  if (hasChanges) {
    fs.writeFileSync(file, content)
    updatedCount++
  }
})

console.log(`\nüìä Migration complete: ${updatedCount} files updated`)
```

#### –®–∞–≥ 4.3: –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ (1 —á–∞—Å)

```bash
#!/bin/bash
# scripts/cleanup-old-map-files.sh

echo "üóëÔ∏è Cleaning up old map files..."

# –°–æ–∑–¥–∞–µ–º backup
echo "üì¶ Creating backup..."
tar -czf map-backup-$(date +%Y%m%d-%H%M%S).tar.gz resources/js/src/features/map

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ composables
echo "Removing old composables..."
rm -f resources/js/src/features/map/composables/useAddressGeocoding.ts
rm -f resources/js/src/features/map/composables/useGeolocation.ts
rm -f resources/js/src/features/map/composables/useMapClustering.ts
rm -f resources/js/src/features/map/composables/useMapController.ts
rm -f resources/js/src/features/map/composables/useMapEventHandlers.ts
rm -f resources/js/src/features/map/composables/useMapMarkers.ts
rm -f resources/js/src/features/map/composables/useMapMethods.ts
rm -f resources/js/src/features/map/composables/useMapMobileOptimization.ts
rm -f resources/js/src/features/map/composables/useMapModes.ts
rm -f resources/js/src/features/map/composables/useMapState.ts
rm -f resources/js/src/features/map/composables/useMapWithMasters.ts

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
echo "Removing old UI components..."
rm -rf resources/js/src/features/map/ui/MapEmptyState
rm -rf resources/js/src/features/map/ui/MapErrorState
rm -rf resources/js/src/features/map/ui/MapSkeleton
rm -rf resources/js/src/features/map/ui/MapView
rm -rf resources/js/src/features/map/ui/UniversalMap
rm -rf resources/js/src/features/map/ui/MapAddressTooltip
rm -rf resources/js/src/features/map/ui/MapCenterMarker
rm -rf resources/js/src/features/map/ui/MapGeolocationButton
rm -rf resources/js/src/features/map/ui/MapMarker
rm -rf resources/js/src/features/map/ui/MapMarkers
rm -rf resources/js/src/features/map/ui/MapMarkersManager

# –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
echo "‚úÖ Cleanup complete!"
echo "üìÅ New structure:"
tree resources/js/src/features/map -I 'node_modules|__tests__'
```

---

### –§–ê–ó–ê 5: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø (–î–µ–Ω—å 5, 4 —á–∞—Å–∞)

#### –®–∞–≥ 5.1: E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (2 —á–∞—Å–∞)

```javascript
// tests/e2e/map-after-refactoring.spec.js

import { test, expect } from '@playwright/test'

test.describe('–ö–∞—Ä—Ç–∞ –ü–û–°–õ–ï —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞', () => {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
  
  test('–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞', async ({ page }) => {
    await page.goto('/ad/create')
    
    // –°—Ç–∞—Ä—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å
    await page.waitForSelector('.yandex-map')
    
    // API –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ
    const hasOldApi = await page.evaluate(() => {
      const mapComponent = document.querySelector('.yandex-map').__vue__
      return typeof mapComponent.searchAddress === 'function'
    })
    expect(hasOldApi).toBe(true)
  })
  
  test('–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞', async ({ page }) => {
    const metrics = await page.evaluate(() => {
      performance.mark('map-start')
    })
    
    await page.goto('/ad/create')
    await page.waitForSelector('.yandex-map')
    
    const loadTime = await page.evaluate(() => {
      performance.mark('map-end')
      performance.measure('map-load', 'map-start', 'map-end')
      const measure = performance.getEntriesByType('measure')[0]
      return measure.duration
    })
    
    // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ 1 —Å–µ–∫—É–Ω–¥—ã
    expect(loadTime).toBeLessThan(1000)
  })
  
  test('—Ä–∞–∑–º–µ—Ä bundle —É–º–µ–Ω—å—à–µ–Ω', async ({ page }) => {
    const coverage = await page.coverage.startJSCoverage()
    await page.goto('/ad/create')
    const entries = await page.coverage.stopJSCoverage()
    
    const mapBundle = entries.filter(entry => 
      entry.url.includes('/map/')
    )
    
    const totalSize = mapBundle.reduce((acc, entry) => 
      acc + entry.text.length, 0
    )
    
    // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ 100KB
    expect(totalSize).toBeLessThan(100 * 1024)
  })
})
```

#### –®–∞–≥ 5.2: Performance –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (1 —á–∞—Å)

```typescript
// features/map/utils/performance.ts

/**
 * –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
 */

// Debounce –¥–ª—è —á–∞—Å—Ç—ã—Ö —Å–æ–±—ã—Ç–∏–π
export function debounce<T extends (...args: any[]) => any>(
  fn: T,
  delay: number
): T {
  let timeoutId: ReturnType<typeof setTimeout>
  
  return function(this: any, ...args: Parameters<T>) {
    clearTimeout(timeoutId)
    timeoutId = setTimeout(() => fn.apply(this, args), delay)
  } as T
}

// Throttle –¥–ª—è —Å–æ–±—ã—Ç–∏–π –∫–∞—Ä—Ç—ã
export function throttle<T extends (...args: any[]) => any>(
  fn: T,
  limit: number
): T {
  let inThrottle: boolean
  
  return function(this: any, ...args: Parameters<T>) {
    if (!inThrottle) {
      fn.apply(this, args)
      inThrottle = true
      setTimeout(() => inThrottle = false, limit)
    }
  } as T
}

// Lazy loading –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤
export async function lazyLoadPlugin(name: string) {
  switch(name) {
    case 'cluster':
      return import(
        /* webpackChunkName: "map-cluster" */
        '../plugins/ClusterPlugin'
      )
    case 'geolocation':
      return import(
        /* webpackChunkName: "map-geo" */
        '../plugins/GeolocationPlugin'
      )
    case 'search':
      return import(
        /* webpackChunkName: "map-search" */
        '../plugins/SearchPlugin'
      )
    case 'markers':
      return import(
        /* webpackChunkName: "map-markers" */
        '../plugins/MarkersPlugin'
      )
    default:
      throw new Error(`Unknown plugin: ${name}`)
  }
}

// –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
export function memoize<T extends (...args: any[]) => any>(fn: T): T {
  const cache = new Map()
  
  return function(this: any, ...args: Parameters<T>) {
    const key = JSON.stringify(args)
    
    if (cache.has(key)) {
      return cache.get(key)
    }
    
    const result = fn.apply(this, args)
    cache.set(key, result)
    return result
  } as T
}
```

#### –®–∞–≥ 5.3: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (1 —á–∞—Å)

```bash
#!/bin/bash
# scripts/final-check.sh

echo "üîç Running final checks..."

# 1. Lint
echo "üìù Linting..."
npm run lint

# 2. Type check
echo "üîç Type checking..."
npm run type-check

# 3. Unit tests
echo "üß™ Unit tests..."
npm run test:unit -- features/map

# 4. E2E tests
echo "üåê E2E tests..."
npm run test:e2e -- map

# 5. Bundle analysis
echo "üìä Bundle analysis..."
npm run build:analyze

# 6. Performance test
echo "‚ö° Performance test..."
node scripts/measure-map-performance.js

echo "‚úÖ All checks passed!"
```

---

## üìä –ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- –§–∞–π–ª–æ–≤: 30
- –°—Ç—Ä–æ–∫ –∫–æ–¥–∞: ~2500
- Bundle size: ~200KB
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: ~3 —Å–µ–∫—É–Ω–¥—ã
- –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏: 0%
- –†–∞–±–æ—Ç–∞–µ—Ç: ‚ùå

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- –§–∞–π–ª–æ–≤: 12 (-60%)
- –°—Ç—Ä–æ–∫ –∫–æ–¥–∞: ~650 (-74%)
- Bundle size: <100KB (-50%)
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: <1 —Å–µ–∫—É–Ω–¥–∞ (-67%)
- –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏: >80%
- –†–∞–±–æ—Ç–∞–µ—Ç: ‚úÖ

---

## üö® ROLLBACK –°–¢–†–ê–¢–ï–ì–ò–Ø

### –í —Å–ª—É—á–∞–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º:

1. **–ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç (5 –º–∏–Ω—É—Ç)**
```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup
tar -xzf map-backup-*.tar.gz
git checkout -- resources/js/src/shared/ui/molecules/YandexMapPicker/YandexMap.vue
```

2. **Feature flag (–µ—Å–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω)**
```typescript
// config/features.ts
export const USE_NEW_MAP = process.env.VUE_APP_NEW_MAP === 'true'

// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
import OldMap from './OldYandexMap.vue'
import NewMap from './YandexMap.vue'

const YandexMap = USE_NEW_MAP ? NewMap : OldMap
```

3. **–ü–æ–ª–Ω—ã–π revert**
```bash
git revert HEAD~10..HEAD
git push origin feature/map-refactoring-core-plugins
```

---

## üìÖ TIMELINE

### –ù–µ–¥–µ–ª—è 1
- **–î–µ–Ω—å 1-2**: –§–∞–∑–∞ 0-1 (–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ + –Ø–¥—Ä–æ)
- **–î–µ–Ω—å 3**: –§–∞–∑–∞ 2 (–ü–ª–∞–≥–∏–Ω—ã)
- **–î–µ–Ω—å 4**: –§–∞–∑–∞ 3 (UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
- **–î–µ–Ω—å 5**: –§–∞–∑–∞ 4 (–ú–∏–≥—Ä–∞—Ü–∏—è)

### –ù–µ–¥–µ–ª—è 2
- **–î–µ–Ω—å 1**: –§–∞–∑–∞ 5 (–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- **–î–µ–Ω—å 2**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤
- **–î–µ–Ω—å 3**: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **–î–µ–Ω—å 4**: Code review
- **–î–µ–Ω—å 5**: Deploy

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –ß–ï–ö–õ–ò–°–¢

### –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º
- [ ] –°–æ–∑–¥–∞–Ω –±—Ä–∞–Ω—á `feature/map-refactoring-core-plugins`
- [ ] –ù–∞–ø–∏—Å–∞–Ω—ã E2E —Ç–µ—Å—Ç—ã —Ç–µ–∫—É—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- [ ] –ò–∑–º–µ—Ä–µ–Ω–∞ —Ç–µ–∫—É—â–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –°–æ–∑–¥–∞–Ω backup

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- [ ] MapCore —Å–æ–∑–¥–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] MapLoader —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] MapStore —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- [ ] –í—Å–µ 4 –ø–ª–∞–≥–∏–Ω–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] –ê–¥–∞–ø—Ç–µ—Ä –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] Unit —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç >80%
- [ ] E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] Performance —É–ª—É—á—à–µ–Ω–∞
- [ ] –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

### –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- [ ] –°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] Code review –ø—Ä–æ–π–¥–µ–Ω
- [ ] PR —Å–æ–∑–¥–∞–Ω –∏ approved

---

## üìö –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- [–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–ª–∞–≥–∏–Ω](./docs/add-plugin.md)
- [API Reference](./docs/api-reference.md)
- [Migration Guide](./docs/migration-guide.md)

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```vue
<!-- –ü—Ä–æ—Å—Ç–∞—è –∫–∞—Ä—Ç–∞ -->
<YandexMap v-model="coordinates" />

<!-- –° –≥–µ–æ–ª–æ–∫–∞—Ü–∏–µ–π –∏ –ø–æ–∏—Å–∫–æ–º -->
<YandexMap 
  v-model="coordinates"
  show-geolocation-button
  auto-detect-location
  @address-found="handleAddress"
/>

<!-- –ö–∞—Ä—Ç–∞ —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏ -->
<YandexMap
  mode="multiple"
  :markers="masters"
  clusterize
  @marker-click="showMasterCard"
/>
```

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ –ø–ª–∞–Ω–∞ –º—ã –ø–æ–ª—É—á–∏–º:

1. **–†–∞–±–æ—Ç–∞—é—â—É—é –∫–∞—Ä—Ç—É** —Å –ø—Ä–æ—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
2. **–ú–æ–¥—É–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É** —Å –ø–ª–∞–≥–∏–Ω–∞–º–∏
3. **–£–ª—É—á—à–µ–Ω–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** (–≤ 3 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ)
4. **–£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π bundle** (–≤ 2 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ)
5. **–ü–æ–ª–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
6. **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ >80%**
7. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥**
8. **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ª–µ–≥–∫–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ "–Ø–¥—Ä–æ + –ü–ª–∞–≥–∏–Ω—ã" –ø–æ–∑–≤–æ–ª–∏—Ç –≤ –±—É–¥—É—â–µ–º –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–¥–∞.