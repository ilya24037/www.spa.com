# üéØ –ü–õ–ê–ù –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–ê –°–ï–ö–¶–ò–ò –§–û–¢–û

##    –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 26.08.2025
- **–¶–µ–ª—å:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ª–æ–≥–∏–∫—É, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –≤–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- **–°—Ç–∞—Ç—É—Å:** –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (–ø–æ—Å–ª–µ MVP)

---

## üîç –ß–ê–°–¢–¨ 1: –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï

###    –§–∞–π–ª—ã –∏ –∏—Ö —Ä–æ–ª—å:

#### Frontend - Vue –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
1. **`PhotoUpload.vue`** - –≥–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
   - Drag & Drop –∑–æ–Ω–∞
   - –ü–æ–∫–∞–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ
   - –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞
   - –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ

2. **`PhotoUploadZone.vue`** - –∑–æ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ drag & drop —Ñ–∞–π–ª–æ–≤
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
   - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ base64

3. **`usePhotoUpload.ts`** - –ª–æ–≥–∏–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Ñ–æ—Ç–æ
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Ä–æ–¥–∏—Ç–µ–ª–µ–º

#### Frontend - –§–æ—Ä–º–∞ –∏ –º–æ–¥–µ–ª—å:
4. **`adFormModel.ts`** - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `hasPhotoFiles`
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ –≤ FormData
   - –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ (FormData vs JSON)

5. **`AdForm.vue`** - –≥–ª–∞–≤–Ω–∞—è —Ñ–æ—Ä–º–∞
   - –°–≤—è–∑—å —Å PhotoUpload
   - –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–µ–∫—Ü–∏—è–º–∏

#### Backend - Laravel:
6. **`DraftController.php`** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ base64 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –°–ª–∏—è–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏ –Ω–æ–≤—ã—Ö —Ñ–æ—Ç–æ

7. **`MediaStorageService.php`** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (10MB)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫

---

### üîß –¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ—Ç —Ñ–∞–π–ª –≤ –∑–æ–Ω—É
2. `PhotoUploadZone.vue` –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ñ–∞–π–ª (—Ä–∞–∑–º–µ—Ä, —Ñ–æ—Ä–º–∞—Ç)
3. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ base64 –¥–ª—è preview
4. –î–æ–±–∞–≤–ª—è–µ—Ç –≤ `localPhotos` –º–∞—Å—Å–∏–≤
5. Emit –æ–±–Ω–æ–≤–ª—è–µ—Ç `form.photos` –≤ —Ä–æ–¥–∏—Ç–µ–ª–µ
6. `adFormModel.ts` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `hasPhotoFiles = true`
7. –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ FormData

#### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞):
1. Drag & Drop –º–µ–∂–¥—É —Ñ–æ—Ç–æ –≤ `PhotoUpload.vue`
2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ `localPhotos` –º–∞—Å—Å–∏–≤–µ
3. Emit –æ–±–Ω–æ–≤–ª—è–µ—Ç `form.photos`
4. –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫

#### –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ:
1. –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ —É–¥–∞–ª–µ–Ω–∏—è –≤ `PhotoUpload.vue`
2. –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ `localPhotos` –º–∞—Å—Å–∏–≤–∞
3. Emit –æ–±–Ω–æ–≤–ª—è–µ—Ç `form.photos`
4. –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤

#### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —á–µ—Ä–Ω–æ–≤–∏–∫:
1. `adFormModel.ts` –≥–æ—Ç–æ–≤–∏—Ç FormData
2. –í—Å–µ —Ñ–æ—Ç–æ (File + base64) –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ FormData
3. `DraftController.php` –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
4. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –∏ base64
5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

---

##    –ß–ê–°–¢–¨ 2: –ü–õ–ê–ù –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–ê

### üéØ –≠—Ç–∞–ø 1: –£–ø—Ä–æ—â–µ–Ω–∏–µ Frontend –ª–æ–≥–∏–∫–∏

#### 1.1 –£–ø—Ä–æ—Å—Ç–∏—Ç—å `adFormModel.ts`

**–ë—ã–ª–æ:**
```typescript
const hasPhotoFiles = form.photos?.some((p: any) => {
  if (p instanceof File) return true
  if (typeof p === 'object' && p !== null && p.preview && p.preview.startsWith('data:image/')) return true
  if (typeof p === 'string' && p.startsWith('data:image/')) return true
  return false
})
```

**–°—Ç–∞–Ω–µ—Ç:**
```typescript
const hasPhotoFiles = computed(() => {
  return form.photos?.some(photo => {
    return photo instanceof File || 
           (typeof photo === 'string' && photo.startsWith('data:')) ||
           (photo?.preview && photo.preview.startsWith('data:'))
  }) || false
})
```

#### 1.2 –£–ø—Ä–æ—Å—Ç–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ `PhotoUploadZone.vue`

**–ë—ã–ª–æ:**
```typescript
const validateFiles = (files: File[]): File[] => {
  return files.filter(file => {
    if (!props.acceptedFormats.some(format => file.type.startsWith(format.split('/*')[0]))) {
      console.warn(`‚ùå –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç: ${file.type}`)
      return false
    }
    if (file.size > props.maxSize) {
      console.warn(`‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π: ${file.name}`)
      return false
    }
    console.log(`‚úÖ –§–∞–π–ª –ø—Ä–∏–Ω—è—Ç: ${file.name}`)
    return true
  })
}
```

**–°—Ç–∞–Ω–µ—Ç:**
```typescript
const validateFiles = (files: File[]): File[] => {
  return files.filter(file => {
    const isValidFormat = props.acceptedFormats.some(format => 
      file.type.startsWith(format.split('/*')[0])
    )
    const isValidSize = file.size <= props.maxSize
    
    if (!isValidFormat || !isValidSize) {
      console.warn(`‚ùå –§–∞–π–ª –æ—Ç–∫–ª–æ–Ω–µ–Ω: ${file.name}`)
      return false
    }
    
    return true
  })
}
```

### üéØ –≠—Ç–∞–ø 2: –£–ø—Ä–æ—â–µ–Ω–∏–µ Backend –ª–æ–≥–∏–∫–∏

#### 2.1 –£–ø—Ä–æ—Å—Ç–∏—Ç—å `DraftController.php`

**–ë—ã–ª–æ:**
```php
foreach ($photoIndexes as $photoIndex) {
    $bracketNotation = "photos[{$photoIndex}]";
    $dotNotation = "photos.{$photoIndex}";
    
    if ($request->hasFile($bracketNotation)) {
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
    } elseif ($hasValue) {
        $photoValue = $request->input($bracketNotation) ?: $request->input($dotNotation);
        if (is_string($photoValue) && !empty($photoValue)) {
            if (str_starts_with($photoValue, 'data:image/')) {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ base64
            } else {
                // –û–±—ã—á–Ω—ã–µ URL
            }
        }
    }
}
```

**–°—Ç–∞–Ω–µ—Ç:**
```php
if ($request->has('photos')) {
    $photos = $request->input('photos');
    $processedPhotos = [];
    
    foreach ($photos as $photo) {
        if (is_string($photo) && str_starts_with($photo, 'data:image/')) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º base64
            $processedPhotos[] = $this->saveBase64Photo($photo);
        } elseif ($photo instanceof UploadedFile) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
            $processedPhotos[] = $this->saveUploadedPhoto($photo);
        } else {
            // –û—Å—Ç–∞–≤–ª—è–µ–º URL
            $processedPhotos[] = $photo;
        }
    }
    
    $ad->photos = $processedPhotos;
}
```

---

##    –ß–ê–°–¢–¨ 3: –î–ï–¢–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –í–´–ü–û–õ–ù–ï–ù–ò–Ø

### üìù –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
```bash
# –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É –¥–ª—è –±—ç–∫–∞–ø–æ–≤
mkdir -p backup/$(date +%Y%m%d_%H%M%S)

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
cp resources/js/src/features/media/photo-upload/ui/PhotoUpload.vue backup/
cp resources/js/src/features/media/photo-upload/ui/PhotoUploadZone.vue backup/
cp resources/js/src/features/media/photo-upload/composables/usePhotoUpload.ts backup/
cp resources/js/src/features/ad-creation/model/adFormModel.ts backup/
cp app/Application/Http/Controllers/Ad/DraftController.php backup/
```

### üìù –®–∞–≥ 2: –£–ø—Ä–æ—â–µ–Ω–∏–µ Frontend
1. **–£–ø—Ä–æ—Å—Ç–∏—Ç—å `adFormModel.ts`** - –ª–æ–≥–∏–∫—É `hasPhotoFiles`
2. **–£–ø—Ä–æ—Å—Ç–∏—Ç—å `PhotoUploadZone.vue`** - –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–∞–π–ª–æ–≤
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å `PhotoUpload.vue`** - –æ—Å—Ç–∞–≤–∏—Ç—å Drag & Drop –∫–∞–∫ –µ—Å—Ç—å

### üìù –®–∞–≥ 3: –£–ø—Ä–æ—â–µ–Ω–∏–µ Backend
1. **–£–ø—Ä–æ—Å—Ç–∏—Ç—å `DraftController.php`** - –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ç–æ
2. **–°–æ–∑–¥–∞—Ç—å helper –º–µ—Ç–æ–¥—ã** - –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è base64 –∏ —Ñ–∞–π–ª–æ–≤
3. **–£–ø—Ä–æ—Å—Ç–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–ª–∏—è–Ω–∏—è** - –º–∞—Å—Å–∏–≤–æ–≤ —Ñ–æ—Ç–æ

### üìù –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. **–¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ** - drag & drop —Ñ–∞–π–ª–æ–≤
2. **–¢–µ—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞** - –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ
3. **–¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ** - —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–æ—Ç–æ
4. **–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è** - –≤ —á–µ—Ä–Ω–æ–≤–∏–∫ –∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ

---

##    –ß–ê–°–¢–¨ 4: –ß–¢–û –ü–û–õ–£–ß–ò–ú –ü–û–°–õ–ï –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–ê

### ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è:
- Drag & Drop –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
- –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ —Ñ–æ—Ç–æ
- –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ
- Base64 –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –í—Å–µ —Ä–∞–∑–º–µ—Ä—ã –∏ —Ñ–æ—Ä–º–∞—Ç—ã

### ‚úÖ –£–ø—Ä–æ—Å—Ç–∏—Ç—Å—è:
- –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è `hasPhotoFiles`
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
- Backend –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –ö–æ–¥ —Å—Ç–∞–Ω–µ—Ç —á–∏—Ç–∞–µ–º–µ–µ
- –ú–µ–Ω—å—à–µ –±–∞–≥–æ–≤

### ‚úÖ –£–ª—É—á—à–∏—Ç—Å—è:
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞
- –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å
- –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ –æ—Ç–ª–∞–¥–∫–∏

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û –î–õ–Ø –û–¢–ö–ê–¢–ê

### –§–∞–π–ª—ã –¥–ª—è –±—ç–∫–∞–ø–∞:
1. `PhotoUpload.vue`
2. `PhotoUploadZone.vue` 
3. `usePhotoUpload.ts`
4. `adFormModel.ts`
5. `DraftController.php`

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–∫–∞—Ç–∞:
```bash
# –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
cp backup/PhotoUpload.vue resources/js/src/features/media/photo-upload/ui/
cp backup/PhotoUploadZone.vue resources/js/src/features/media/photo-upload/ui/
cp backup/usePhotoUpload.ts resources/js/src/features/media/photo-upload/composables/
cp backup/adFormModel.ts resources/js/src/features/ad-creation/model/
cp backup/DraftController.php app/Application/Http/Controllers/Ad/
```

---

## üìä –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤
- [ ] –£–ø—Ä–æ—â–µ–Ω–∏–µ Frontend
- [ ] –£–ø—Ä–æ—â–µ–Ω–∏–µ Backend
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

---

##   Ô∏è –¢–µ–≥–∏
#—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ #—Ñ–æ—Ç–æ #—É–ø—Ä–æ—â–µ–Ω–∏–µ #drag-drop #—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ #–±—ç–∫–µ–Ω–¥