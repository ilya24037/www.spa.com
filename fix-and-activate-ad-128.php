<?php

require_once __DIR__ . '/vendor/autoload.php';

$app = require_once __DIR__ . '/bootstrap/app.php';
$app->make('Illuminate\Contracts\Console\Kernel')->bootstrap();

echo "–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è ID 128...\n";

// –ù–∞–π–¥–µ–º –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
$ad = \App\Domain\Ad\Models\Ad::find(128);

if (!$ad) {
    echo "‚ùå –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å ID 128 –Ω–µ –Ω–∞–π–¥–µ–Ω–æ\n";
    exit(1);
}

echo "üìã –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è:\n";
echo "ID: {$ad->id}\n";
echo "–°—Ç–∞—Ç—É—Å: {$ad->status->value}\n";
echo "–ù–∞–∑–≤–∞–Ω–∏–µ: {$ad->title}\n";
echo "–¶–µ–Ω–∞: " . ($ad->price ?: '–ù–ï –£–ö–ê–ó–ê–ù–ê') . "\n";
echo "–¢–µ–ª–µ—Ñ–æ–Ω: " . ($ad->phone ?: '–ù–ï –£–ö–ê–ó–ê–ù') . "\n";

// –î–æ–ø–æ–ª–Ω–∏–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è
$updates = [];

if (empty($ad->price)) {
    $updates['price'] = 3000; // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ü–µ–Ω–∞
    echo "‚úèÔ∏è –î–æ–±–∞–≤–ª—è—é —Ü–µ–Ω—É: 3000 —Ä—É–±\n";
}

if (empty($ad->phone)) {
    $updates['phone'] = '+7 999 123 45 67'; // –¢–µ—Å—Ç–æ–≤—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω
    echo "‚úèÔ∏è –î–æ–±–∞–≤–ª—è—é —Ç–µ–ª–µ—Ñ–æ–Ω: +7 999 123 45 67\n";
}

if (empty($ad->description)) {
    $updates['description'] = '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —ç—Ä–æ—Ç–∏—á–µ—Å–∫–∏–π –º–∞—Å—Å–∞–∂. –†–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º –∫ –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É.';
    echo "‚úèÔ∏è –î–æ–±–∞–≤–ª—è—é –æ–ø–∏—Å–∞–Ω–∏–µ\n";
}

// –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
$updates['status'] = \App\Domain\Ad\Enums\AdStatus::ACTIVE;

try {
    $ad->update($updates);
    
    echo "\n‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –¥–æ–ø–æ–ª–Ω–µ–Ω–æ –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ!\n";
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    $ad->refresh();
    echo "\nüìã –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:\n";
    echo "–°—Ç–∞—Ç—É—Å: {$ad->status->value}\n";
    echo "–¶–µ–Ω–∞: {$ad->price} —Ä—É–±\n";
    echo "–¢–µ–ª–µ—Ñ–æ–Ω: {$ad->phone}\n";
    echo "–û–ø–∏—Å–∞–Ω–∏–µ: " . substr($ad->description, 0, 50) . "...\n";
    echo "\nüåê URL: http://spa.test/ads/{$ad->id}\n";
    
} catch (\Exception $e) {
    echo "\n‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è:\n";
    echo $e->getMessage() . "\n";
    exit(1);
}

echo "\nüéâ –ì–æ—Ç–æ–≤–æ! –û–±—ä—è–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ —Å—Å—ã–ª–∫–µ.\n";