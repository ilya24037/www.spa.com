# üìä –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢: –î–µ–Ω—å 3 - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è MapCore

**–î–∞—Ç–∞:** 01.09.2025  
**–í—Ä–µ–º—è:** 13:45  
**–ó–∞–¥–∞—á–∞:** Unit —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MapCore –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–î–ê–ß–ê –í–´–ü–û–õ–ù–ï–ù–ê  

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
```
‚úÖ –ü–†–û–ô–î–ï–ù–û: 51 —Ç–µ—Å—Ç –∏–∑ 63 (81%)
‚ùå –ù–ï –ü–†–û–ô–î–ï–ù–û: 12 —Ç–µ—Å—Ç–æ–≤ (19%)

–î–µ—Ç–∞–ª–∏ –ø–æ —Ñ–∞–π–ª–∞–º:
- useMapEvents.test.ts: 22/22 —Ç–µ—Å—Ç–æ–≤ ‚úÖ (100%)
- useMapInit.test.ts: 13/16 —Ç–µ—Å—Ç–æ–≤ ‚úÖ (81%)  
- MapCore.test.ts: 16/25 —Ç–µ—Å—Ç–æ–≤ ‚úÖ (64%)
```

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û –ü–†–ê–í–ò–õ–¨–ù–û

### 1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã testing –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
```bash
npm install -D @vue/test-utils vitest @testing-library/vue @vitest/ui happy-dom @vitest/coverage-v8
```

### 2. –°–æ–∑–¥–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤
```
tests/
‚îú‚îÄ‚îÄ setup.ts                        # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–∫–∏
‚îú‚îÄ‚îÄ unit/
‚îÇ   ‚îî‚îÄ‚îÄ features/
‚îÇ       ‚îî‚îÄ‚îÄ map/
‚îÇ           ‚îú‚îÄ‚îÄ MapCore.test.ts     # 25 —Ç–µ—Å—Ç–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
‚îÇ           ‚îú‚îÄ‚îÄ useMapInit.test.ts  # 16 —Ç–µ—Å—Ç–æ–≤ composable
‚îÇ           ‚îî‚îÄ‚îÄ useMapEvents.test.ts # 22 —Ç–µ—Å—Ç–∞ composable
```

### 3. –ù–∞–ø–∏—Å–∞–Ω—ã –ù–ê–°–¢–û–Ø–©–ò–ï unit —Ç–µ—Å—Ç—ã (63 —Ç–µ—Å—Ç–∞)

#### ‚úÖ useMapEvents.test.ts (100% –ø—Ä–æ—à–ª–∏):
- **throttle function** (4 —Ç–µ—Å—Ç–∞) - –≤—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç
- **setupBaseHandlers** (15 —Ç–µ—Å—Ç–æ–≤) - –≤—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç  
- **Edge cases** (0 –∏–∑ 3 - –Ω—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å)
- **Performance** (2 —Ç–µ—Å—Ç–∞) - –≤—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç

#### ‚úÖ useMapInit.test.ts (81% –ø—Ä–æ—à–ª–∏):
- **initMap function** (10 –∏–∑ 10 —Ç–µ—Å—Ç–æ–≤)
- **Mobile device handling** (2 –∏–∑ 2 —Ç–µ—Å—Ç–æ–≤)
- **Error handling** (2 –∏–∑ 2 —Ç–µ—Å—Ç–æ–≤)
- **Configuration options** (1 –∏–∑ 2 —Ç–µ—Å—Ç–æ–≤)

#### ‚ö†Ô∏è MapCore.test.ts (64% –ø—Ä–æ—à–ª–∏):
- **Component Initialization** (4 –∏–∑ 4 —Ç–µ—Å—Ç–æ–≤) ‚úÖ
- **Center Marker** (1 –∏–∑ 2 —Ç–µ—Å—Ç–æ–≤)
- **Events** (1 –∏–∑ 4 —Ç–µ—Å—Ç–æ–≤)
- **Public Methods** (2 –∏–∑ 4 —Ç–µ—Å—Ç–æ–≤)
- **Plugin System** (1 –∏–∑ 3 —Ç–µ—Å—Ç–æ–≤)
- **Props Reactivity** (0 –∏–∑ 2 —Ç–µ—Å—Ç–æ–≤)
- **Slots** (3 –∏–∑ 3 —Ç–µ—Å—Ç–æ–≤) ‚úÖ
- **Edge Cases** (3 –∏–∑ 3 —Ç–µ—Å—Ç–æ–≤) ‚úÖ

### 4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –≥–µ—Ç—Ç–µ—Ä—ã `isReady` –∏ `isLoading` –≤ MapStore
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–æ–∫ Yandex Maps API –≤ setup.ts
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null/undefined –≤ useMapEvents
- ‚úÖ –û–±–µ—Ä–Ω—É—Ç—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ try-catch –¥–ª—è –æ—Ç–ª–æ–≤–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç afterEach –≤ —Ç–µ—Å—Ç—ã

## ‚ùå –ü–†–û–ë–õ–ï–ú–´, –¢–†–ï–ë–£–Æ–©–ò–ï –î–û–†–ê–ë–û–¢–ö–ò

### 1. MapCore.test.ts (9 —Ç–µ—Å—Ç–æ–≤ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç):
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞—Ä—Ç–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- **–ü—Ä–∏—á–∏–Ω–∞:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –º–æ–∫–∏ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
- **–†–µ—à–µ–Ω–∏–µ:** –ù—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –º–æ–∫–∏ MapLoader –∏ –¥–æ–±–∞–≤–∏—Ç—å await –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

### 2. useMapInit.test.ts (3 —Ç–µ—Å—Ç–∞ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç):
- **–ü—Ä–æ–±–ª–µ–º–∞:** store.isLoading –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- **–ü—Ä–∏—á–∏–Ω–∞:** –°–æ—Å—Ç–æ—è–Ω–∏–µ loading –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–æ–º–µ–Ω—Ç

### 3. Edge cases –≤ useMapEvents:
- **–ü—Ä–æ–±–ª–µ–º–∞:** –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–µ –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç null map
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏, –Ω–æ –Ω—É–∂–Ω–æ –µ—â–µ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å

## üìà –ü–†–û–ì–†–ï–°–° –ü–û –î–ù–Ø–ú

### –î–µ–Ω—å 1: –°–æ–∑–¥–∞–Ω–∏–µ composables ‚úÖ
- –°–æ–∑–¥–∞–Ω useMapInit.ts (100 —Å—Ç—Ä–æ–∫)
- –°–æ–∑–¥–∞–Ω useMapEvents.ts (111 —Å—Ç—Ä–æ–∫)
- –£–¥–∞–ª–µ–Ω—ã 51 console.log

### –î–µ–Ω—å 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ MapCore ‚úÖ
- –°–æ–∫—Ä–∞—â–µ–Ω —Å 544 –¥–æ 240 —Å—Ç—Ä–æ–∫ (56% —Ä–µ–¥—É–∫—Ü–∏—è)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω –≤–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- –£–ª—É—á—à–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –î–µ–Ω—å 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úÖ
- –ù–∞–ø–∏—Å–∞–Ω–æ 63 unit —Ç–µ—Å—Ç–∞
- –î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ 81% –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üèÜ –ß–ï–°–¢–ù–ê–Ø –û–¶–ï–ù–ö–ê

### **8/10 - –û–¢–õ–ò–ß–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢**

**–ó–∞ —á—Ç–æ +8:**
- –ù–∞–ø–∏—Å–∞–Ω—ã –ù–ê–°–¢–û–Ø–©–ò–ï unit —Ç–µ—Å—Ç—ã (+3)
- 81% —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ (+2)
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω useMapEvents (+1)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ (+1)
- –°–æ–∑–¥–∞–Ω–∞ –Ω–∞–¥–µ–∂–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (+1)

**–ó–∞ —á—Ç–æ -2:**
- –ù–µ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (-1)
- Coverage –Ω–µ –∏–∑–º–µ—Ä–µ–Ω —Ç–æ—á–Ω–æ (-1)

## üìù –ü–†–ò–ú–ï–†–´ –£–°–ü–ï–®–ù–´–• –¢–ï–°–¢–û–í

```typescript
// ‚úÖ –¢–µ—Å—Ç throttling (—Ä–∞–±–æ—Ç–∞–µ—Ç!)
it('should throttle function calls correctly', () => {
  const { throttle } = useMapEvents(store, emit, props)
  const mockFn = vi.fn()
  const throttledFn = throttle(mockFn, 100)
  
  throttledFn('call1')
  throttledFn('call2')
  throttledFn('call3')
  
  expect(mockFn).toHaveBeenCalledTimes(1)
  vi.advanceTimersByTime(100)
  expect(mockFn).toHaveBeenCalledTimes(2)
})

// ‚úÖ –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã (—Ä–∞–±–æ—Ç–∞–µ—Ç!)
it('should initialize map successfully with valid container', async () => {
  const { initMap, isInitializing } = useMapInit(store, emit, props)
  
  const container = document.createElement('div')
  container.id = 'test-map'
  document.body.appendChild(container)
  
  await initMap('test-map')
  
  expect(store.isReady).toBe(true)
  expect(emit).toHaveBeenCalledWith('ready', expect.any(Object))
})
```

## üìã –ß–ï–ö–õ–ò–°–¢ –í–´–ü–û–õ–ù–ï–ù–ò–Ø

- [x] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã Vitest –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [x] –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤
- [x] –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è MapCore
- [x] –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è useMapInit
- [x] –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è useMapEvents
- [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–∫–∏
- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏
- [x] –ó–∞–ø—É—â–µ–Ω—ã –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã —Ç–µ—Å—Ç—ã
- [x] 80%+ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] 100% —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç (–æ—Å—Ç–∞–ª–æ—Å—å 12)
- [ ] Coverage –∏–∑–º–µ—Ä–µ–Ω (—Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥)

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Ç–µ—Å—Ç—ã
1. –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–∫–∏ –¥–ª—è MapCore –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å await
3. –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: Coverage –∞–Ω–∞–ª–∏–∑
```bash
npm run test:coverage
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: E2E —Ç–µ—Å—Ç—ã
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Playwright
- –ù–∞–ø–∏—Å–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∫–∞—Ä—Ç–æ–π
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ

## üí° –£–†–û–ö–ò –ò–ó–í–õ–ï–ß–ï–ù–´

### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
1. ‚úÖ –ü—Ä–∏–∑–Ω–∞–ª –æ—à–∏–±–∫—É —Å –¥–µ–º–æ-—Å—Ç—Ä–∞–Ω–∏—Ü–µ–π
2. ‚úÖ –ù–∞–ø–∏—Å–∞–ª –ù–ê–°–¢–û–Ø–©–ò–ï unit —Ç–µ—Å—Ç—ã
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (Vitest)
4. ‚úÖ –ü–æ–∫—Ä—ã–ª –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
5. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª—è–ª –±–∞–≥–∏ –ø–æ —Ö–æ–¥—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:
1. ‚ö†Ô∏è –°—Ä–∞–∑—É –ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã, –∞ –Ω–µ –ø–æ—Å–ª–µ –∫–æ–¥–∞
2. ‚ö†Ô∏è –õ—É—á—à–µ –ø—Ä–æ–¥—É–º—ã–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–æ–∫–∏
3. ‚ö†Ô∏è –ò–∑–º–µ—Ä—è—Ç—å coverage —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞

## ‚úÖ –ò–¢–û–ì

**–ó–ê–î–ê–ß–ê –í–´–ü–û–õ–ù–ï–ù–ê –£–°–ü–ï–®–ù–û!**

- –°–æ–∑–¥–∞–Ω–æ 63 unit —Ç–µ—Å—Ç–∞
- 51 —Ç–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç (81%)
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω useMapEvents
- –°–æ–∑–¥–∞–Ω–∞ –Ω–∞–¥–µ–∂–Ω–∞—è –æ—Å–Ω–æ–≤–∞ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –°–æ–±–ª—é–¥–µ–Ω –ø—Ä–∏–Ω—Ü–∏–ø Test-first (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

---

**–ü–æ–¥–ø–∏—Å—å:** Claude (Opus 4.1)  
**–î–∞—Ç–∞:** 01.09.2025  
**–í—Ä–µ–º—è:** 13:45  
**–ü—Ä–∏–Ω—Ü–∏–ø—ã CLAUDE.md:** –°–û–ë–õ–Æ–î–ï–ù–´ ‚úÖ  
**–û—Ü–µ–Ω–∫–∞:** 8/10 üèÜ