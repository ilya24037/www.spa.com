# SPA Platform - Техническое видение проекта

## 🎯 Обзор проекта
SPA Platform - это специализированная платформа для поиска и бронирования услуг массажа, построенная по модели объявлений как на Avito, но с фокусом на wellness-услуги.

## 🛠️ Технологический стек

### Backend:
- **Laravel 12** - основной фреймворк
- **PHP 8.2+** - язык программирования
- **MySQL 8.0** - база данных
- **Redis** - кэширование и сессии
- **Laravel Sanctum** - аутентификация API
- **Laravel Horizon** - управление очередями
- **Laravel Telescope** - отладка и мониторинг

### Frontend:
- **Vue 3** - основной фреймворк
- **Inertia.js** - связка с Laravel
- **TypeScript** - типизация
- **Pinia** - управление состоянием
- **Tailwind CSS** - стилизация
- **Headless UI** - компоненты UI
- **Vite** - сборка

### Инфраструктура:
- **Docker** - контейнеризация
- **Nginx** - веб-сервер
- **Supervisor** - управление процессами
- **Laravel Forge** - деплой
- **Cloudflare** - CDN и защита

## 🏗️ Принципы разработки

### Основные принципы:
- **KISS** - Keep It Simple, Stupid
- **YAGNI** - You Aren't Gonna Need It
- **DRY** - Don't Repeat Yourself
- **SOLID** - принципы объектно-ориентированного программирования
- **MVP** - Minimum Viable Product
- **Fail Fast** - быстрая обработка ошибок
- **Итеративная разработка** - пошаговое развитие

### Архитектурные принципы:
- **Модульная архитектура** - как на Avito/Ozon
- **Разделение ответственности** - четкое разделение слоев
- **Инверсия зависимостей** - использование интерфейсов
- **Единая точка входа** - API Gateway
- **Микросервисная готовность** - возможность разделения на сервисы

## 🏛️ Структура проекта

### Backend структура:
```
app/
├── Http/Controllers/        # Контроллеры
│   ├── Api/                # API контроллеры
│   └── Web/                # Web контроллеры
├── Models/                 # Модели данных
├── Services/               # Бизнес-логика
├── Repositories/           # Работа с данными
├── Requests/               # Валидация запросов
├── Resources/              # API ресурсы
├── Events/                 # События
├── Listeners/              # Обработчики событий
├── Jobs/                   # Фоновые задачи
├── Notifications/          # Уведомления
└── Policies/               # Политики доступа
```

### Frontend структура:
```
resources/js/
├── Components/             # Vue компоненты
│   ├── UI/                # Базовые UI элементы
│   ├── Common/            # Общие компоненты
│   ├── Features/          # Функциональные модули
│   │   ├── Dashboard/     # Личные кабинеты
│   │   │   ├── Client/    # Кабинет клиента
│   │   │   └── Master/    # Кабинет мастера
│   │   ├── Ads/           # Объявления
│   │   ├── Chat/          # Чат
│   │   └── Booking/       # Бронирование
│   └── Pages/             # Компоненты страниц
├── Stores/                # Pinia stores
├── Types/                 # TypeScript типы
├── Utils/                 # Утилиты
└── Composables/           # Vue композаблы
```

### Структура личных кабинетов:

#### Кабинет мастера (как на Avito):
```
Dashboard/Master/
├── Dashboard.vue          # Главная страница
├── MyAds/                 # Мои объявления
│   ├── Index.vue          # Список объявлений
│   ├── Create.vue         # Создание объявления
│   └── Edit.vue           # Редактирование
├── Messages/              # Сообщения
│   ├── Index.vue          # Список чатов
│   └── Chat.vue           # Чат с клиентом
├── Statistics/            # Статистика
│   ├── Overview.vue       # Общая статистика
│   └── Details.vue        # Детальная статистика
├── Finance/               # Финансы
│   ├── Balance.vue        # Баланс
│   └── History.vue        # История платежей
└── Settings/              # Настройки
    ├── Profile.vue        # Профиль
    └── Notifications.vue  # Уведомления
```

#### Кабинет клиента:
```
Dashboard/Client/
├── Dashboard.vue          # Главная страница
├── Orders/                # Мои заказы
│   ├── Index.vue          # Список заказов
│   └── Show.vue           # Детали заказа
├── Favorites/             # Избранное
│   └── Index.vue          # Список избранного
├── Messages/              # Сообщения
│   ├── Index.vue          # Список чатов
│   └── Chat.vue           # Чат с мастером
├── Reviews/               # Отзывы
│   └── Index.vue          # Мои отзывы
└── Settings/              # Настройки
    ├── Profile.vue        # Профиль
    └── Notifications.vue  # Уведомления
```

#### Административная панель:
```
Admin/
├── Dashboard.vue          # Главная панель администратора
├── Users/                 # Управление пользователями
│   ├── Index.vue          # Список пользователей
│   ├── Show.vue           # Детали пользователя
│   └── Edit.vue           # Редактирование пользователя
├── Ads/                   # Управление объявлениями
│   ├── Index.vue          # Список объявлений
│   ├── Show.vue           # Детали объявления
│   └── Moderate.vue       # Модерация объявления
├── Finance/               # Финансы
│   ├── Overview.vue       # Общая статистика
│   ├── Payments.vue       # Платежи
│   └── Reports.vue        # Отчеты
├── Moderation/            # Модерация
│   ├── Content.vue        # Модерация контента
│   ├── Complaints.vue     # Жалобы
│   └── Violations.vue     # Нарушения
├── Analytics/             # Аналитика
│   ├── Overview.vue       # Общая аналитика
│   ├── Users.vue          # Аналитика пользователей
│   └── Ads.vue            # Аналитика объявлений
├── Settings/              # Настройки системы
│   ├── General.vue        # Общие настройки
│   ├── Tariffs.vue        # Тарифы
│   └── Limits.vue         # Лимиты
├── Moderators/            # Управление модераторами
│   ├── Index.vue          # Список модераторов
│   ├── Create.vue         # Создание модератора
│   └── Edit.vue           # Редактирование прав
├── Support/               # Поддержка
│   ├── Tickets.vue        # Тикеты
│   └── Responses.vue      # Ответы
└── Logs/                  # Логи и аудит
    ├── Activity.vue       # Активность пользователей
    └── System.vue         # Системные логи
```

## 🗄️ Архитектура проекта

### Общая архитектура:
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │   Backend       │    │   Database      │
│   (Vue + Inertia)│◄──►│   (Laravel)     │◄──►│   (MySQL)       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   CDN           │    │   Redis         │    │   File Storage  │
│   (Cloudflare)  │    │   (Cache)       │    │   (S3/Local)    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### Модульная архитектура:
- **Модуль объявлений** - создание, редактирование, поиск
- **Модуль пользователей** - регистрация, профили, аутентификация
- **Модуль личных кабинетов** - дашборды для клиентов и мастеров
- **Модуль административной панели** - управление платформой
- **Модуль ролей и прав** - система доступа и разрешений
- **Модуль чата** - общение между клиентами и мастерами
- **Модуль бронирования** - система записи на услуги
- **Модуль платежей** - оплата объявлений и услуг
- **Модуль уведомлений** - email, SMS, push-уведомления
- **Модуль аналитики** - статистика и отчеты
- **Модуль модерации** - проверка контента и пользователей

## 📊 Модель данных

### Основные сущности:

#### Пользователи (users):
- id, email, phone, password
- avatar, created_at, updated_at
- role (client, master, admin)

#### Объявления (ads):
- id, user_id, title, description
- price, location, coordinates
- status (active, inactive, moderated)
- promoted (boolean), promoted_until
- views_count, created_at, updated_at

#### Фото объявлений (ad_photos):
- id, ad_id, path, order
- alt_text, created_at

#### Услуги (services):
- id, ad_id, name, price, duration
- description, created_at

#### Чат (chats):
- id, ad_id, client_id, master_id
- last_message_at, created_at

#### Сообщения (messages):
- id, chat_id, user_id, content
- type (text, image, file), created_at

#### Бронирования (bookings):
- id, ad_id, client_id, master_id
- service_id, date, time, status
- price, created_at, updated_at

#### Роли (roles):
- id, name, display_name, description
- created_at, updated_at

#### Разрешения (permissions):
- id, name, display_name, description
- created_at, updated_at

#### Роли пользователей (role_user):
- user_id, role_id, created_at

#### Разрешения ролей (permission_role):
- permission_id, role_id

#### Аудит (audit_logs):
- id, user_id, action, model_type, model_id
- old_values, new_values, ip_address, user_agent
- created_at

### Связи:
- User hasMany Ads
- Ad belongsTo User
- Ad hasMany AdPhotos
- Ad hasMany Services
- Ad hasMany Chats
- Chat belongsTo Ad, Client, Master
- Chat hasMany Messages
- Booking belongsTo Ad, Client, Master, Service
- User belongsToMany Roles
- Role belongsToMany Permissions
- User hasMany AuditLogs

## 🤖 Работа с LLM

### Интеграция с AI:
- **OpenAI API** - для умных рекомендаций
- **Генерация описаний** - помощь мастерам в создании объявлений
- **Модерация контента** - автоматическая проверка объявлений
- **Чат-бот** - помощь пользователям
- **Аналитика** - анализ данных и трендов

### Мониторинг LLM:
- **Логирование запросов** - все обращения к API
- **Метрики использования** - количество запросов, время ответа
- **Мониторинг ошибок** - отслеживание проблем
- **Анализ качества** - оценка релевантности ответов

## 📈 Сценарии работы

### Сценарий 1: Регистрация мастера
1. Мастер регистрируется на платформе
2. Заполняет минимальный профиль (аватарка, телефон)
3. Создает первое объявление
4. Загружает фото, описывает услуги
5. Устанавливает цены и расписание
6. Публикует объявление

### Сценарий 2: Поиск и бронирование
1. Клиент заходит на главную страницу
2. Использует фильтры для поиска
3. Просматривает объявления
4. Переходит на детальную страницу
5. Читает отзывы, смотрит фото
6. Начинает чат с мастером
7. Бронирует услугу
8. Оплачивает

### Сценарий 3: Управление объявлениями
1. Мастер заходит в личный кабинет
2. Видит главную страницу с общей статистикой
3. Переходит в "Мои объявления"
4. Редактирует объявление
5. Продвигает объявление
6. Смотрит детальную статистику
7. Отвечает на сообщения в чате

### Сценарий 4: Личный кабинет мастера
1. Мастер заходит в личный кабинет
2. Видит главную страницу с ключевыми метриками
3. Переходит в "Мои объявления" - видит все объявления с фильтрами
4. Создает новое объявление через "Создать объявление"
5. Проверяет "Сообщения" - отвечает на чат с клиентами
6. Анализирует "Статистику" - просмотры, контакты, конверсия
7. Управляет "Финансами" - баланс, платежи, вывод средств
8. Настраивает профиль в "Настройках"

### Сценарий 5: Личный кабинет клиента
1. Клиент заходит в личный кабинет
2. Видит главную страницу с избранными объявлениями
3. Переходит в "Мои заказы" - видит историю бронирований
4. Проверяет "Избранное" - сохраненные объявления
5. Отвечает на "Сообщения" от мастеров
6. Оставляет "Отзывы" о полученных услугах
7. Настраивает профиль в "Настройках"

### Сценарий 6: Административная панель
1. Администратор заходит в админку
2. Видит главную панель с ключевыми метриками
3. Переходит в "Пользователи" - управляет клиентами и мастерами
4. Проверяет "Объявления" - модерирует контент
5. Анализирует "Финансы" - контролирует платежи
6. Настраивает "Систему" - конфигурация платформы
7. Управляет "Модераторами" - назначает права доступа

### Сценарий 7: Работа модератора
1. Модератор заходит в админку
2. Видит доступные ему разделы (по правам)
3. Проверяет "Модерацию контента" - объявления на проверку
4. Обрабатывает "Жалобы" от пользователей
5. Блокирует нарушителей в "Пользователях"
6. Отвечает на "Тикеты" поддержки

## 🚀 Деплой

### Окружения:
- **Development** - локальная разработка
- **Staging** - тестовая среда
- **Production** - продакшн

### Процесс деплоя:
1. **Тестирование** - автоматические тесты
2. **Сборка** - создание Docker образов
3. **Деплой** - развертывание на сервере
4. **Миграции** - обновление базы данных
5. **Проверка** - тестирование функциональности

### Инфраструктура:
- **Сервер** - VPS с Ubuntu 22.04
- **База данных** - MySQL 8.0
- **Кэш** - Redis
- **Файлы** - S3 или локальное хранилище
- **CDN** - Cloudflare
- **Мониторинг** - Laravel Telescope + внешние сервисы

## ⚙️ Конфигурирование

### Переменные окружения:
```env
# База данных
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=spa_platform
DB_USERNAME=root
DB_PASSWORD=

# Redis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

# Файлы
FILESYSTEM_DISK=local
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_DEFAULT_REGION=
AWS_BUCKET=

# Платежи
STRIPE_KEY=
STRIPE_SECRET=

# Уведомления
MAIL_MAILER=smtp
MAIL_HOST=
MAIL_PORT=587
MAIL_USERNAME=
MAIL_PASSWORD=

# AI
OPENAI_API_KEY=
```

### Конфигурация приложения:
- **Настройки сайта** - название, описание, контакты
- **Платежные системы** - настройки оплаты
- **Уведомления** - шаблоны email и SMS
- **Модерация** - правила проверки объявлений
- **Лимиты** - ограничения для пользователей

## 📝 Логирование

### Уровни логирования:
- **ERROR** - критические ошибки
- **WARNING** - предупреждения
- **INFO** - информационные сообщения
- **DEBUG** - отладочная информация

### Что логируем:
- **Запросы к API** - все входящие запросы
- **Ошибки приложения** - исключения и ошибки
- **Действия пользователей** - регистрация, создание объявлений
- **Платежи** - все финансовые операции
- **Работа с LLM** - запросы к AI сервисам
- **Производительность** - время выполнения запросов

### Формат логов:
```json
{
  "timestamp": "2024-01-01T12:00:00Z",
  "level": "INFO",
  "message": "User created ad",
  "context": {
    "user_id": 123,
    "ad_id": 456,
    "ip": "192.168.1.1"
  }
}
```

## 🔒 Безопасность

### Аутентификация:
- **Laravel Sanctum** - токены для API
- **Двухфакторная аутентификация** - для мастеров
- **Восстановление пароля** - через email

### Авторизация:
- **Политики доступа** - Laravel Policies
- **Роли и разрешения** - Spatie Laravel Permission
- **Проверка прав** - на каждом действии
- **Административные роли** - супер-админ, админ, модераторы
- **Гранулярные права** - детальные разрешения для каждого действия

### Защита данных:
- **Шифрование** - чувствительные данные
- **Валидация** - все входящие данные
- **Санитизация** - очистка пользовательского ввода
- **Rate Limiting** - ограничение запросов
- **CSRF защита** - токены для форм

## 📊 Мониторинг и аналитика

### Метрики приложения:
- **Производительность** - время ответа, использование памяти
- **Ошибки** - количество и типы ошибок
- **Пользователи** - активность, регистрации
- **Объявления** - создание, просмотры, конверсия
- **Платежи** - успешные и неудачные транзакции

### Внешние сервисы:
- **Laravel Telescope** - отладка и мониторинг
- **Sentry** - отслеживание ошибок
- **Google Analytics** - веб-аналитика
- **Yandex Metrica** - дополнительная аналитика

## 🎯 Ключевые метрики

### Бизнес-метрики:
- **Количество объявлений** - активные и общие
- **Количество пользователей** - клиенты и мастера
- **Конверсия** - от просмотра к бронированию
- **Выручка** - от платных объявлений и продвижения

### Технические метрики:
- **Время ответа** - среднее время загрузки страниц
- **Доступность** - uptime сервиса
- **Ошибки** - количество ошибок в день
- **Производительность** - использование ресурсов

## 🚀 План развития

### Фаза 1 (MVP):
- Базовая функциональность объявлений
- Простой поиск и фильтры
- Чат между пользователями
- Система бронирования
- Мобильная адаптация

### Фаза 2 (Расширение):
- Продвинутые фильтры
- Система отзывов
- Платежная система
- Уведомления
- Аналитика

### Фаза 3 (Оптимизация):
- AI рекомендации
- Модерация контента
- Продвинутая аналитика
- Мобильное приложение
- API для партнеров

## 👥 Система ролей и прав доступа

### Роли пользователей:

#### Супер-администратор:
- **Полный доступ** ко всем функциям платформы
- **Управление администраторами** - создание, редактирование, удаление
- **Настройки системы** - конфигурация, тарифы, лимиты
- **Финансы** - все платежи, отчеты, вывод средств
- **Аналитика** - полная статистика и отчеты
- **Логи и аудит** - все действия пользователей

#### Администратор:
- **Управление пользователями** - блокировка, разблокировка
- **Модерация контента** - проверка объявлений, жалобы
- **Финансы** - просмотр платежей, отчетов
- **Аналитика** - базовая статистика
- **Поддержка** - тикеты, обращения
- **Управление модераторами** - назначение прав

#### Модератор контента:
- **Проверка объявлений** - модерация, одобрение, отклонение
- **Обработка жалоб** - рассмотрение жалоб пользователей
- **Блокировка контента** - скрытие нарушающих объявлений
- **Просмотр статистики** - базовая аналитика по контенту

#### Модератор пользователей:
- **Блокировка пользователей** - временная и постоянная блокировка
- **Проверка документов** - верификация мастеров
- **Обработка нарушений** - рассмотрение жалоб на пользователей
- **Восстановление аккаунтов** - разблокировка по заявкам

#### Модератор финансов:
- **Проверка платежей** - верификация транзакций
- **Вывод средств** - одобрение заявок на вывод
- **Возвраты** - обработка возвратов платежей
- **Финансовая отчетность** - базовые отчеты

#### Модератор поддержки:
- **Тикеты поддержки** - ответы на обращения пользователей
- **FAQ** - управление базой знаний
- **Уведомления** - отправка уведомлений пользователям
- **Обратная связь** - сбор и анализ отзывов

### Разрешения (Permissions):

#### Управление пользователями:
- `users.view` - просмотр пользователей
- `users.create` - создание пользователей
- `users.edit` - редактирование пользователей
- `users.delete` - удаление пользователей
- `users.block` - блокировка пользователей
- `users.unblock` - разблокировка пользователей

#### Управление объявлениями:
- `ads.view` - просмотр объявлений
- `ads.moderate` - модерация объявлений
- `ads.approve` - одобрение объявлений
- `ads.reject` - отклонение объявлений
- `ads.delete` - удаление объявлений

#### Финансы:
- `finance.view` - просмотр финансов
- `finance.payments` - управление платежами
- `finance.withdrawals` - одобрение выводов
- `finance.reports` - финансовые отчеты

#### Аналитика:
- `analytics.view` - просмотр аналитики
- `analytics.reports` - создание отчетов
- `analytics.export` - экспорт данных

#### Система:
- `system.settings` - настройки системы
- `system.roles` - управление ролями
- `system.logs` - просмотр логов
- `system.backup` - резервное копирование

### Аудит и логирование:

#### Отслеживаемые действия:
- **Вход/выход** - аутентификация пользователей
- **Создание/редактирование** - изменения данных
- **Удаление** - удаление записей
- **Блокировка/разблокировка** - действия с пользователями
- **Модерация** - одобрение/отклонение контента
- **Финансовые операции** - платежи, выводы
- **Изменение прав** - назначение ролей

#### Логи аудита:
```json
{
  "id": 123,
  "user_id": 456,
  "action": "user.blocked",
  "model_type": "User",
  "model_id": 789,
  "old_values": {"status": "active"},
  "new_values": {"status": "blocked"},
  "ip_address": "192.168.1.1",
  "user_agent": "Mozilla/5.0...",
  "created_at": "2024-01-01T12:00:00Z"
}
```

## 📋 Заключение

SPA Platform - это современная, масштабируемая платформа, построенная на проверенных технологиях и принципах. Архитектура позволяет легко развивать продукт, добавлять новые функции и масштабировать под растущую нагрузку.

Ключевые преимущества:
- **Простота** - понятная архитектура и код
- **Масштабируемость** - готовность к росту
- **Безопасность** - защита данных пользователей
- **Производительность** - быстрая работа
- **Гибкость** - легкость изменений
- **Административный контроль** - полное управление платформой
- **Гибкая система ролей** - настраиваемые права доступа