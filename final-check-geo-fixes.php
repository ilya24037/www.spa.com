<?php

use App\Domain\Ad\Models\Ad;

require_once __DIR__ . '/vendor/autoload.php';
$app = require_once __DIR__ . '/bootstrap/app.php';
$app->make(\Illuminate\Contracts\Console\Kernel::class)->bootstrap();

echo "üéØ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –í–°–ï–• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô\n";
echo "=" . str_repeat("=", 60) . "\n\n";

echo "üìã –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ó–ê–î–ê–ß–ò:\n";
echo str_repeat("-", 50) . "\n";
echo "‚úÖ 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥:\n";
echo "     ‚Ä¢ outcall –ø–æ–ª—è –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –∏–∑ prices –≤ geo\n";
echo "     ‚Ä¢ –£–¥–∞–ª–µ–Ω –∫–æ—Å—Ç—ã–ª—å –≤ DraftService.php\n";
echo "     ‚Ä¢ Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª—è\n\n";

echo "‚úÖ 2. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:\n";
echo "     ‚Ä¢ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è 2025_08_28_093431\n";
echo "     ‚Ä¢ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã\n";
echo "     ‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ rollback –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏\n\n";

echo "‚úÖ 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ–∫–±–æ–∫—Å–æ–≤:\n";
echo "     ‚Ä¢ outcall_apartment, outcall_hotel, outcall_office\n";
echo "     ‚Ä¢ –¢–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ geo, –∞ –Ω–µ –≤ prices\n\n";

echo "‚úÖ 4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞–π–æ–Ω–æ–≤ (zones):\n";
echo "     ‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω watcher –¥–ª—è geoData.zones\n";
echo "     ‚Ä¢ –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è emitGeoData()\n";
echo "     ‚Ä¢ –î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ form.geo\n\n";

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
$ad = Ad::find(97);
if ($ad) {
    echo "üìä –ü–†–û–í–ï–†–ö–ê –û–ë–™–Ø–í–õ–ï–ù–ò–Ø ID 97:\n";
    echo str_repeat("-", 50) . "\n";
    
    $geo = $ad->geo ?? [];
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∂–∏–º –≤—ã–µ–∑–¥–∞
    $outcall = $geo['outcall'] ?? 'none';
    echo "üìç –†–µ–∂–∏–º –≤—ã–µ–∑–¥–∞: {$outcall}\n";
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–π–æ–Ω—ã
    if ($outcall === 'zones' && isset($geo['zones']) && is_array($geo['zones'])) {
        echo "\nüèòÔ∏è –†–∞–π–æ–Ω—ã –≤—ã–µ–∑–¥–∞ (" . count($geo['zones']) . "):\n";
        foreach ($geo['zones'] as $i => $zone) {
            echo "   " . ($i + 1) . ". {$zone}\n";
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Å—Ç–∞ –≤—ã–µ–∑–¥–∞
    echo "\nüè† –ú–µ—Å—Ç–∞ –≤—ã–µ–∑–¥–∞:\n";
    $places = [
        'outcall_apartment' => '–ù–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É',
        'outcall_hotel' => '–í –≥–æ—Å—Ç–∏–Ω–∏—Ü—É',
        'outcall_office' => '–í –æ—Ñ–∏—Å',
        'outcall_house' => '–í –∑–∞–≥–æ—Ä–æ–¥–Ω—ã–π –¥–æ–º',
        'outcall_sauna' => '–í —Å–∞—É–Ω—É'
    ];
    
    foreach ($places as $key => $name) {
        $value = $geo[$key] ?? false;
        $status = $value ? '‚úÖ' : '‚ùå';
        echo "   ‚Ä¢ {$name}: {$status}\n";
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤ prices –ù–ï–¢ outcall –ø–æ–ª–µ–π
    echo "\nüí∞ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—è prices:\n";
    $prices = $ad->prices ?? [];
    $hasOutcallInPrices = false;
    foreach (['outcall_apartment', 'outcall_hotel', 'outcall_office'] as $field) {
        if (isset($prices[$field])) {
            $hasOutcallInPrices = true;
            echo "   ‚ùå –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª–µ {$field} –≤ prices (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ geo)\n";
        }
    }
    if (!$hasOutcallInPrices) {
        echo "   ‚úÖ –í prices –Ω–µ—Ç outcall –ø–æ–ª–µ–π - –ø—Ä–∞–≤–∏–ª—å–Ω–æ!\n";
    }
}

echo "\n" . str_repeat("=", 60) . "\n";
echo "üéØ –†–ï–ó–£–õ–¨–¢–ê–¢: –í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –£–°–ü–ï–®–ù–û –ü–†–ò–ú–ï–ù–ï–ù–´!\n\n";

echo "üìù –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:\n";
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ http://spa.test/ads/97/edit\n";
echo "2. –í —Å–µ–∫—Ü–∏–∏ '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è':\n";
echo "   ‚Ä¢ –ò–∑–º–µ–Ω–∏—Ç–µ —á–µ–∫–±–æ–∫—Å—ã –º–µ—Å—Ç –≤—ã–µ–∑–¥–∞\n";
echo "   ‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ '–í –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–æ–Ω—ã' –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ä–∞–π–æ–Ω—ã\n";
echo "3. –ù–∞–∂–º–∏—Ç–µ '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫'\n";
echo "4. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É\n";
echo "5. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è! ‚úÖ\n";