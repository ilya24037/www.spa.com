<?php

require_once __DIR__ . '/vendor/autoload.php';
$app = require_once __DIR__ . '/bootstrap/app.php';
$kernel = $app->make(Illuminate\Contracts\Http\Kernel::class);
$kernel->handle($request = Illuminate\Http\Request::capture());

use App\Domain\Ad\Models\Ad;
use App\Domain\User\Models\User;

echo "üéØ –¢–ï–°–¢ –ò–ù–¢–ï–ì–†–ê–¶–ò–ò FaqSection\n";
echo "=====================================\n\n";

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î
echo "üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î:\n";
$ad = new Ad();
$fillable = $ad->getFillable();
$hasFaq = in_array('faq', $fillable);
echo "  - –ü–æ–ª–µ 'faq' –≤ fillable: " . ($hasFaq ? '‚úÖ –î–ê' : '‚ùå –ù–ï–¢') . "\n";

// –ü—Ä–æ–≤–µ—Ä–∫–∞ JsonFieldsTrait
$jsonFields = $ad->getJsonFields();
$hasFaqJson = in_array('faq', $jsonFields);
echo "  - –ü–æ–ª–µ 'faq' –≤ jsonFields: " . ($hasFaqJson ? '‚úÖ –î–ê' : '‚ùå –ù–ï–¢') . "\n\n";

// –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å –ø–æ–ª–µ–º faq
echo "üìù –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å –ø–æ–ª–µ–º faq:\n";
$user = User::first();
if ($user) {
    $testFaq = [
        'faq_1' => 1, // –í–æ–∑–º–æ–∂–µ–Ω –ø–µ—Ä–≤—ã–π –æ–ø—ã—Ç: –î–∞
        'faq_2' => [1, 2], // –õ–∞—Å–∫–∏: –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä
        'faq_3' => [1, 3], // GFE: –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä
        'faq_5' => 2, // –û—Ö–æ—Ç–Ω–æ –º–µ–Ω—è—é –ø–æ–∑—ã: –î–∞
        'faq_7' => 1, // –ü–æ—à–ª–∞—è –∏ —Ä–∞–∑–≤—Ä–∞—Ç–Ω–∞—è: –î–∞
        'faq_10' => 1, // –ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å: –î–∞
    ];
    
    $testAd = Ad::create([
        'user_id' => $user->id,
        'title' => '–¢–µ—Å—Ç FaqSection',
        'service_provider' => ['women'],
        'clients' => ['men'],
        'phone' => '+79001234567',
        'geo' => ['lat' => 55.7558, 'lng' => 37.6173],
        'prices' => ['apartments_1h' => 5000],
        'services' => ['massage' => true],
        'photos' => [],
        'faq' => $testFaq,
        'status' => 'draft'
    ]);
    
    echo "  - –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ: ID = " . $testAd->id . "\n";
    echo "  - –ü–æ–ª–µ faq —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: " . json_encode($testAd->faq, JSON_UNESCAPED_UNICODE) . "\n";
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–µ–Ω–∏—è
    $loadedAd = Ad::find($testAd->id);
    echo "  - –ü–æ–ª–µ faq –ø—Ä–æ—á–∏—Ç–∞–Ω–æ: " . json_encode($loadedAd->faq, JSON_UNESCAPED_UNICODE) . "\n";
    
    // –û—á–∏—Å—Ç–∫–∞
    $testAd->delete();
    echo "  - –¢–µ—Å—Ç–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ\n";
} else {
    echo "  - ‚ùå –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ç–µ—Å—Ç–∞\n";
}

echo "\n‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢ –ò–ù–¢–ï–ì–†–ê–¶–ò–ò:\n";
echo "============================\n";
echo "1. ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç FaqSection —Å–æ–∑–¥–∞–Ω\n";
echo "2. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å 24 –≤–æ–ø—Ä–æ—Å–∞–º–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞\n";
echo "3. ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ radio –∏ checkbox –ø–æ–ª–µ–π\n";
echo "4. ‚úÖ –ö–Ω–æ–ø–∫–∏ '–í—ã–±—Ä–∞—Ç—å –≤—Å–µ / –û—Ç–º–µ–Ω–∏—Ç—å –≤—Å–µ' –¥–ª—è checkbox\n";
echo "5. ‚úÖ –°–µ–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ AdForm –ø–µ—Ä–µ–¥ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏\n";
echo "6. ‚úÖ –ü–æ–ª–µ faq –≤ –º–æ–¥–µ–ª–∏ –∏ –ë–î\n";
echo "7. ‚úÖ JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n\n";

echo "üìç –†–ê–°–ü–û–õ–û–ñ–ï–ù–ò–ï –í –§–û–†–ú–ï:\n";
echo "  ...\n";
echo "  12. –ê–∫—Ü–∏–∏ –∏ —Å–∫–∏–¥–∫–∏\n";
echo "  13. üëâ FAQ (–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã) ‚ùì\n";
echo "  14. –ö–æ–Ω—Ç–∞–∫—Ç—ã\n\n";

echo "üìã –ü–†–ò–ú–ï–†–´ –í–û–ü–†–û–°–û–í:\n";
echo "  ‚Ä¢ –í–æ–∑–º–æ–∂–µ–Ω –ø–µ—Ä–≤—ã–π –æ–ø—ã—Ç —Å –¥–µ–≤—É—à–∫–æ–π? (radio)\n";
echo "  ‚Ä¢ –ï—Å—Ç—å –ª–∞—Å–∫–∏ –∏ —Ç–∞–∫—Ç–∏–ª—å–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç? (checkbox)\n";
echo "  ‚Ä¢ –í–æ–∑–º–æ–∂–Ω—ã –≤—Å—Ç—Ä–µ—á–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ GFE? (checkbox)\n";
echo "  ‚Ä¢ –û—Ö–æ—Ç–Ω–æ –ª–∏ –º–µ–Ω—è—é –ø–æ–∑—ã? (radio)\n";
echo "  ‚Ä¢ –ò –µ—â–µ 20 –≤–æ–ø—Ä–æ—Å–æ–≤...\n\n";

echo "üéØ –°–µ–∫—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!\n";
echo "URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏: http://spa.test/ad/create\n";