# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã 419 CSRF –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ Filament Admin

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å Filament –ø–æ –∞–¥—Ä–µ—Å—É `/admin/login`:
- –ü–æ—è–≤–ª—è–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ "This page has expired" (–°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å—Ç–∞—Ä–µ–ª–∞)
- –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –æ—à–∏–±–∫–∞: `POST /livewire/update 419 (unknown status)`
- Livewire –∑–∞–ø—Ä–æ—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Å –∫–æ–¥–æ–º 419 CSRF Token Mismatch

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏–ª–∏:
1. ‚úÖ –ê–¥–º–∏–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î (`admin@spa.com`)
2. ‚úÖ –ü–∞—Ä–æ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (`admin123`)
3. ‚úÖ –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (ADMIN/MODERATOR)
4. ‚úÖ 32 Filament —Ä–æ—É—Ç–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã
5. ‚úÖ –°–µ—Å—Å–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (driver: database, —Ç–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
6. ‚úÖ CSRF middleware –ø–æ–¥–∫–ª—é—á–µ–Ω –≤ `AdminPanelProvider`
7. ‚úÖ CSRF —Ç–æ–∫–µ–Ω –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–≤ `data-csrf` –∞—Ç—Ä–∏–±—É—Ç–µ Livewire)

### –ß—Ç–æ –ù–ï –ø–æ–º–æ–≥–ª–æ:
- ‚ùå –û—Ç–∫–ª—é—á–µ–Ω–∏–µ SPA —Ä–µ–∂–∏–º–∞ –≤ Filament (`.spa()`)
- ‚ùå –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–µ–π (`config:clear`, `cache:clear`, `view:clear`)
- ‚ùå –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∞ —á–µ—Ä–µ–∑ seeder
- ‚ùå Rebuild Filament assets

### –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã:
**–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–æ–º–µ–Ω–∞ –º–µ–∂–¥—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –¥–æ—Å—Ç—É–ø–æ–º**

–í `.env` —Ñ–∞–π–ª–µ:
```env
APP_URL=http://localhost:8000      # ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
SESSION_DOMAIN=localhost            # ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
```

–ù–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑:
```
http://spa.test/admin/login         # –†–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å APP_URL
```env
# –ë—ã–ª–æ:
APP_URL=http://localhost:8000

# –°—Ç–∞–ª–æ:
APP_URL=http://spa.test
```

### –®–∞–≥ 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å SESSION_DOMAIN
```env
# –ë—ã–ª–æ:
SESSION_DOMAIN=localhost

# –°—Ç–∞–ª–æ:
SESSION_DOMAIN=spa.test
```

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω –≤ SANCTUM_STATEFUL_DOMAINS
```env
# –ë—ã–ª–æ:
SANCTUM_STATEFUL_DOMAINS=localhost,localhost:8000,localhost:5173,127.0.0.1,127.0.0.1:8000,::1

# –°—Ç–∞–ª–æ:
SANCTUM_STATEFUL_DOMAINS=spa.test,localhost,localhost:8000,localhost:5173,127.0.0.1,127.0.0.1:8000,::1
```

### –®–∞–≥ 4: –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à–∏
```bash
php artisan config:clear
php artisan cache:clear
php artisan view:clear
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ö–æ–¥
1. –û—Ç–∫—Ä—ã—Ç—å `http://spa.test/admin/login`
2. –í–≤–µ—Å—Ç–∏: `admin@spa.com` / `admin123`
3. –í—Ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å!

## üìù –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç—ã —Å–µ—Å—Å–∏–π –∏ CSRF –≤ Laravel:

1. **–ö—É–∫–∏ —Å–µ—Å—Å–∏–π –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –¥–æ–º–µ–Ω—É**
   - –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫—É–∫–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ –¥–æ–º–µ–Ω, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–Ω–∏ –±—ã–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
   - –ï—Å–ª–∏ SESSION_DOMAIN=localhost, –∞ –≤—ã –∑–∞—Ö–æ–¥–∏—Ç–µ –Ω–∞ spa.test - –∫—É–∫–∞ –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

2. **CSRF —Ç–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Å–µ—Å—Å–∏–∏**
   - Laravel –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç CSRF —Ç–æ–∫–µ–Ω –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –≤ —Å–µ—Å—Å–∏–∏
   - –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ —Ñ–æ—Ä–º—ã —Å —Ç–æ–∫–µ–Ω–æ–º –≤ —Å–µ—Å—Å–∏–∏

3. **–ë–µ–∑ —Å–µ—Å—Å–∏–∏ –Ω–µ—Ç CSRF —Ç–æ–∫–µ–Ω–∞**
   - –ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑-–∑–∞ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –¥–æ–º–µ–Ω–∞
   - Laravel –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å CSRF —Ç–æ–∫–µ–Ω
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 419 –æ—à–∏–±–∫—É

### –¶–µ–ø–æ—á–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã:
```
–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π SESSION_DOMAIN
    ‚Üì
–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫—É–∫—É —Å–µ—Å—Å–∏–∏
    ‚Üì
–°–µ—Å—Å–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
    ‚Üì
CSRF —Ç–æ–∫–µ–Ω –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è
    ‚Üì
419 Page Expired
```

## üéØ –í–∞–∂–Ω—ã–µ —É—Ä–æ–∫–∏

### 1. –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–æ–º–µ–Ω–æ–≤
–ü—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Laravel –ø—Ä–æ–µ–∫—Ç–∞ —É–±–µ–¥–∏—Å—å —á—Ç–æ:
- `APP_URL` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º –¥–æ–º–µ–Ω–æ–º
- `SESSION_DOMAIN` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º –¥–æ–º–µ–Ω–æ–º
- `SANCTUM_STATEFUL_DOMAINS` –≤–∫–ª—é—á–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω

### 2. Livewire –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç CSRF
CSRF —Ç–æ–∫–µ–Ω –≤ Livewire –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ù–ï –≤ —Å–∫—Ä—ã—Ç–æ–º –ø–æ–ª–µ `<input name="_token">`, –∞ –≤ –∞—Ç—Ä–∏–±—É—Ç–µ:
```html
<script src="/livewire/livewire.js" data-csrf="TOKEN_HERE"></script>
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–º–æ–≥–ª–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
–°–æ–∑–¥–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤ (`AdminLoginTest.php`) –∏ —Ä—É—á–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ (`test_admin_login_manual.php`) –ø–æ–º–æ–≥–ª–æ:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- –û—Ç—Å–µ—á—å –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–µ –≥–∏–ø–æ—Ç–µ–∑—ã
- –°—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 4. SPA —Ä–µ–∂–∏–º –ù–ï –±—ã–ª –ø—Ä–æ–±–ª–µ–º–æ–π
–•–æ—Ç—è –æ—Ç–∫–ª—é—á–∏–ª–∏ `->spa()` –≤ AdminPanelProvider, —ç—Ç–æ –Ω–µ —Ä–µ—à–∏–ª–æ –ø—Ä–æ–±–ª–µ–º—É. –†–µ–∞–ª—å–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –±—ã–ª–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

## üìã –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–∏ 419 CSRF –æ—à–∏–±–∫–∞—Ö

1. ‚¨ú –ü—Ä–æ–≤–µ—Ä—å APP_URL –≤ .env —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º –¥–æ–º–µ–Ω–æ–º
2. ‚¨ú –ü—Ä–æ–≤–µ—Ä—å SESSION_DOMAIN —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º –¥–æ–º–µ–Ω–æ–º
3. ‚¨ú –ü—Ä–æ–≤–µ—Ä—å SANCTUM_STATEFUL_DOMAINS –≤–∫–ª—é—á–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω
4. ‚¨ú –û—á–∏—Å—Ç–∏ –∫–µ—à–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è .env
5. ‚¨ú –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ SESSION_DRIVER –Ω–∞—Å—Ç—Ä–æ–µ–Ω (database/file)
6. ‚¨ú –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ sessions —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–¥–ª—è database driver)
7. ‚¨ú –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ VerifyCsrfToken middleware –ø–æ–¥–∫–ª—é—á–µ–Ω
8. ‚¨ú –ü—Ä–æ–≤–µ—Ä—å –∫—É–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (DevTools ‚Üí Application ‚Üí Cookies)

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `.env` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å—Ç—Ä–æ–∫–∏ 5, 37, 79)
- `app/Providers/Filament/AdminPanelProvider.php` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Filament
- `app/Http/Middleware/FilamentAdminAccess.php` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- `config/session.php` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Å—Å–∏–π
- `tests/Feature/Filament/AdminLoginTest.php` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
- `test_admin_login_manual.php` - –†—É—á–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

## üè∑Ô∏è –¢–µ–≥–∏

#filament #csrf #419 #session #livewire #admin #login #debugging #env-config

---

**–î–∞—Ç–∞**: 2025-10-01
**–í—Ä–µ–º—è —Ä–µ—à–µ–Ω–∏—è**: ~2 —á–∞—Å–∞
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω—è—è
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ—à–µ–Ω–æ
