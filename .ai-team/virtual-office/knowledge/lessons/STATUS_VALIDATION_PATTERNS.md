# ‚ö° –®–∞–±–ª–æ–Ω—ã —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏

**–¶–µ–ª—å:** –ë—ã—Å—Ç—Ä–æ —Ä–µ—à–∞—Ç—å —Ç–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ Actions.

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤:
```
"–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ [–¥–µ–π—Å—Ç–≤–∏–µ] –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ —Ç–µ–∫—É—â–µ–º —Å—Ç–∞—Ç—É—Å–µ"
"Cannot transition from [status] to [status]"  
"–î–µ–π—Å—Ç–≤–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º [status]"
```

### –ì–¥–µ –∏—Å–∫–∞—Ç—å:
```bash
# –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É –æ—à–∏–±–∫–∏
grep -r "—Ç–µ–∫—É—â–µ–º —Å—Ç–∞—Ç—É—Å–µ" app/Domain/*/Actions/
grep -r "Cannot transition" app/Domain/*/Actions/
grep -r "–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.*—Å—Ç–∞—Ç—É—Å" app/Domain/*/Actions/
```

---

## üõ†Ô∏è –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –°–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
```php
// ‚ùå –ü–†–û–ë–õ–ï–ú–ê: —Ä–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞—Ç—É—Å—ã
if (!in_array($model->status, [Status::ACTIVE, Status::DRAFT])) {
    return ['success' => false, 'message' => '–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ...'];
}

// ‚úÖ –†–ï–®–ï–ù–ò–ï: –∑–∞–ø—Ä–µ—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–µ
if ($model->status === Status::ALREADY_PROCESSED) {
    return ['success' => false, 'message' => '–£–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ'];
}
// –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å
```

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–æ–≤–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏  
```php
// ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –Ω–µ —É—á—Ç–µ–Ω
$allowedStatuses = [Status::ACTIVE, Status::DRAFT]; // –∑–∞–±—ã–ª–∏ WAITING_PAYMENT

// ‚úÖ –†–ï–®–ï–ù–ò–ï: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã Enum
if (!$currentStatus->canTransitionTo($newStatus)) {
    return ['success' => false, 'message' => '–ü–µ—Ä–µ—Ö–æ–¥ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω'];
}
```

### 3. –ñ–µ—Å—Ç–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤
```php
// ‚ùå –ü–†–û–ë–õ–ï–ú–ê: —Å—Ç—Ä–æ–≥–∏–π –∞–≤—Ç–æ–º–∞—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π  
$transitions = [
    'draft' => ['active'],
    'active' => ['archived'],
    // waiting_payment –∑–∞–±—ã–ª–∏
];

// ‚úÖ –†–ï–®–ï–ù–ò–ï: –≥–∏–±–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞
$forbiddenTransitions = [
    'archived' => ['active'], // –∏–∑ –∞—Ä—Ö–∏–≤–∞ –Ω–µ–ª—å–∑—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
];
```

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –±—ã—Å—Ç—Ä–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ù–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é (2 –º–∏–Ω)
```bash
grep -r "[—Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏]" app/Domain/*/Actions/
```

### 2. –ò–∑—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç (3 –º–∏–Ω)
- –ö–∞–∫–∏–µ —Å—Ç–∞—Ç—É—Å—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è?
- –ö–∞–∫–æ–π —Å—Ç–∞—Ç—É—Å —É –æ–±—ä–µ–∫—Ç–∞ —Å–µ–π—á–∞—Å?
- –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ —ç—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞?

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (2 –º–∏–Ω)
```sql
SELECT status, COUNT(*) FROM [table] GROUP BY status;
```

### 4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω (1 –º–∏–Ω)
- –£–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–±—ã—Ç—ã–π —Å—Ç–∞—Ç—É—Å
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã Enum

### 5. –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–ª–∞–¥–∫—É (1 –º–∏–Ω)
```php
Log::info('Status validation', [
    'current_status' => $model->status,
    'action' => 'archive',  
    'model_id' => $model->id
]);
```

**–ò—Ç–æ–≥–æ: 9 –º–∏–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º**

---

## üéØ –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ —Ç–∏–ø—É –æ—à–∏–±–∫–∏

| –û—à–∏–±–∫–∞ | –í–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ | –¢–∏–ø–∏—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ |
|--------|-------------------|------------------|
| "—Ç–µ–∫—É—â–µ–º —Å—Ç–∞—Ç—É—Å–µ" | –°–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–π whitelist | –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ blacklist |
| "Cannot transition" | –ó–∞–±—ã–ª–∏ –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å | –û–±–Ω–æ–≤–∏—Ç—å enum –º–µ—Ç–æ–¥—ã |
| "–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ" | –ñ–µ—Å—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ | –î–æ–±–∞–≤–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è |
| "already [action]" | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–µ–π | –î–æ–±–∞–≤–∏—Ç—å || $model->isAlready() |

---

## üöÄ –ü—Ä–∏–º–µ—Ä—ã —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

### –ö–µ–π—Å 1: –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ (—ç–∫–æ–Ω–æ–º–∏—è 2 —á–∞—Å–∞)
- **–ü—Ä–æ–±–ª–µ–º–∞:** `!in_array($status, ['active', 'draft'])`
- **–†–µ—à–µ–Ω–∏–µ:** `$status === 'archived'` (–∑–∞–ø—Ä–µ—Ç —Ç–æ–ª—å–∫–æ –¥—É–±–ª–µ–π)
- **–í—Ä–µ–º—è:** 30 –º–∏–Ω—É—Ç –≤–º–µ—Å—Ç–æ 2.5 —á–∞—Å–æ–≤

### –ö–µ–π—Å 2: –ü—É–±–ª–∏–∫–∞—Ü–∏—è (–±—É–¥—É—â–∏–π –∫–µ–π—Å)
- **–ü—Ä–æ–±–ª–µ–º–∞:** `$status !== 'draft'`  
- **–†–µ—à–µ–Ω–∏–µ:** `in_array($status, ['archived', 'blocked'])` (blacklist)
- **–í—Ä–µ–º—è:** 10 –º–∏–Ω—É—Ç

---

## üí° –ü—Ä–∏–Ω—Ü–∏–ø

> **"–°—Ç–∞—Ç—É—Å—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–∑—Ä–µ—à–∞—Ç—å –º–∞–∫—Å–∏–º—É–º –¥–µ–π—Å—Ç–≤–∏–π, –∑–∞–ø—Ä–µ—â–∞—è —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã."**

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –õ—É—á—à–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –ª–∏—à–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ, —á–µ–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –Ω—É–∂–Ω–æ–µ.