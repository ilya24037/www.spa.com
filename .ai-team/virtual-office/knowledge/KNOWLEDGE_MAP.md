# 🗺️ КАРТА ЗНАНИЙ ПРОЕКТА SPA PLATFORM
*Обновлено: 18.09.2025*

## 📊 Обзор проекта
- **Название:** SPA Platform - платформа услуг массажа
- **Технологии:** Laravel 12, Vue 3, Inertia.js, TypeScript, Tailwind CSS
- **Архитектура:** Domain-Driven Design (backend), Feature-Sliced Design (frontend)
- **Код:** 37,000+ строк
- **Документация:** 107+ файлов .md

---

## 🏗️ АРХИТЕКТУРА

### Backend (Laravel - DDD)
```
app/
├── Domain/           # Бизнес-логика по доменам
│   ├── User/        # Пользователи
│   ├── Master/      # Мастера
│   ├── Booking/     # Бронирование
│   ├── Ad/          # Объявления
│   └── Media/       # Медиафайлы
├── Application/     # HTTP слой
└── Infrastructure/  # Внешние сервисы
```

### Frontend (Vue 3 - FSD)
```
resources/js/src/
├── shared/      # Переиспользуемый код
├── entities/    # Бизнес-сущности
├── features/    # Функциональности
├── widgets/     # Композиционные блоки
└── pages/       # Страницы
```

---

## ⚡ БЫСТРЫЙ ДОСТУП К РЕШЕНИЯМ

### При ошибках типа "Невозможно выполнить действие"
```bash
# 1. Найти источник (30 сек)
grep -r "текст ошибки" app/Domain/*/Actions/

# 2. Изучить условия (2 мин)
# Найти все if/switch проверки

# 3. Минимальное изменение (5 мин)
# Убрать только проблемную проверку
```
📖 Детали: `docs/LESSONS/APPROACHES/BUSINESS_LOGIC_FIRST.md`

### При проблемах с сохранением данных Vue
**Проверить цепочку:**
1. v-model связан с reactive?
2. Есть watcher для автосохранения?
3. Emit отправляет правильный формат?
4. $fillable включает поле в модели?

📖 Детали: CLAUDE.md → "Проверка цепочки данных"

### Универсальные команды поиска
```bash
# Найти Action/Service
grep -r "ClassName" app/Domain/

# Найти Vue компонент
find resources/js/src/ -name "*Component*.vue"

# Проверить поддержку поля моделью
grep -r "\$fillable" app/Domain/*/Models/ | grep "field"

# Методы репозитория
grep -n "public function" app/Domain/*/Repositories/
```

---

## 🎯 КЛЮЧЕВЫЕ ПРИНЦИПЫ

### 1. KISS (Keep It Simple)
- Всегда начинай с простейшего решения
- "Отдельная секция" = визуальное разделение, не архитектурное
- Лучше переиспользовать существующее, чем создавать новое

### 2. Бизнес-логика сначала
- При ошибках API сначала проверяй backend (Actions/Services)
- НЕ начинай с изменения frontend
- Ищи конкретное место в коде по тексту ошибки

### 3. Минимальные изменения
- Точечные исправления вместо переписывания
- Убирать только проблемные проверки
- Сохранять обратную совместимость

---

## 🚫 АНТИ-ПАТТЕРНЫ (чего НЕ делать)

### ❌ Frontend-first debugging
**Неправильно:** Менять API endpoints, создавать новые маршруты при ошибке
**Правильно:** grep по тексту ошибки → найти Action → минимальное изменение

### ❌ Overengineering
**Неправильно:** Создавать сложные абстракции для простых задач
**Правильно:** KISS - самое простое работающее решение

### ❌ Игнорирование watchers
**Неправильно:** Добавить reactive поле без watcher
**Правильно:** Каждое reactive поле должно иметь watcher для автосохранения

---

## 📋 ЧЕК-ЛИСТЫ

### Новый Vue компонент
- [ ] TypeScript типизация всех props
- [ ] Default значения для опциональных props
- [ ] Обработка состояний: loading, error, empty
- [ ] Skeleton loader для загрузки
- [ ] Защита через computed от undefined/null
- [ ] Мобильная адаптивность (sm:, md:, lg:)
- [ ] Watcher для автосохранения данных

### Новая функциональность
- [ ] Поиск существующих аналогов
- [ ] Использование shared компонентов
- [ ] Следование FSD/DDD архитектуре
- [ ] Минимальное решение (KISS)
- [ ] Тестирование каждого шага
- [ ] Документирование если нестандартно

### Исправление бага
- [ ] НЕ начинать с frontend
- [ ] Найти источник через grep
- [ ] Изучить всю логику метода
- [ ] Минимальное изменение
- [ ] Проверить в браузере
- [ ] Записать опыт в LESSONS/

---

## 🔧 СТАНДАРТНЫЕ ПАТТЕРНЫ

### Laravel контроллер
```php
// Только HTTP логика, вся бизнес-логика в сервисе
public function store(StoreRequest $request) {
    $dto = CreateDTO::fromRequest($request);
    $result = $this->service->create($dto);
    return new ResourceClass($result);
}
```

### Vue компонент с защитой
```typescript
// Защищенные computed свойства
const safeData = computed(() => props.data || defaultData)

// Обработка всех состояний
const isLoading = ref(false)
const error = ref<string | null>(null)
const isEmpty = computed(() => !data.value?.length)

// Watcher для автосохранения
watch(() => formData.field, () => {
  emitSaveData()
}, { deep: true })
```

### Валидация статусов
```php
// ❌ Whitelist (слишком строго)
if (!in_array($status, ['active', 'draft'])) { }

// ✅ Blacklist (гибко)
if ($status === 'archived') { } // только конфликты
```

---

## 📚 СТРУКТУРА ДОКУМЕНТАЦИИ

### Критически важные файлы
1. **CLAUDE.md** - главные инструкции и уроки
2. **docs/LESSONS/QUICK_REFERENCE.md** - быстрая справка
3. **docs/LESSONS/APPROACHES/BUSINESS_LOGIC_FIRST.md** - главный подход
4. **docs/LESSONS/ANTI_PATTERNS/** - типичные ошибки
5. **docs/LESSONS/WORKFLOWS/NEW_TASK_WORKFLOW.md** - как начать задачу

### По типу задачи
- **Баги:** ANTI_PATTERNS/ → QUICK_WINS/
- **Бизнес-логика:** APPROACHES/BUSINESS_LOGIC_FIRST.md
- **Новые фичи:** WORKFLOWS/ → существующие примеры
- **Рефакторинг:** REFACTORING/УРОК_LESSONS_LEARNED.md

---

## 📊 МЕТРИКИ УСПЕХА

### При правильном применении:
- ⏱️ **Время:** решение в 2-5 раз быстрее
- 🎯 **Качество:** минимальные стабильные изменения
- 🚀 **Скорость:** типичные баги за 5-30 минут
- 📈 **Рост:** каждая задача проще предыдущей

### Индикаторы правильной работы:
- Нашел проблему через grep за минуту ✅
- Изменил 1-5 строк кода ✅
- Не трогал frontend при backend ошибке ✅
- Использовал существующий паттерн ✅

---

## 💡 ЗОЛОТЫЕ ПРАВИЛА

1. **"Любая бизнес-ошибка имеет конкретное место в коде"**
2. **"Не начинай с frontend при ошибке API"**
3. **"KISS - самое простое решение сначала"**
4. **"Ищи аналоги перед созданием нового"**
5. **"Каждая ошибка = новый урок в LESSONS/"**

---

## 🚀 КОМАНДА БЫСТРОГО СТАРТА

```bash
# При любой новой задаче:
1. grep -r "похожий функционал" app/ resources/js/
2. Читай docs/LESSONS/QUICK_REFERENCE.md
3. Применяй подходящий алгоритм
4. Записывай новый опыт
```

---

## 📈 ЭВОЛЮЦИЯ ЗНАНИЙ

### Текущий уровень зрелости:
- ✅ 107+ документов с опытом
- ✅ Четкая архитектура (DDD + FSD)
- ✅ Отработанные паттерны решений
- ✅ Система извлечения уроков

### Области роста:
- ⚠️ Автоматизация тестирования
- ⚠️ CI/CD процессы
- ⚠️ Мониторинг production

---

*Используй эту карту как навигатор по проекту. Обновляй после каждого нового опыта.*
