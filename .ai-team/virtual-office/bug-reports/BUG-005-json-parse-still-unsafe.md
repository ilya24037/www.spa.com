# üêõ BUG-005: JSON.parse –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º –≤ AdForm

## üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–≥–µ
- **ID:** BUG-005
- **–î–∞—Ç–∞:** 2025-09-17
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô**
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** AdForm.vue
- **–°—Ç—Ä–æ–∫–∞:** 805
- **–°—Ç–∞—Ç—É—Å:** OPEN
- **–í–µ—Ä—Å–∏—è:** Current (17.09.2025)

## üîç –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

JSON.parse –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–µ–∑ try-catch –±–ª–æ–∫–∞, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∫—Ä–∞—Ö—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ø–æ–ª–µ geo.

## üìç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –∫–æ–¥–µ

**–§–∞–π–ª:** `resources/js/src/features/ad-creation/ui/AdForm.vue`
**–°—Ç—Ä–æ–∫–∞:** 805

```typescript
// –¢–ï–ö–£–©–ò–ô –ù–ï–ë–ï–ó–û–ü–ê–°–ù–´–ô –ö–û–î:
const geoData = typeof form.geo === 'string' ? JSON.parse(form.geo || '{}') : form.geo
```

## üéØ –®–∞–≥–∏ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

1. –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è
2. –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ –ø–æ–ª–µ `form.geo` –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON, –Ω–∞–ø—Ä–∏–º–µ—Ä: `"invalid{json"`
3. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ—Ä–º—É
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫—Ä–∞—à–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π `Uncaught SyntaxError: Unexpected token`

## üí• –í–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

1. **–ö—Ä–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. **–ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ñ–æ—Ä–º—ã
3. **–ü–ª–æ—Ö–æ–π UX** - –±–µ–ª—ã–π —ç–∫—Ä–∞–Ω —Å–º–µ—Ä—Ç–∏
4. **–£—è–∑–≤–∏–º–æ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å DoS –∞—Ç–∞–∫–∏

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ

```typescript
// –ë–ï–ó–û–ü–ê–°–ù–´–ô –ö–û–î –° –û–ë–†–ê–ë–û–¢–ö–û–ô –û–®–ò–ë–û–ö:
const parseGeoData = (geoString: string | object): object => {
  if (typeof geoString !== 'string') {
    return geoString || {}
  }

  try {
    return JSON.parse(geoString || '{}')
  } catch (error) {
    console.warn('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ geo –¥–∞–Ω–Ω—ã—Ö:', error)
    // –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –ø–æ–∫–∞–∑–∞—Ç—å toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    return {}
  }
}

const geoData = parseGeoData(form.geo)
```

## üß™ –¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã

### Test Case 1: –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON
```javascript
Input: '{"city": "Moscow", "district": "Center"}'
Expected: { city: "Moscow", district: "Center" }
```

### Test Case 2: –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
```javascript
Input: ''
Expected: {}
```

### Test Case 3: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON
```javascript
Input: 'invalid{json'
Expected: {} (–±–µ–∑ –∫—Ä–∞—à–∞)
```

### Test Case 4: null/undefined
```javascript
Input: null
Expected: {}
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏

- **–ß–∞—Å—Ç–æ—Ç–∞ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è:** –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –≤—ã—Å–æ–∫–∞—è (–ø—Ä–∏ –ª—é–±–æ–º —Å–±–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è geo –¥–∞–Ω–Ω—ã—Ö)
- **–í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ (–ø–æ–ª–Ω–∞—è –ø–æ—Ç–µ—Ä—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)
- **–°–ª–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** –ù–∏–∑–∫–∞—è (5 –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç—ã)

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –±–∞–≥–∏

- BUG-002: –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ—Ä—Ç –æ JSON.parse –ø—Ä–æ–±–ª–µ–º–µ
- BUG-001: TypeScript any types –≤ —Ç–æ–º –∂–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

–≠—Ç–æ—Ç –±–∞–≥ –±—ã–ª –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω –≤ BUG-002, –Ω–æ –Ω–µ –±—ã–ª –∏—Å–ø—Ä–∞–≤–ª–µ–Ω. –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º –≤ production.

## üè∑Ô∏è –¢–µ–≥–∏
`critical`, `crash`, `json`, `error-handling`, `production-blocker`