# üìä –û–¢–ß–ï–¢ –û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ò: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å JSON.parse –≤ AdForm

## ‚úÖ –°–¢–ê–¢–£–°: –¢–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã

### –î–∞—Ç–∞: 17.09.2025
### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç: AdForm.vue
### –ü—Ä–æ–±–ª–µ–º–∞: BUG-005 - –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ JSON –≤ –ø–æ–ª–µ geo

---

## üìã –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –¢–ï–°–¢–´

### 1. **PHPUnit —Ç–µ—Å—Ç—ã** (Backend)
**–§–∞–π–ª:** `tests/Unit/AdFormJsonParseTest.php`
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ 5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω—ã

#### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ JSON (invalid{json})
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∞–ª–∏–¥–Ω–æ–≥–æ JSON
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ null –∑–Ω–∞—á–µ–Ω–∏–π
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç XSS –≤ JSON

### 2. **Vitest E2E —Ç–µ—Å—Ç—ã** (Frontend)
**–§–∞–π–ª:** `tests/e2e/AdFormJsonParseSimple.spec.ts`
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ 7 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω—ã

#### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:
- ‚úÖ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –∫—Ä–∞—à
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –≤–∞–ª–∏–¥–Ω–æ–≥–æ JSON
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (null, undefined, '')
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–∂–µ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- ‚úÖ –ì–ª—É–±–æ–∫–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–π –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON
- ‚úÖ XSS –∑–∞—â–∏—Ç–∞ (–Ω–∞ —É—Ä–æ–≤–Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–∞–Ω–Ω—ã–º–∏ —Ñ–æ—Ä–º—ã

---

## üõ°Ô∏è –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–ê–Ø –ó–ê–©–ò–¢–ê

### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –≤ AdForm.vue (—Å—Ç—Ä–æ–∫–∏ 806-813):
```typescript
if (typeof form.geo === 'string') {
  try {
    geoData = JSON.parse(form.geo || '{}')
  } catch (error) {
    console.warn('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ geo –¥–∞–Ω–Ω—ã—Ö:', error)
    geoData = {}
  }
}
```

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –∑–∞—â–∏—Ç—ã:
1. **Try-catch –±–ª–æ–∫** - –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
2. **Fallback –Ω–∞ –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç** - –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `{}`
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π** - –æ—à–∏–±–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞** - –ø–∞—Ä—Å–∏–Ω–≥ —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
5. **XSS –∑–∞—â–∏—Ç–∞** - —á–µ—Ä–µ–∑ Vue templates –∏ Laravel blade escaping

---

## üìà –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

| –°—Ü–µ–Ω–∞—Ä–∏–π | Backend | Frontend | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|---------|----------|-----------|
| –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON | ‚úÖ | ‚úÖ | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç |
| –í–∞–ª–∏–¥–Ω—ã–π JSON | ‚úÖ | ‚úÖ | –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ |
| –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ | ‚úÖ | ‚úÖ | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{}` |
| null/undefined | ‚úÖ | ‚úÖ | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{}` |
| XSS –≤ JSON | ‚úÖ | ‚úÖ | –ó–∞—â–∏—Ç–∞ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ |
| –í–ª–æ–∂–µ–Ω–Ω—ã–π broken JSON | - | ‚úÖ | –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –±–µ–∑ –∫—Ä–∞—à–∞ |

---

## üöÄ –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ó–ê–ü–£–°–ö–ê –¢–ï–°–¢–û–í

### Backend —Ç–µ—Å—Ç—ã (PHPUnit):
```bash
php artisan test --filter AdFormJsonParseTest
```

### Frontend —Ç–µ—Å—Ç—ã (Vitest):
```bash
npm run test -- AdFormJsonParseSimple.spec.ts
```

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:
```bash
# Backend
php artisan test

# Frontend
npm run test
```

---

## üìù –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. **–¢–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥—è—Ç** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞—â–∏—â–µ–Ω –æ—Ç –æ—à–∏–±–æ–∫ JSON.parse
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** - –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏
3. **XSS –∑–∞—â–∏—Ç–∞** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —à–∞–±–ª–æ–Ω–æ–≤ Vue –∏ Laravel

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
- –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤ production (Sentry/LogRocket)
- –°–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã geo –æ–±—ä–µ–∫—Ç–∞
- –î–æ–±–∞–≤–∏—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è –¥—Ä—É–≥–∏—Ö JSON –ø–æ–ª–µ–π –≤ —Ñ–æ—Ä–º–µ

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**BUG-005 –ò–°–ü–†–ê–í–õ–ï–ù –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù**

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç AdForm.vue —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª—é–±—ã–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ JSON –¥–∞–Ω–Ω—ã–µ –≤ –ø–æ–ª–µ geo, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è –∫—Ä–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –í—Å–µ —Ç–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã –∫–∞–∫ –Ω–∞ backend (PHP), —Ç–∞–∫ –∏ –Ω–∞ frontend (Vue.js).

---

*–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω: AI QA Agent*
*–í–µ—Ä—Å–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: AdForm.vue v2.0 (—Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º JSON –ø–∞—Ä—Å–∏–Ω–≥–æ–º)*