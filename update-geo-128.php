<?php

require_once __DIR__ . '/vendor/autoload.php';

$app = require_once __DIR__ . '/bootstrap/app.php';
$app->make('Illuminate\Contracts\Console\Kernel')->bootstrap();

echo "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–µ–æ–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è ID 128...\n";

// –ù–∞–π–¥–µ–º –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
$ad = \App\Domain\Ad\Models\Ad::find(128);

if (!$ad) {
    echo "‚ùå –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å ID 128 –Ω–µ –Ω–∞–π–¥–µ–Ω–æ\n";
    exit(1);
}

echo "üìã –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è:\n";
echo "ID: {$ad->id}\n";
echo "–ê–¥—Ä–µ—Å: {$ad->address}\n";
echo "–°—Ç–∞—Ç—É—Å: {$ad->status->value}\n";
echo "–ì–µ–æ–¥–∞–Ω–Ω—ã–µ: " . ($ad->geo ?: '–ù–ï –£–ö–ê–ó–ê–ù–´') . "\n";

// –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è —É–ª. –ê–¥–º–∏—Ä–∞–ª–∞ –£—à–∞–∫–æ–≤–∞, 10, –ü–µ—Ä–º—å
// –ü—Ä–∏–º–µ—Ä–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (–Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å —Ç–æ—á–Ω—ã–µ)
$coordinates = [
    'lat' => 58.0174,  // –®–∏—Ä–æ—Ç–∞ –¥–ª—è –ü–µ—Ä–º–∏, —É–ª. –ê–¥–º–∏—Ä–∞–ª–∞ –£—à–∞–∫–æ–≤–∞
    'lng' => 56.2346   // –î–æ–ª–≥–æ—Ç–∞ –¥–ª—è –ü–µ—Ä–º–∏, —É–ª. –ê–¥–º–∏—Ä–∞–ª–∞ –£—à–∞–∫–æ–≤–∞
];

$geoData = json_encode($coordinates);

try {
    $ad->update([
        'geo' => $geoData
    ]);
    
    echo "\n‚úÖ –ì–µ–æ–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!\n";
    echo "–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: lat={$coordinates['lat']}, lng={$coordinates['lng']}\n";
    echo "JSON geo: {$geoData}\n";
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å
    $ad->refresh();
    echo "\n–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:\n";
    echo "–ù–æ–≤—ã–µ geo –¥–∞–Ω–Ω—ã–µ –≤ –ë–î: {$ad->geo}\n";
    
    echo "\nüó∫Ô∏è –û–±—ä—è–≤–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É: {$ad->address}\n";
    echo "üåê URL –æ–±—ä—è–≤–ª–µ–Ω–∏—è: http://spa.test/ads/{$ad->id}\n";
    
} catch (\Exception $e) {
    echo "\n‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö:\n";
    echo $e->getMessage() . "\n";
    exit(1);
}

echo "\nüí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–µ. –î–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω—É–∂–Ω–∞ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ API –∫–∞—Ä—Ç.\n";
echo "\nüéâ –ì–æ—Ç–æ–≤–æ! –ú–∞—Ä–∫–µ—Ä –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ.\n";