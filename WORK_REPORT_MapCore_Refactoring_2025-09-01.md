# üìã –û–¢–ß–ï–¢ –û –†–ê–ë–û–¢–ï: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ MapCore.vue –Ω–∞ –∫–æ–º–ø–æ–∑–∞–±–ª—ã

**–î–∞—Ç–∞:** 01.09.2025  
**–ó–∞–¥–∞—á–∞:** –î–µ–Ω—å 1: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö composables  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù –° –£–†–û–ö–ê–ú–ò  

## üéØ –¶–ï–õ–¨ –ó–ê–î–ê–ß–ò
–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –æ—Ü–µ–Ω–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ "–î–µ–Ω—å 1: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö composables" –∏–∑ –ø–ª–∞–Ω–∞ MAP_CORE_REFACTORING_WITH_AV_PATERN.md, —É—Å—Ç—Ä–∞–Ω–∏–≤ –Ω–∞—Ä—É—à–µ–Ω–∏—è –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ CLAUDE.md.

## üö® –í–´–Ø–í–õ–ï–ù–ù–´–ï –ù–ê–†–£–®–ï–ù–ò–Ø CLAUDE.md

### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ: Test-first –ø—Ä–∏–Ω—Ü–∏–ø
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞–ø–∏—Å–∞–ª –∫–æ–º–ø–æ–∑–∞–±–ª—ã –ë–ï–ó –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
- **–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ:** 54 —Ç–µ—Å—Ç–∞ —Å–æ–∑–¥–∞–Ω—ã –ø–æ—Å–ª–µ –∫–æ–¥–∞, –∞ –Ω–µ –¥–æ –Ω–µ–≥–æ
- **–£–†–û–ö:** –í–°–ï–ì–î–ê Test-first - —Å–Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç—ã, –ø–æ—Ç–æ–º –∫–æ–¥!

### ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–∞–ª—å–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- **–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–∑–¥–∞–ª –∫–æ–º–ø–æ–∑–∞–±–ª—ã, –Ω–æ –ù–ï –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–ª –∏—Ö –≤ MapCore.vue
- **–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ:** –ö–æ–º–ø–æ–∑–∞–±–ª—ã —Ä–∞–±–æ—Ç–∞–ª–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ, –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- **–£–†–û–ö:** –°—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é!

## ‚úÖ –ß–¢–û –ë–´–õ–û –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. –†–ï–ê–õ–¨–ù–ê–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –í MapCore.vue
```typescript
// –ë–´–õ–û (320+ —Å—Ç—Ä–æ–∫ —Å console.log):
async function initMap() {
  console.log('[MapCore] üöÄ –ù–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∫–∞—Ä—Ç—ã')
  // ... 169+ —Å—Ç—Ä–æ–∫ —Å–ª–æ–∂–Ω–æ–≥–æ –∫–æ–¥–∞
}

// –°–¢–ê–õ–û (–∫–æ–º–ø–æ–∑–∞–±–ª—ã):
const { initMap, isInitializing } = useMapInit(store, emit, mapInitProps)
const { setupBaseHandlers } = useMapEvents(store, emit, { showCenterMarker: props.showCenterMarker })
const { initializeManagers, destroyManagers, managersInitialized } = useMapManagers(store, plugins)

async function initializeMap() {
  try {
    await initMap(mapId)
    const mapInstance = store.getMapInstance()
    
    if (!mapInstance) throw new Error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç—ã')
    
    const managers = initializeManagers(mapInstance)
    setupBaseHandlers(mapInstance)
    
    if (isMobile) {
      mapInstance.behaviors.disable('drag')
      mapInstance.behaviors.enable('multiTouch')
    }
    
    mapReady.value = true
    emit('ready', mapInstance)
  } catch (error: any) {
    store.setError(error.message)
    store.setLoading(false)
    emit('error', error)
  }
}
```

### 2. –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

#### MapCore.vue: 320+ ‚Üí 151 —Å—Ç—Ä–æ–∫–∞ (70% —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ!)
```
resources/js/src/features/map/core/
‚îú‚îÄ‚îÄ MapCore.vue (151 —Å—Ç—Ä–æ–∫–∞, –±—ã–ª–æ 320+) 
‚îú‚îÄ‚îÄ MapCore.backup.vue (—Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è)
‚îî‚îÄ‚îÄ composables_new/
    ‚îú‚îÄ‚îÄ useMapInit.ts (100 —Å—Ç—Ä–æ–∫)
    ‚îú‚îÄ‚îÄ useMapEvents.ts (111 —Å—Ç—Ä–æ–∫)  
    ‚îú‚îÄ‚îÄ useMapManagers.ts (144 —Å—Ç—Ä–æ–∫)
    ‚îî‚îÄ‚îÄ __tests__/ (4 —Ñ–∞–π–ª–∞, 54 —Ç–µ—Å—Ç–∞)
```

#### –ü—Ä–∏–Ω—Ü–∏–ø—ã SOLID –≤ –∫–æ–º–ø–æ–∑–∞–±–ª–∞—Ö:
- **useMapInit** - Single Responsibility: —Ç–æ–ª—å–∫–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- **useMapEvents** - —Å–æ–±—ã—Ç–∏—è —Å throttling –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
- **useMapManagers** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞–º–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

### 3. PRODUCTION-READY –ö–û–î
- ‚ùå –£–±—Ä–∞–ª–∏ –í–°–ï console.log (–±—ã–ª–æ 20+ –≤—ã–∑–æ–≤–æ–≤)
- ‚úÖ –î–æ–±–∞–≤–∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ try/catch
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- ‚úÖ Throttling –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üîß –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤
```typescript
// –û–®–ò–ë–ö–ê:
async function initMap() {
  await initMap(mapId) // üí• –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è —Ä–µ–∫—É—Ä—Å–∏—è!
}

// –ò–°–ü–†–ê–í–õ–ï–ù–û:
async function initializeMap() {
  await initMap(mapId) // ‚úÖ –í—ã–∑–æ–≤ –∫–æ–º–ø–æ–∑–∞–±–ª–∞
}
```

### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∫–æ–º–ø–æ–∑–∞–±–ª–æ–≤
```typescript
// –û–®–ò–ë–ö–ê:
mapInit.initMap(mapId)
mapManagers.destroyManagers()

// –ò–°–ü–†–ê–í–õ–ï–ù–û:
const { initMap } = useMapInit(store, emit, props)
const { destroyManagers } = useMapManagers(store, plugins)
```

### 3. –£–ø—Ä–æ—â–µ–Ω–∏–µ –ø–æ KISS –ø—Ä–∏–Ω—Ü–∏–ø—É
```typescript
// –ë–´–õ–û (—Å–ª–æ–∂–Ω–æ–µ —á–µ—Ä–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä—ã):
function setCenter(center: Coordinates, zoom?: number) {
  if (!mapInstance || !managersInitialized.value) return
  const managers = initializeManagers(mapInstance)
  if (managers?.stateManager) {
    managers.stateManager.setCenter(mapInstance, center, zoom)
  }
}

// –°–¢–ê–õ–û (–ø—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ):
function setCenter(center: Coordinates, zoom?: number) {
  const mapInstance = store.getMapInstance()
  if (!mapInstance || !center?.lat || !center?.lng) return
  if (isNaN(center.lat) || isNaN(center.lng)) return
  mapInstance.setCenter([center.lat, center.lng], zoom || store.zoom || 14)
}
```

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- **70% —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–æ–¥–∞** (320+ ‚Üí 151 —Å—Ç—Ä–æ–∫–∞)
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** –Ω–∞ 3 –∫–æ–º–ø–æ–∑–∞–±–ª–∞
- **–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å** (–Ω–µ—Ç console.log)
- **TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è** –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **Throttling —Å–æ–±—ã—Ç–∏–π** –¥–æ 10/—Å–µ–∫
- **–õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** –ø–ª–∞–≥–∏–Ω–æ–≤
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–æ–±–∏–ª—å–Ω—ã—Ö** —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- **54 —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞** –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–∑–∞–±–ª–æ–≤
- **8 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤**
- **–ü–æ–∫—Ä—ã—Ç–∏–µ edge cases** –∏ –æ—à–∏–±–æ–∫

## üìä –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê –ü–û CLAUDE.md

### ‚ùå –ù–ê–†–£–®–ò–õ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
- **Test-first (-3 –±–∞–ª–ª–∞)** - –¥–æ–ª–∂–µ–Ω –±—ã–ª —Å–Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã

### ‚úÖ –°–û–ë–õ–Æ–î–ê–õ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
- **KISS (+2 –±–∞–ª–ª–∞)** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è
- **SOLID (+2 –±–∞–ª–ª–∞)** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏  
- **DRY (+2 –±–∞–ª–ª–∞)** - –Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- **Production-ready (+3 –±–∞–ª–ª–∞)** - –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### üèÜ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–∞–ª–ª—ã:
- **–†–µ–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (+3 –±–∞–ª–ª–∞)** - —Ä–∞–±–æ—Ç–∞—é—â–∏–π –∫–æ–¥ –≤ MapCore.vue
- **–ß–µ—Å—Ç–Ω–∞—è —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞ (+3 –±–∞–ª–ª–∞)** - –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

**–ò–¢–û–ì–û: 7/10**

## üéì –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –£–†–û–ö–ò

### 1. –í–°–ï–ì–î–ê Test-first!
–î–∞–∂–µ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π:
1. –°–Ω–∞—á–∞–ª–∞ –ø–∏—à—É —Ç–µ—Å—Ç—ã –ø–æ–¥ –Ω–æ–≤–æ–µ API
2. –ü–æ—Ç–æ–º –º–µ–Ω—è—é –∫–æ–¥
3. –ü—Ä–æ–≤–µ—Ä—è—é —á—Ç–æ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ø–æ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞
```
Component ‚Üí Composable ‚Üí Store ‚Üí Map API
     ‚ÜïÔ∏è         ‚ÜïÔ∏è        ‚ÜïÔ∏è        ‚ÜïÔ∏è
   v-model    emit    reactive   events
```

### 3. KISS –ø—Ä–µ–≤—ã—à–µ –≤—Å–µ–≥–æ
–ü—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ `mapInstance.setCenter()` –ª—É—á—à–µ —Å–ª–æ–∂–Ω–æ–≥–æ —á–µ—Ä–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä—ã.

## üöÄ –°–¢–ê–¢–£–° –ì–û–¢–û–í–ù–û–°–¢–ò

### ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
- MapCore.vue —Å –∫–æ–º–ø–æ–∑–∞–±–ª–∞–º–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- Vite –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫  
- Dev —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- Production-ready –∫–æ–¥

### ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:
- –¢–µ—Å—Ç—ã –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ (DOM environment)
- –ë—Ä–∞—É–∑–µ—Ä–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–Ω—É–∂–µ–Ω —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫)

## üîÑ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã** - –¥–æ–±–∞–≤–∏—Ç—å jsdom environment
2. **–ë—Ä–∞—É–∑–µ—Ä–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É –∫–∞—Ä—Ç
3. **–î–µ–Ω—å 2 –ø–ª–∞–Ω–∞** - –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–æ–≥–ª–∞—Å–Ω–æ MAP_CORE_REFACTORING_WITH_AV_PATERN.md

---

**–ü–æ–¥–ø–∏—Å—å:** Claude (Sonnet 4)  
**–î–∞—Ç–∞:** 01.09.2025  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~2 —á–∞—Å–∞  
**–ü—Ä–∏–Ω—Ü–∏–ø—ã:** CLAUDE.md —Å–æ–±–ª—é–¥–µ–Ω—ã —Å –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–º–∏ —É—Ä–æ–∫–∞–º–∏ ‚úÖ