–ß–¢–û –î–ï–õ–ê–ï–ú:–ü—Ä–æ–µ–∫—Ç–∏—Ä—É–µ–º –∏ –≤–Ω–µ–¥—Ä—è–µ–º —É–¥–æ–±–Ω—É—é –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ –¥–ª—è —Ñ–æ—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π, —á—Ç–æ–±—ã —É–¥–æ–±–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å/–≤—ã–¥–∞–≤–∞—Ç—å –º–µ–¥–∏–∞, –Ω–µ —É–ø–∏—Ä–∞—Ç—å—Å—è –≤ –ª–∏–º–∏—Ç—ã –§–° –∏ –ª–µ–≥–∫–æ –ø–µ—Ä–µ–µ–∑–∂–∞—Ç—å –Ω–∞ S3/CDN.üéØ –ü–õ–ê–ù:1) –í—ã–±—Ä–∞—Ç—å —Å—Ö–µ–º—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π2) –î–æ–±–∞–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—É—Ç–∏ (–Ω–µ –ª–æ–º–∞—è —Ç–µ–∫—É—â–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)3) –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ –¥–∏—Å–∫–∏ Laravel (storage/app/public) –∏ —Ä–∞–∑–¥–∞–≤–∞—Ç—å —á–µ—Ä–µ–∑ /storage4) –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)5) –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –≤—ã–¥–∞—á–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
1) –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ö–µ–º–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
–ß—Ç–æ–±—ã:
‚Ä¢	–Ω–µ –±—ã–ª–æ –¥–µ—Å—è—Ç–∫–æ–≤ —Ç—ã—Å—è—á —Ñ–∞–π–ª–æ–≤ –≤ –æ–¥–Ω–æ–π –ø–∞–ø–∫–µ,
‚Ä¢	–º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã—Å—Ç—Ä–æ —á–∏—Å—Ç–∏—Ç—å –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é/–æ–±—ä—è–≤–ª–µ–Ω–∏—é,
‚Ä¢	–ª–µ–≥–∫–æ —É–µ—Ö–∞—Ç—å –Ω–∞ S3,
–ø—Ä–µ–¥–ª–∞–≥–∞—é —Ç–∞–∫—É—é –∏–µ—Ä–∞—Ä—Ö–∏—é:
‚Ä¢	–ë–∞–∑–æ–≤—ã–π –ø—É—Ç—å: public –¥–∏—Å–∫ (—Å–∏–º–ª–∏–Ω–∫ –Ω–∞ /public/storage)
‚Ä¢	–ü–∞—Ç—Ç–µ—Ä–Ω: users/{userIdShard}/ads/{adIdShard}/{YYYY}/{MM}/{uuid}.{ext}
–ì–¥–µ:
‚Ä¢	{userIdShard} –∏ {adIdShard} ‚Äî —à–∞—Ä–¥–∏–Ω–≥ –ø–æ ID, —á—Ç–æ–±—ã –Ω–µ —Å–∫–∞–ø–ª–∏–≤–∞—Ç—å –≤—Å—ë –≤ –æ–¥–Ω–æ–π –ø–∞–ø–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 000/123/456 –¥–ª—è id=123456).
‚Ä¢	{YYYY}/{MM} ‚Äî —Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º.
‚Ä¢	{uuid}.{ext} ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞.
–ü—Ä–∏–º–µ—Ä:
‚Ä¢	–û—Ä–∏–≥–∏–Ω–∞–ª: storage/app/public/users/000/001/234/ads/000/045/678/2025/08/4faa9b92-7f90-4d44-9a6b-1d6b3e8d7c6d.jpg
‚Ä¢	–ü—Ä–µ–≤—å—é (–µ—Å–ª–∏ –¥–µ–ª–∞–µ–º –≤–µ—Ä—Å–∏–∏): .../thumbs/4faa9b92-..._400x400.jpg
–ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ —à–∞—Ä–¥–∏–Ω–≥ ‚Äî –º–æ–∂–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å:
‚Ä¢	users/{userId}/ads/{adId}/{YYYY}/{MM}/{uuid}.{ext}
–ù–æ —è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é —à–∞—Ä–¥–∏–Ω–≥ –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–æ—Å—Ç–∞.
2) –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—É—Ç–µ–π (—É–¥–æ–±–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ)
–°–æ–∑–¥–∞–¥–∏–º —É—Ç–∏–ª–∏—Ç—É, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ AdMediaService), –Ω–µ —Ç—Ä–æ–≥–∞—è —Ç–µ–∫—É—â—É—é –ª–æ–≥–∏–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.üíª –ö–û–î:–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª app/Infrastructure/Media/PathGenerator.php:
php
Apply
 
<?php
namespace App\Infrastructure\Media;
use Illuminate\Support\Str;
use Carbon\Carbon;
class PathGenerator
{
    // –†–∞–∑–±–∏–≤–∞–µ–º —á–∏—Å–ª–æ –ø–æ 3 —Å–∏–º–≤–æ–ª–∞: 123456 -> 000/123/456
    protected static function shard(int $id): string
    {
        $padded = str_pad((string) $id, 9, '0', STR_PAD_LEFT);
        return implode('/', str_split($padded, 3));
    }
    public static function adPhotoPath(int $userId, int $adId, string $extension = 'jpg', ?Carbon $date = null): string
    {
        $date = $date ?: Carbon::now();
        $userShard = self::shard($userId);
        $adShard = self::shard($adId);
        $uuid = (string) Str::uuid();
        return sprintf(
            'users/%s/ads/%s/%s/%s/%s.%s',
            $userShard,           // users/000/001/234
            $adShard,             // ads/000/045/678
            $date->format('Y'),   // 2025
            $date->format('m'),   // 08
            $uuid,                // 4faa9b92-...
            ltrim($extension, '.') // jpg
        );
    }
    public static function adThumbPath(int $userId, int $adId, string $suffix, string $extension = 'jpg', ?Carbon $date = null): string
    {
        $date = $date ?: Carbon::now();
        $userShard = self::shard($userId);
        $adShard = self::shard($adId);
        $uuid = (string) Str::uuid();
        return sprintf(
            'users/%s/ads/%s/%s/%s/thumbs/%s_%s.%s',
            $userShard,
            $adShard,
            $date->format('Y'),
            $date->format('m'),
            $uuid,
            $suffix, // –Ω–∞–ø—Ä–∏–º–µ—Ä 400x400
            ltrim($extension, '.')
        );
    }
}
3) –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ Laravel Filesystem
–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ª—é–±–æ–º —Å–µ—Ä–≤–∏—Å–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ AdMediaService):
php
Apply
 
use Illuminate\Http\UploadedFile;
use Illuminate\Support\Facades\Storage;
use App\Infrastructure\Media\PathGenerator;
public function storeAdPhoto(UploadedFile $file, int $userId, int $adId): string
{
    $ext = $file->getClientOriginalExtension() ?: 'jpg';
    $path = PathGenerator::adPhotoPath($userId, $adId, $ext);
    // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ –¥–∏—Å–∫ public
    Storage::disk('public')->put($path, file_get_contents($file->getRealPath()));
    // –≤–µ—Ä–Ω—ë–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å (–¥–ª—è –±–∞–∑—ã) –∏–ª–∏ URL
    return $path; // –Ω–∞–ø—Ä–∏–º–µ—Ä: users/.../2025/08/uuid.jpg
}
–í—ã–¥–∞—á–∞ –≤ —à–∞–±–ª–æ–Ω–µ/—Ñ—Ä–æ–Ω—Ç–µ:
‚Ä¢	URL: /storage/{path} ‚Üí asset('storage/'.$path)
4) –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)
–ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –º–µ–¥–∏–∞–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π ‚Äî –¥–æ–±–∞–≤—å—Ç–µ:
php
Apply
 
// database/migrations/xxxx_xx_xx_xxxxxx_create_ad_media_table.php
Schema::create('ad_media', function (Blueprint $table) {
    $table->id();
    $table->unsignedBigInteger('ad_id')->index();
    $table->unsignedBigInteger('user_id')->index();
    $table->string('disk', 50)->default('public');
    $table->string('path', 512);     // users/.../uuid.jpg
    $table->string('mime', 100)->nullable();
    $table->unsignedInteger('size')->nullable();
    $table->unsignedInteger('width')->nullable();
    $table->unsignedInteger('height')->nullable();
    $table->boolean('is_main')->default(false);
    $table->unsignedInteger('order')->default(0);
    $table->timestamps();
    $table->foreign('ad_id')->references('id')->on('ads')->cascadeOnDelete();
});
–ü–ª—é—Å—ã:
‚Ä¢	–º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ —Å–º–µ–Ω–∏—Ç—å –¥–∏—Å–∫ –Ω–∞ s3 (–ø–æ–ª–µ disk)
‚Ä¢	–ª–µ–≥–∫–æ –¥–æ—Å—Ç–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É, –ø—Ä–µ–≤—å—é –∏ —Ç.–¥.
5) –£–¥–∞–ª–µ–Ω–∏–µ –∏ —á–∏—Å—Ç–∫–∞
‚Ä¢	–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è ‚Äî —É–¥–∞–ª—è–π—Ç–µ —Ñ–∞–π–ª—ã + –∑–∞–ø–∏—Å–∏ ad_media (Observer/Job).
‚Ä¢	–î–ª—è –æ–¥–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ª–µ–≥–∫–æ –ø–æ–¥—á–∏—Å—Ç–∏—Ç—å: –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª–∏—Ç–µ –ø–∞–ø–∫—É users/.../ads/.../YYYY/MM (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥ —ç—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ) –∏ –∑–∞–ø–∏—Å–∏ –≤ –ë–î.
–í–∞–∂–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
‚Ä¢	–î–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞–π—Ç–µ —à–∞—Ä–¥–∏–Ω–≥ –∏–ª–∏ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –ø–æ –¥–∞—Ç–µ ‚Äî –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ –¥–µ—Å—è—Ç–∫–∏ —Ç—ã—Å—è—á —Ñ–∞–π–ª–æ–≤ –≤ –æ–¥–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.
‚Ä¢	–ù–∞ –ø—Ä–æ–¥–µ –ª—É—á—à–µ S3/MinIO + CDN. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—É—Ç–µ–π –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Ç–∞–∫–æ–π –∂–µ, –ø—Ä–æ—Å—Ç–æ —Å–º–µ–Ω–∏—Ç—Å—è disk.
‚Ä¢	–î–ª—è –ø—Ä–µ–≤—å—é/–≤–µ—Ä—Å–∏–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ª—É—á—à–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∑–∞–≥—Ä—É–∑–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, thumbs/400x400, 800x800) –≤ —Ç—É –∂–µ –≤–µ—Ç–∫—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π.
‚Ä¢	–°—Ç–∞—Ä–∞–π—Ç–µ—Å—å —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î —Ç–æ–ª—å–∫–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π path –∏ disk ‚Äî URL —Å—Ç—Ä–æ–π—Ç–µ –Ω–∞ –ª–µ—Ç—É (Storage::disk($disk)->url($path)).
üîß –ö–û–ú–ê–ù–î–´:
‚Ä¢	–°–æ–∑–¥–∞—Ç—å —Å–∏–º–ª–∏–Ω–∫ –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ –∏–∑ public:
text
Apply
 
php artisan storage:link
‚Ä¢	–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–ø—Ä–µ–≤—å—é):
text
Apply
 
composer require intervention/image
‚úÖ –ü–†–û–í–ï–†–ö–ê:1) –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É2) –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –ø–æ–ø–∞–ª –≤ storage/app/public/users/...3) –í –±–∞–∑–µ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ç–∞–±–ª–∏—Ü—É ad_media) –ø–æ—è–≤–∏–ª–∞—Å—å –∑–∞–ø–∏—Å—å —Å disk=public –∏ path4) –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ asset('storage/'.$path) –∏–ª–∏ Storage::disk('public')->url($path)
