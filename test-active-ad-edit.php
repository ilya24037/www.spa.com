<?php

require_once __DIR__ . '/vendor/autoload.php';

$app = require_once __DIR__ . '/bootstrap/app.php';
$app->make('Illuminate\Contracts\Console\Kernel')->bootstrap();

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è ID 128...\n\n";

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
$ad = \App\Domain\Ad\Models\Ad::find(128);

if (!$ad) {
    echo "‚ùå –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å ID 128 –Ω–µ –Ω–∞–π–¥–µ–Ω–æ\n";
    exit(1);
}

echo "üìã –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï:\n";
echo "===================\n";
echo "ID: {$ad->id}\n";
echo "–°—Ç–∞—Ç—É—Å: {$ad->status->value}\n";
echo "–ù–∞–∑–≤–∞–Ω–∏–µ: {$ad->title}\n";
echo "–û–ø–∏—Å–∞–Ω–∏–µ: " . substr($ad->description, 0, 50) . "...\n";
echo "–ê–¥—Ä–µ—Å: {$ad->address}\n";

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
echo "\nüîß –ü–†–û–í–ï–†–ö–ê –í–û–ó–ú–û–ñ–ù–û–°–¢–ò –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø:\n";
echo "=====================================\n";

// –°–∏–º—É–ª–∏—Ä—É–µ–º —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
$canEdit = true;
$editUrl = "/ads/{$ad->id}/edit";

echo "URL —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: http://spa.test{$editUrl}\n";
echo "–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: " . ($canEdit ? "‚úÖ –î–ê" : "‚ùå –ù–ï–¢") . "\n";

if ($ad->status->value === 'active') {
    echo "‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å\n";
} else {
    echo "‚ö†Ô∏è –û–±—ä—è–≤–ª–µ–Ω–∏–µ –Ω–µ –∞–∫—Ç–∏–≤–Ω–æ - —Å—Ç–∞—Ç—É—Å: {$ad->status->value}\n";
}

// –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
echo "\nüîÑ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –û–ë–ù–û–í–õ–ï–ù–ò–Ø:\n";
echo "=========================\n";

$originalDescription = $ad->description;
$testDescription = $originalDescription . "\n\n[–û–±–Ω–æ–≤–ª–µ–Ω–æ: " . date('Y-m-d H:i:s') . "]";

try {
    $ad->update([
        'description' => $testDescription
    ]);
    
    echo "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ\n";
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å—Ç–∞—Ç—É—Å —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è
    $ad->refresh();
    echo "–°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: {$ad->status->value}\n";
    echo "–û–ø–∏—Å–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ: " . (strpos($ad->description, '[–û–±–Ω–æ–≤–ª–µ–Ω–æ:') !== false ? "‚úÖ –î–ê" : "‚ùå –ù–ï–¢") . "\n";
    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
    $ad->update(['description' => $originalDescription]);
    echo "–û–ø–∏—Å–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: ‚úÖ –î–ê\n";
    
} catch (\Exception $e) {
    echo "‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: " . $e->getMessage() . "\n";
}

echo "\nüåê –°–°–´–õ–ö–ò –î–õ–Ø –ü–†–û–í–ï–†–ö–ò:\n";
echo "=====================\n";
echo "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: http://spa.test/ads/{$ad->id}/edit\n";
echo "–ü—Ä–æ—Å–º–æ—Ç—Ä: http://spa.test/ads/{$ad->id}\n";
echo "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç: http://spa.test/profile\n";

echo "\nüéâ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!\n";